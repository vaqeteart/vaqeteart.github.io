<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />  
<title>小米路由器DIY</title>

<!--theme-->
<link rel="stylesheet" type="text/css"
  href="/assets/css/common_green_black.css" media="screen" />
<script src="/assets/js/jquery-1.11.3.min.js"></script>
<script src="/assets/js/common.js"></script>
<script src="/assets/js/category_list.js"></script>


    <link rel="stylesheet" type="text/css"
      href="/assets/css/posts.css" media="screen" />
  </head>

   <body onload="change_categories('categories_study_linux_misc')">
     <table class="container">
        <tbody>
	      <tr>
		<script src="/assets/js/nav.js"></script>
<th id="th_navbar">
    <table class="navbar"> <tbody> <tr>
	<th class="navitm">
	    <a href='/'>主页</a>
	</th>

	<th class="navblank">
	</th>

	<th class="navitm">
	      <a href=/categories/study/linux/misc/xiaomi_router_tips.html>分类</a>
	      <div id="category_menus" class="second">
  	      	   

		   <script>
		       var categories = {"id":"categories","path":"/","title":"分类","parent":null,"children":{"note":{"id":"categories_note","path":"/categories/note","title":"记事","parent":"categories","children":{"remind":{"id":"categories_note_remind","path":"/categories/note/remind","title":"备忘","parent":"categories_note","children":null},"plan":{"id":"categories_note_plan","path":"/categories/note/plan","title":"计划","parent":"categories_note","children":null}}},"study":{"id":"categories_study","path":"/categories/study","title":"学习","parent":"categories","children":{"problem":{"id":"categories_study_problem","path":"/categories/study/problem","title":"问题","parent":"categories_study","children":null},"git":{"id":"categories_study_git","path":"/categories/study/git","title":"git","parent":"categories_study","children":null},"os":{"id":"categories_study_os","path":"/categories/study/os","title":"操作系统","parent":"categories_study","children":null},"books":{"id":"categories_study_books","path":"/categories/study/books","title":"books","parent":"categories_study","children":{"apue":{"id":"categories_study_books_apue","path":"/categories/study/books/apue","title":"APUE","parent":"categories_study_books","children":null}}},"linux":{"id":"categories_study_linux","path":"/categories/study/linux","title":"linux","parent":"categories_study","children":{"misc":{"id":"categories_study_linux_misc","path":"/categories/study/linux/misc","title":"杂乱","parent":"categories_study_linux","children":null},"command":{"id":"categories_study_linux_command","path":"/categories/study/linux/command","title":"命令","parent":"categories_study_linux","children":null}}},"jekyll":{"id":"categories_study_jekyll","path":"/categories/study/jekyll","title":"jekyll","parent":"categories_study","children":null},"kits":{"id":"categories_study_kits","path":"/categories/study/kits","title":"工具","parent":"categories_study","children":null},"emacs":{"id":"categories_study_emacs","path":"/categories/study/emacs","title":"emacs","parent":"categories_study","children":null},"vim":{"id":"categories_study_vim","path":"/categories/study/vim","title":"vim","parent":"categories_study","children":null}}},"work":{"id":"categories_work","path":"/categories/work","title":"工作","parent":"categories","children":{"progress":{"id":"categories_work_progress","path":"/categories/work/progress","title":"进度","parent":"categories_work","children":null}}},"life":{"id":"categories_life","path":"/categories/life","title":"生活","parent":"categories","children":{"experience":{"id":"categories_life_experience","path":"/categories/life/experience","title":"经验","parent":"categories_life","children":null},"tips":{"id":"categories_life_tips","path":"/categories/life/tips","title":"技巧","parent":"categories_life","children":null}}},"others":{"id":"categories_others","path":"/categories/others","title":"其它","parent":"categories","children":{"rambles":{"id":"categories_others_rambles","path":"/categories/others/rambles","title":"随笔","parent":"categories_others","children":null},"temp":{"id":"categories_others_temp","path":"/categories/others/temp","title":"临时","parent":"categories_others","children":null},"test":{"id":"categories_others_test","path":"/categories/others/test","title":"测试","parent":"categories_others","children":null}}}}};
		       var categories_count = JSON.parse('{"/categories":0}');

  		       
    		       var post_categories = '/categories/study/linux';
    		       if (typeof(categories_count[post_categories]) == "undefined")
    		       {
				categories_count[post_categories] =0;
    		       }
    		       for(var key in categories_count)
    		       {
				if (key.length <= post_categories.length)
        			{
					if (post_categories.substring(0, key.length) 
                			   == key.substring(0,key.length))
            				{
						categories_count[key]+=1;
            				}
        			}
    			}
    			
    		       var post_categories = '/categories/study/linux/misc';
    		       if (typeof(categories_count[post_categories]) == "undefined")
    		       {
				categories_count[post_categories] =0;
    		       }
    		       for(var key in categories_count)
    		       {
				if (key.length <= post_categories.length)
        			{
					if (post_categories.substring(0, key.length) 
                			   == key.substring(0,key.length))
            				{
						categories_count[key]+=1;
            				}
        			}
    			}
    			
    		       var post_categories = '/categories/study/linux/misc';
    		       if (typeof(categories_count[post_categories]) == "undefined")
    		       {
				categories_count[post_categories] =0;
    		       }
    		       for(var key in categories_count)
    		       {
				if (key.length <= post_categories.length)
        			{
					if (post_categories.substring(0, key.length) 
                			   == key.substring(0,key.length))
            				{
						categories_count[key]+=1;
            				}
        			}
    			}
    			
    		       var post_categories = '/categories/others';
    		       if (typeof(categories_count[post_categories]) == "undefined")
    		       {
				categories_count[post_categories] =0;
    		       }
    		       for(var key in categories_count)
    		       {
				if (key.length <= post_categories.length)
        			{
					if (post_categories.substring(0, key.length) 
                			   == key.substring(0,key.length))
            				{
						categories_count[key]+=1;
            				}
        			}
    			}
    			
    		       var post_categories = '/categories/others';
    		       if (typeof(categories_count[post_categories]) == "undefined")
    		       {
				categories_count[post_categories] =0;
    		       }
    		       for(var key in categories_count)
    		       {
				if (key.length <= post_categories.length)
        			{
					if (post_categories.substring(0, key.length) 
                			   == key.substring(0,key.length))
            				{
						categories_count[key]+=1;
            				}
        			}
    			}
    			
    		       var post_categories = '/categories/study/kits';
    		       if (typeof(categories_count[post_categories]) == "undefined")
    		       {
				categories_count[post_categories] =0;
    		       }
    		       for(var key in categories_count)
    		       {
				if (key.length <= post_categories.length)
        			{
					if (post_categories.substring(0, key.length) 
                			   == key.substring(0,key.length))
            				{
						categories_count[key]+=1;
            				}
        			}
    			}
    			
    		       var post_categories = '/categories/study/linux/misc';
    		       if (typeof(categories_count[post_categories]) == "undefined")
    		       {
				categories_count[post_categories] =0;
    		       }
    		       for(var key in categories_count)
    		       {
				if (key.length <= post_categories.length)
        			{
					if (post_categories.substring(0, key.length) 
                			   == key.substring(0,key.length))
            				{
						categories_count[key]+=1;
            				}
        			}
    			}
    			
    		       var post_categories = '/categories/study/linux/command';
    		       if (typeof(categories_count[post_categories]) == "undefined")
    		       {
				categories_count[post_categories] =0;
    		       }
    		       for(var key in categories_count)
    		       {
				if (key.length <= post_categories.length)
        			{
					if (post_categories.substring(0, key.length) 
                			   == key.substring(0,key.length))
            				{
						categories_count[key]+=1;
            				}
        			}
    			}
    			
    		       var post_categories = '/categories/study/os';
    		       if (typeof(categories_count[post_categories]) == "undefined")
    		       {
				categories_count[post_categories] =0;
    		       }
    		       for(var key in categories_count)
    		       {
				if (key.length <= post_categories.length)
        			{
					if (post_categories.substring(0, key.length) 
                			   == key.substring(0,key.length))
            				{
						categories_count[key]+=1;
            				}
        			}
    			}
    			
    		       var post_categories = '/categories/others';
    		       if (typeof(categories_count[post_categories]) == "undefined")
    		       {
				categories_count[post_categories] =0;
    		       }
    		       for(var key in categories_count)
    		       {
				if (key.length <= post_categories.length)
        			{
					if (post_categories.substring(0, key.length) 
                			   == key.substring(0,key.length))
            				{
						categories_count[key]+=1;
            				}
        			}
    			}
    			
    		       var post_categories = '/categories/others';
    		       if (typeof(categories_count[post_categories]) == "undefined")
    		       {
				categories_count[post_categories] =0;
    		       }
    		       for(var key in categories_count)
    		       {
				if (key.length <= post_categories.length)
        			{
					if (post_categories.substring(0, key.length) 
                			   == key.substring(0,key.length))
            				{
						categories_count[key]+=1;
            				}
        			}
    			}
    			
    		       var post_categories = '/categories/note';
    		       if (typeof(categories_count[post_categories]) == "undefined")
    		       {
				categories_count[post_categories] =0;
    		       }
    		       for(var key in categories_count)
    		       {
				if (key.length <= post_categories.length)
        			{
					if (post_categories.substring(0, key.length) 
                			   == key.substring(0,key.length))
            				{
						categories_count[key]+=1;
            				}
        			}
    			}
    			
    		       var post_categories = '/categories/note';
    		       if (typeof(categories_count[post_categories]) == "undefined")
    		       {
				categories_count[post_categories] =0;
    		       }
    		       for(var key in categories_count)
    		       {
				if (key.length <= post_categories.length)
        			{
					if (post_categories.substring(0, key.length) 
                			   == key.substring(0,key.length))
            				{
						categories_count[key]+=1;
            				}
        			}
    			}
    			
    		       var post_categories = '/categories/study/emacs';
    		       if (typeof(categories_count[post_categories]) == "undefined")
    		       {
				categories_count[post_categories] =0;
    		       }
    		       for(var key in categories_count)
    		       {
				if (key.length <= post_categories.length)
        			{
					if (post_categories.substring(0, key.length) 
                			   == key.substring(0,key.length))
            				{
						categories_count[key]+=1;
            				}
        			}
    			}
    			
    		       var post_categories = '/categories/others';
    		       if (typeof(categories_count[post_categories]) == "undefined")
    		       {
				categories_count[post_categories] =0;
    		       }
    		       for(var key in categories_count)
    		       {
				if (key.length <= post_categories.length)
        			{
					if (post_categories.substring(0, key.length) 
                			   == key.substring(0,key.length))
            				{
						categories_count[key]+=1;
            				}
        			}
    			}
    			
    		       var post_categories = '/categories/study/emacs';
    		       if (typeof(categories_count[post_categories]) == "undefined")
    		       {
				categories_count[post_categories] =0;
    		       }
    		       for(var key in categories_count)
    		       {
				if (key.length <= post_categories.length)
        			{
					if (post_categories.substring(0, key.length) 
                			   == key.substring(0,key.length))
            				{
						categories_count[key]+=1;
            				}
        			}
    			}
    			
    		       var post_categories = '/categories/life';
    		       if (typeof(categories_count[post_categories]) == "undefined")
    		       {
				categories_count[post_categories] =0;
    		       }
    		       for(var key in categories_count)
    		       {
				if (key.length <= post_categories.length)
        			{
					if (post_categories.substring(0, key.length) 
                			   == key.substring(0,key.length))
            				{
						categories_count[key]+=1;
            				}
        			}
    			}
    			
    		       var post_categories = '/categories/others';
    		       if (typeof(categories_count[post_categories]) == "undefined")
    		       {
				categories_count[post_categories] =0;
    		       }
    		       for(var key in categories_count)
    		       {
				if (key.length <= post_categories.length)
        			{
					if (post_categories.substring(0, key.length) 
                			   == key.substring(0,key.length))
            				{
						categories_count[key]+=1;
            				}
        			}
    			}
    			
    		       var post_categories = '/categories/study';
    		       if (typeof(categories_count[post_categories]) == "undefined")
    		       {
				categories_count[post_categories] =0;
    		       }
    		       for(var key in categories_count)
    		       {
				if (key.length <= post_categories.length)
        			{
					if (post_categories.substring(0, key.length) 
                			   == key.substring(0,key.length))
            				{
						categories_count[key]+=1;
            				}
        			}
    			}
    			
    		       var post_categories = '/categories/others';
    		       if (typeof(categories_count[post_categories]) == "undefined")
    		       {
				categories_count[post_categories] =0;
    		       }
    		       for(var key in categories_count)
    		       {
				if (key.length <= post_categories.length)
        			{
					if (post_categories.substring(0, key.length) 
                			   == key.substring(0,key.length))
            				{
						categories_count[key]+=1;
            				}
        			}
    			}
    			
    		       var post_categories = '/categories/study';
    		       if (typeof(categories_count[post_categories]) == "undefined")
    		       {
				categories_count[post_categories] =0;
    		       }
    		       for(var key in categories_count)
    		       {
				if (key.length <= post_categories.length)
        			{
					if (post_categories.substring(0, key.length) 
                			   == key.substring(0,key.length))
            				{
						categories_count[key]+=1;
            				}
        			}
    			}
    			
    		       var post_categories = '/categories/study/git';
    		       if (typeof(categories_count[post_categories]) == "undefined")
    		       {
				categories_count[post_categories] =0;
    		       }
    		       for(var key in categories_count)
    		       {
				if (key.length <= post_categories.length)
        			{
					if (post_categories.substring(0, key.length) 
                			   == key.substring(0,key.length))
            				{
						categories_count[key]+=1;
            				}
        			}
    			}
    			
    		       var post_categories = '/categories/study/linux';
    		       if (typeof(categories_count[post_categories]) == "undefined")
    		       {
				categories_count[post_categories] =0;
    		       }
    		       for(var key in categories_count)
    		       {
				if (key.length <= post_categories.length)
        			{
					if (post_categories.substring(0, key.length) 
                			   == key.substring(0,key.length))
            				{
						categories_count[key]+=1;
            				}
        			}
    			}
    			
    		       var post_categories = '/categories/others/rambles';
    		       if (typeof(categories_count[post_categories]) == "undefined")
    		       {
				categories_count[post_categories] =0;
    		       }
    		       for(var key in categories_count)
    		       {
				if (key.length <= post_categories.length)
        			{
					if (post_categories.substring(0, key.length) 
                			   == key.substring(0,key.length))
            				{
						categories_count[key]+=1;
            				}
        			}
    			}
    			
    		       var post_categories = '/categories/others/rambles';
    		       if (typeof(categories_count[post_categories]) == "undefined")
    		       {
				categories_count[post_categories] =0;
    		       }
    		       for(var key in categories_count)
    		       {
				if (key.length <= post_categories.length)
        			{
					if (post_categories.substring(0, key.length) 
                			   == key.substring(0,key.length))
            				{
						categories_count[key]+=1;
            				}
        			}
    			}
    			
    		       var post_categories = '/categories/study/vim';
    		       if (typeof(categories_count[post_categories]) == "undefined")
    		       {
				categories_count[post_categories] =0;
    		       }
    		       for(var key in categories_count)
    		       {
				if (key.length <= post_categories.length)
        			{
					if (post_categories.substring(0, key.length) 
                			   == key.substring(0,key.length))
            				{
						categories_count[key]+=1;
            				}
        			}
    			}
    			
    		       var post_categories = '/categories/study/vim';
    		       if (typeof(categories_count[post_categories]) == "undefined")
    		       {
				categories_count[post_categories] =0;
    		       }
    		       for(var key in categories_count)
    		       {
				if (key.length <= post_categories.length)
        			{
					if (post_categories.substring(0, key.length) 
                			   == key.substring(0,key.length))
            				{
						categories_count[key]+=1;
            				}
        			}
    			}
    			
    		       var post_categories = '/categories/study/vim';
    		       if (typeof(categories_count[post_categories]) == "undefined")
    		       {
				categories_count[post_categories] =0;
    		       }
    		       for(var key in categories_count)
    		       {
				if (key.length <= post_categories.length)
        			{
					if (post_categories.substring(0, key.length) 
                			   == key.substring(0,key.length))
            				{
						categories_count[key]+=1;
            				}
        			}
    			}
    			
    		       var post_categories = '/categories/study/vim';
    		       if (typeof(categories_count[post_categories]) == "undefined")
    		       {
				categories_count[post_categories] =0;
    		       }
    		       for(var key in categories_count)
    		       {
				if (key.length <= post_categories.length)
        			{
					if (post_categories.substring(0, key.length) 
                			   == key.substring(0,key.length))
            				{
						categories_count[key]+=1;
            				}
        			}
    			}
    			
    		       var post_categories = '/categories/study/vim';
    		       if (typeof(categories_count[post_categories]) == "undefined")
    		       {
				categories_count[post_categories] =0;
    		       }
    		       for(var key in categories_count)
    		       {
				if (key.length <= post_categories.length)
        			{
					if (post_categories.substring(0, key.length) 
                			   == key.substring(0,key.length))
            				{
						categories_count[key]+=1;
            				}
        			}
    			}
    			
    		       var post_categories = '/categories/study/vim';
    		       if (typeof(categories_count[post_categories]) == "undefined")
    		       {
				categories_count[post_categories] =0;
    		       }
    		       for(var key in categories_count)
    		       {
				if (key.length <= post_categories.length)
        			{
					if (post_categories.substring(0, key.length) 
                			   == key.substring(0,key.length))
            				{
						categories_count[key]+=1;
            				}
        			}
    			}
    			
    		       var post_categories = '/categories/study/vim';
    		       if (typeof(categories_count[post_categories]) == "undefined")
    		       {
				categories_count[post_categories] =0;
    		       }
    		       for(var key in categories_count)
    		       {
				if (key.length <= post_categories.length)
        			{
					if (post_categories.substring(0, key.length) 
                			   == key.substring(0,key.length))
            				{
						categories_count[key]+=1;
            				}
        			}
    			}
    			
    		       var post_categories = '/categories/study/vim';
    		       if (typeof(categories_count[post_categories]) == "undefined")
    		       {
				categories_count[post_categories] =0;
    		       }
    		       for(var key in categories_count)
    		       {
				if (key.length <= post_categories.length)
        			{
					if (post_categories.substring(0, key.length) 
                			   == key.substring(0,key.length))
            				{
						categories_count[key]+=1;
            				}
        			}
    			}
    			
    		       var post_categories = '/categories/study/vim';
    		       if (typeof(categories_count[post_categories]) == "undefined")
    		       {
				categories_count[post_categories] =0;
    		       }
    		       for(var key in categories_count)
    		       {
				if (key.length <= post_categories.length)
        			{
					if (post_categories.substring(0, key.length) 
                			   == key.substring(0,key.length))
            				{
						categories_count[key]+=1;
            				}
        			}
    			}
    			
    		       var post_categories = '/categories/study/linux/command';
    		       if (typeof(categories_count[post_categories]) == "undefined")
    		       {
				categories_count[post_categories] =0;
    		       }
    		       for(var key in categories_count)
    		       {
				if (key.length <= post_categories.length)
        			{
					if (post_categories.substring(0, key.length) 
                			   == key.substring(0,key.length))
            				{
						categories_count[key]+=1;
            				}
        			}
    			}
    			
    		       var post_categories = '/categories/study/linux/command';
    		       if (typeof(categories_count[post_categories]) == "undefined")
    		       {
				categories_count[post_categories] =0;
    		       }
    		       for(var key in categories_count)
    		       {
				if (key.length <= post_categories.length)
        			{
					if (post_categories.substring(0, key.length) 
                			   == key.substring(0,key.length))
            				{
						categories_count[key]+=1;
            				}
        			}
    			}
    			
    		       var post_categories = '/categories/study/linux/command';
    		       if (typeof(categories_count[post_categories]) == "undefined")
    		       {
				categories_count[post_categories] =0;
    		       }
    		       for(var key in categories_count)
    		       {
				if (key.length <= post_categories.length)
        			{
					if (post_categories.substring(0, key.length) 
                			   == key.substring(0,key.length))
            				{
						categories_count[key]+=1;
            				}
        			}
    			}
    			
    		       var post_categories = '/categories/study/linux/command';
    		       if (typeof(categories_count[post_categories]) == "undefined")
    		       {
				categories_count[post_categories] =0;
    		       }
    		       for(var key in categories_count)
    		       {
				if (key.length <= post_categories.length)
        			{
					if (post_categories.substring(0, key.length) 
                			   == key.substring(0,key.length))
            				{
						categories_count[key]+=1;
            				}
        			}
    			}
    			
    		       var post_categories = '/categories/study/linux/command';
    		       if (typeof(categories_count[post_categories]) == "undefined")
    		       {
				categories_count[post_categories] =0;
    		       }
    		       for(var key in categories_count)
    		       {
				if (key.length <= post_categories.length)
        			{
					if (post_categories.substring(0, key.length) 
                			   == key.substring(0,key.length))
            				{
						categories_count[key]+=1;
            				}
        			}
    			}
    			
    		       var post_categories = '/categories/study/linux/command';
    		       if (typeof(categories_count[post_categories]) == "undefined")
    		       {
				categories_count[post_categories] =0;
    		       }
    		       for(var key in categories_count)
    		       {
				if (key.length <= post_categories.length)
        			{
					if (post_categories.substring(0, key.length) 
                			   == key.substring(0,key.length))
            				{
						categories_count[key]+=1;
            				}
        			}
    			}
    			
    		       var post_categories = '/categories/study/linux/command';
    		       if (typeof(categories_count[post_categories]) == "undefined")
    		       {
				categories_count[post_categories] =0;
    		       }
    		       for(var key in categories_count)
    		       {
				if (key.length <= post_categories.length)
        			{
					if (post_categories.substring(0, key.length) 
                			   == key.substring(0,key.length))
            				{
						categories_count[key]+=1;
            				}
        			}
    			}
    			
    		       var post_categories = '/categories/study/linux/command';
    		       if (typeof(categories_count[post_categories]) == "undefined")
    		       {
				categories_count[post_categories] =0;
    		       }
    		       for(var key in categories_count)
    		       {
				if (key.length <= post_categories.length)
        			{
					if (post_categories.substring(0, key.length) 
                			   == key.substring(0,key.length))
            				{
						categories_count[key]+=1;
            				}
        			}
    			}
    			
    		       var post_categories = '/categories/study/linux/command';
    		       if (typeof(categories_count[post_categories]) == "undefined")
    		       {
				categories_count[post_categories] =0;
    		       }
    		       for(var key in categories_count)
    		       {
				if (key.length <= post_categories.length)
        			{
					if (post_categories.substring(0, key.length) 
                			   == key.substring(0,key.length))
            				{
						categories_count[key]+=1;
            				}
        			}
    			}
    			

    			create_category_menu(categories, 0, categories_count);
    			//document.write("hello")
		    </script>
	      </div>
	</th>

        <th class="navitm">
	      <a href='#'>标签</a>
	      <div id="tag_menus" class="second">
	          
		      <a id="gtd_next" href="#"> gtd_next(13)</a>
		  
		      <a id="study" href="#"> study(10)</a>
		  
		      <a id="gtd_done" href="#"> gtd_done(4)</a>
		  
		      <a id="others" href="#"> others(3)</a>
		  
		      <a id="life" href="#"> life(1)</a>
		  
	      </div>
        </th>

	<th class="navblank">
	</th>

	<th class="navitm">
	      <a href=/more.html>更多</a>
        </th>

        <th class="navitm">
	      <a href=/about.html>关于</a>
        </th>

	<th class="navblank" style="width:25%;">
	</th>

	<th class="navitm" style="margin:0; padding:0;border:none;">
	    <form method="get" id="searchform" action="/search.html" style="margin:0;padding:0;height:100%;">
	    	  <span style= "color:#00FF00;">Q</span>
	    	  <span style="border-style:solid; border-width:1px; border-color:#00FF00;
		  		border-top:0px; border-left:0px;border-right:0px; 
				margin:0;padding:0;height:100%;">
				<input value="Search by title (canbe regex)..." name="s" class="s" 
		  	 	onfocus="if (this.value == 'Search by title (canbe regex)...') {this.value = '';}" 
		  	 	onblur="if (this.value == '') {this.value = 'Search by title (canbe regex)...';}"
			 	style="margin:0;padding:0;height:100%;border:none;background: #000000; color:#00A600;" 
			 	type="text">
		  </span>
		  <!--input type="submit" value="Q" style="width:20%;"-->
	    </form>
	</th>

	<th class="navblank">
	</th>

	<th class="navblank">
	</th>

	<a href='#' id="topbtn">⇑</a>

	<a href='#bottom' id="bottombtn">⇓</a>
	<!--⇐⇑⇒⇓-->

  <tr> </tbody> </table>
</th>

	      </tr>
	      <tr>
                  <td id="td_page_header" colspan="6" valign="top" align="right" style="width:100%;">
    <header style="text-align: center;">
	<h1>
	       <a href="/" title="Home Page">
	       QuietHeart's Site
	       </a>
	</h1>
    </header>
</td>



	      </tr>
             <tr>
                <!--td id="td_category_list"  colspan="1" valign="top"><aside id="left-side" >
  <h2> 分类 </h2>
  
  <script>
    var categories = {"id":"categories","path":"/","title":"分类","parent":null,"children":{"note":{"id":"categories_note","path":"/categories/note","title":"记事","parent":"categories","children":{"remind":{"id":"categories_note_remind","path":"/categories/note/remind","title":"备忘","parent":"categories_note","children":null},"plan":{"id":"categories_note_plan","path":"/categories/note/plan","title":"计划","parent":"categories_note","children":null}}},"study":{"id":"categories_study","path":"/categories/study","title":"学习","parent":"categories","children":{"problem":{"id":"categories_study_problem","path":"/categories/study/problem","title":"问题","parent":"categories_study","children":null},"git":{"id":"categories_study_git","path":"/categories/study/git","title":"git","parent":"categories_study","children":null},"os":{"id":"categories_study_os","path":"/categories/study/os","title":"操作系统","parent":"categories_study","children":null},"books":{"id":"categories_study_books","path":"/categories/study/books","title":"books","parent":"categories_study","children":{"apue":{"id":"categories_study_books_apue","path":"/categories/study/books/apue","title":"APUE","parent":"categories_study_books","children":null}}},"linux":{"id":"categories_study_linux","path":"/categories/study/linux","title":"linux","parent":"categories_study","children":{"misc":{"id":"categories_study_linux_misc","path":"/categories/study/linux/misc","title":"杂乱","parent":"categories_study_linux","children":null},"command":{"id":"categories_study_linux_command","path":"/categories/study/linux/command","title":"命令","parent":"categories_study_linux","children":null}}},"jekyll":{"id":"categories_study_jekyll","path":"/categories/study/jekyll","title":"jekyll","parent":"categories_study","children":null},"kits":{"id":"categories_study_kits","path":"/categories/study/kits","title":"工具","parent":"categories_study","children":null},"emacs":{"id":"categories_study_emacs","path":"/categories/study/emacs","title":"emacs","parent":"categories_study","children":null},"vim":{"id":"categories_study_vim","path":"/categories/study/vim","title":"vim","parent":"categories_study","children":null}}},"work":{"id":"categories_work","path":"/categories/work","title":"工作","parent":"categories","children":{"progress":{"id":"categories_work_progress","path":"/categories/work/progress","title":"进度","parent":"categories_work","children":null}}},"life":{"id":"categories_life","path":"/categories/life","title":"生活","parent":"categories","children":{"experience":{"id":"categories_life_experience","path":"/categories/life/experience","title":"经验","parent":"categories_life","children":null},"tips":{"id":"categories_life_tips","path":"/categories/life/tips","title":"技巧","parent":"categories_life","children":null}}},"others":{"id":"categories_others","path":"/categories/others","title":"其它","parent":"categories","children":{"rambles":{"id":"categories_others_rambles","path":"/categories/others/rambles","title":"随笔","parent":"categories_others","children":null},"temp":{"id":"categories_others_temp","path":"/categories/others/temp","title":"临时","parent":"categories_others","children":null},"test":{"id":"categories_others_test","path":"/categories/others/test","title":"测试","parent":"categories_others","children":null}}}}};
    var categories_count = JSON.parse('{"/categories":0}');

    
    var post_categories = '/categories/study/linux';
    if (typeof(categories_count[post_categories]) == "undefined")
    {
        categories_count[post_categories] =0;
    }
    for(var key in categories_count)
    {
        if (key.length <= post_categories.length)
        {
            if (post_categories.substring(0, key.length) 
                == key.substring(0,key.length))
            {
                categories_count[key]+=1;
            }
        }
    }
    
    var post_categories = '/categories/study/linux/misc';
    if (typeof(categories_count[post_categories]) == "undefined")
    {
        categories_count[post_categories] =0;
    }
    for(var key in categories_count)
    {
        if (key.length <= post_categories.length)
        {
            if (post_categories.substring(0, key.length) 
                == key.substring(0,key.length))
            {
                categories_count[key]+=1;
            }
        }
    }
    
    var post_categories = '/categories/study/linux/misc';
    if (typeof(categories_count[post_categories]) == "undefined")
    {
        categories_count[post_categories] =0;
    }
    for(var key in categories_count)
    {
        if (key.length <= post_categories.length)
        {
            if (post_categories.substring(0, key.length) 
                == key.substring(0,key.length))
            {
                categories_count[key]+=1;
            }
        }
    }
    
    var post_categories = '/categories/others';
    if (typeof(categories_count[post_categories]) == "undefined")
    {
        categories_count[post_categories] =0;
    }
    for(var key in categories_count)
    {
        if (key.length <= post_categories.length)
        {
            if (post_categories.substring(0, key.length) 
                == key.substring(0,key.length))
            {
                categories_count[key]+=1;
            }
        }
    }
    
    var post_categories = '/categories/others';
    if (typeof(categories_count[post_categories]) == "undefined")
    {
        categories_count[post_categories] =0;
    }
    for(var key in categories_count)
    {
        if (key.length <= post_categories.length)
        {
            if (post_categories.substring(0, key.length) 
                == key.substring(0,key.length))
            {
                categories_count[key]+=1;
            }
        }
    }
    
    var post_categories = '/categories/study/kits';
    if (typeof(categories_count[post_categories]) == "undefined")
    {
        categories_count[post_categories] =0;
    }
    for(var key in categories_count)
    {
        if (key.length <= post_categories.length)
        {
            if (post_categories.substring(0, key.length) 
                == key.substring(0,key.length))
            {
                categories_count[key]+=1;
            }
        }
    }
    
    var post_categories = '/categories/study/linux/misc';
    if (typeof(categories_count[post_categories]) == "undefined")
    {
        categories_count[post_categories] =0;
    }
    for(var key in categories_count)
    {
        if (key.length <= post_categories.length)
        {
            if (post_categories.substring(0, key.length) 
                == key.substring(0,key.length))
            {
                categories_count[key]+=1;
            }
        }
    }
    
    var post_categories = '/categories/study/linux/command';
    if (typeof(categories_count[post_categories]) == "undefined")
    {
        categories_count[post_categories] =0;
    }
    for(var key in categories_count)
    {
        if (key.length <= post_categories.length)
        {
            if (post_categories.substring(0, key.length) 
                == key.substring(0,key.length))
            {
                categories_count[key]+=1;
            }
        }
    }
    
    var post_categories = '/categories/study/os';
    if (typeof(categories_count[post_categories]) == "undefined")
    {
        categories_count[post_categories] =0;
    }
    for(var key in categories_count)
    {
        if (key.length <= post_categories.length)
        {
            if (post_categories.substring(0, key.length) 
                == key.substring(0,key.length))
            {
                categories_count[key]+=1;
            }
        }
    }
    
    var post_categories = '/categories/others';
    if (typeof(categories_count[post_categories]) == "undefined")
    {
        categories_count[post_categories] =0;
    }
    for(var key in categories_count)
    {
        if (key.length <= post_categories.length)
        {
            if (post_categories.substring(0, key.length) 
                == key.substring(0,key.length))
            {
                categories_count[key]+=1;
            }
        }
    }
    
    var post_categories = '/categories/others';
    if (typeof(categories_count[post_categories]) == "undefined")
    {
        categories_count[post_categories] =0;
    }
    for(var key in categories_count)
    {
        if (key.length <= post_categories.length)
        {
            if (post_categories.substring(0, key.length) 
                == key.substring(0,key.length))
            {
                categories_count[key]+=1;
            }
        }
    }
    
    var post_categories = '/categories/note';
    if (typeof(categories_count[post_categories]) == "undefined")
    {
        categories_count[post_categories] =0;
    }
    for(var key in categories_count)
    {
        if (key.length <= post_categories.length)
        {
            if (post_categories.substring(0, key.length) 
                == key.substring(0,key.length))
            {
                categories_count[key]+=1;
            }
        }
    }
    
    var post_categories = '/categories/note';
    if (typeof(categories_count[post_categories]) == "undefined")
    {
        categories_count[post_categories] =0;
    }
    for(var key in categories_count)
    {
        if (key.length <= post_categories.length)
        {
            if (post_categories.substring(0, key.length) 
                == key.substring(0,key.length))
            {
                categories_count[key]+=1;
            }
        }
    }
    
    var post_categories = '/categories/study/emacs';
    if (typeof(categories_count[post_categories]) == "undefined")
    {
        categories_count[post_categories] =0;
    }
    for(var key in categories_count)
    {
        if (key.length <= post_categories.length)
        {
            if (post_categories.substring(0, key.length) 
                == key.substring(0,key.length))
            {
                categories_count[key]+=1;
            }
        }
    }
    
    var post_categories = '/categories/others';
    if (typeof(categories_count[post_categories]) == "undefined")
    {
        categories_count[post_categories] =0;
    }
    for(var key in categories_count)
    {
        if (key.length <= post_categories.length)
        {
            if (post_categories.substring(0, key.length) 
                == key.substring(0,key.length))
            {
                categories_count[key]+=1;
            }
        }
    }
    
    var post_categories = '/categories/study/emacs';
    if (typeof(categories_count[post_categories]) == "undefined")
    {
        categories_count[post_categories] =0;
    }
    for(var key in categories_count)
    {
        if (key.length <= post_categories.length)
        {
            if (post_categories.substring(0, key.length) 
                == key.substring(0,key.length))
            {
                categories_count[key]+=1;
            }
        }
    }
    
    var post_categories = '/categories/life';
    if (typeof(categories_count[post_categories]) == "undefined")
    {
        categories_count[post_categories] =0;
    }
    for(var key in categories_count)
    {
        if (key.length <= post_categories.length)
        {
            if (post_categories.substring(0, key.length) 
                == key.substring(0,key.length))
            {
                categories_count[key]+=1;
            }
        }
    }
    
    var post_categories = '/categories/others';
    if (typeof(categories_count[post_categories]) == "undefined")
    {
        categories_count[post_categories] =0;
    }
    for(var key in categories_count)
    {
        if (key.length <= post_categories.length)
        {
            if (post_categories.substring(0, key.length) 
                == key.substring(0,key.length))
            {
                categories_count[key]+=1;
            }
        }
    }
    
    var post_categories = '/categories/study';
    if (typeof(categories_count[post_categories]) == "undefined")
    {
        categories_count[post_categories] =0;
    }
    for(var key in categories_count)
    {
        if (key.length <= post_categories.length)
        {
            if (post_categories.substring(0, key.length) 
                == key.substring(0,key.length))
            {
                categories_count[key]+=1;
            }
        }
    }
    
    var post_categories = '/categories/others';
    if (typeof(categories_count[post_categories]) == "undefined")
    {
        categories_count[post_categories] =0;
    }
    for(var key in categories_count)
    {
        if (key.length <= post_categories.length)
        {
            if (post_categories.substring(0, key.length) 
                == key.substring(0,key.length))
            {
                categories_count[key]+=1;
            }
        }
    }
    
    var post_categories = '/categories/study';
    if (typeof(categories_count[post_categories]) == "undefined")
    {
        categories_count[post_categories] =0;
    }
    for(var key in categories_count)
    {
        if (key.length <= post_categories.length)
        {
            if (post_categories.substring(0, key.length) 
                == key.substring(0,key.length))
            {
                categories_count[key]+=1;
            }
        }
    }
    
    var post_categories = '/categories/study/git';
    if (typeof(categories_count[post_categories]) == "undefined")
    {
        categories_count[post_categories] =0;
    }
    for(var key in categories_count)
    {
        if (key.length <= post_categories.length)
        {
            if (post_categories.substring(0, key.length) 
                == key.substring(0,key.length))
            {
                categories_count[key]+=1;
            }
        }
    }
    
    var post_categories = '/categories/study/linux';
    if (typeof(categories_count[post_categories]) == "undefined")
    {
        categories_count[post_categories] =0;
    }
    for(var key in categories_count)
    {
        if (key.length <= post_categories.length)
        {
            if (post_categories.substring(0, key.length) 
                == key.substring(0,key.length))
            {
                categories_count[key]+=1;
            }
        }
    }
    
    var post_categories = '/categories/others/rambles';
    if (typeof(categories_count[post_categories]) == "undefined")
    {
        categories_count[post_categories] =0;
    }
    for(var key in categories_count)
    {
        if (key.length <= post_categories.length)
        {
            if (post_categories.substring(0, key.length) 
                == key.substring(0,key.length))
            {
                categories_count[key]+=1;
            }
        }
    }
    
    var post_categories = '/categories/others/rambles';
    if (typeof(categories_count[post_categories]) == "undefined")
    {
        categories_count[post_categories] =0;
    }
    for(var key in categories_count)
    {
        if (key.length <= post_categories.length)
        {
            if (post_categories.substring(0, key.length) 
                == key.substring(0,key.length))
            {
                categories_count[key]+=1;
            }
        }
    }
    
    var post_categories = '/categories/study/vim';
    if (typeof(categories_count[post_categories]) == "undefined")
    {
        categories_count[post_categories] =0;
    }
    for(var key in categories_count)
    {
        if (key.length <= post_categories.length)
        {
            if (post_categories.substring(0, key.length) 
                == key.substring(0,key.length))
            {
                categories_count[key]+=1;
            }
        }
    }
    
    var post_categories = '/categories/study/vim';
    if (typeof(categories_count[post_categories]) == "undefined")
    {
        categories_count[post_categories] =0;
    }
    for(var key in categories_count)
    {
        if (key.length <= post_categories.length)
        {
            if (post_categories.substring(0, key.length) 
                == key.substring(0,key.length))
            {
                categories_count[key]+=1;
            }
        }
    }
    
    var post_categories = '/categories/study/vim';
    if (typeof(categories_count[post_categories]) == "undefined")
    {
        categories_count[post_categories] =0;
    }
    for(var key in categories_count)
    {
        if (key.length <= post_categories.length)
        {
            if (post_categories.substring(0, key.length) 
                == key.substring(0,key.length))
            {
                categories_count[key]+=1;
            }
        }
    }
    
    var post_categories = '/categories/study/vim';
    if (typeof(categories_count[post_categories]) == "undefined")
    {
        categories_count[post_categories] =0;
    }
    for(var key in categories_count)
    {
        if (key.length <= post_categories.length)
        {
            if (post_categories.substring(0, key.length) 
                == key.substring(0,key.length))
            {
                categories_count[key]+=1;
            }
        }
    }
    
    var post_categories = '/categories/study/vim';
    if (typeof(categories_count[post_categories]) == "undefined")
    {
        categories_count[post_categories] =0;
    }
    for(var key in categories_count)
    {
        if (key.length <= post_categories.length)
        {
            if (post_categories.substring(0, key.length) 
                == key.substring(0,key.length))
            {
                categories_count[key]+=1;
            }
        }
    }
    
    var post_categories = '/categories/study/vim';
    if (typeof(categories_count[post_categories]) == "undefined")
    {
        categories_count[post_categories] =0;
    }
    for(var key in categories_count)
    {
        if (key.length <= post_categories.length)
        {
            if (post_categories.substring(0, key.length) 
                == key.substring(0,key.length))
            {
                categories_count[key]+=1;
            }
        }
    }
    
    var post_categories = '/categories/study/vim';
    if (typeof(categories_count[post_categories]) == "undefined")
    {
        categories_count[post_categories] =0;
    }
    for(var key in categories_count)
    {
        if (key.length <= post_categories.length)
        {
            if (post_categories.substring(0, key.length) 
                == key.substring(0,key.length))
            {
                categories_count[key]+=1;
            }
        }
    }
    
    var post_categories = '/categories/study/vim';
    if (typeof(categories_count[post_categories]) == "undefined")
    {
        categories_count[post_categories] =0;
    }
    for(var key in categories_count)
    {
        if (key.length <= post_categories.length)
        {
            if (post_categories.substring(0, key.length) 
                == key.substring(0,key.length))
            {
                categories_count[key]+=1;
            }
        }
    }
    
    var post_categories = '/categories/study/vim';
    if (typeof(categories_count[post_categories]) == "undefined")
    {
        categories_count[post_categories] =0;
    }
    for(var key in categories_count)
    {
        if (key.length <= post_categories.length)
        {
            if (post_categories.substring(0, key.length) 
                == key.substring(0,key.length))
            {
                categories_count[key]+=1;
            }
        }
    }
    
    var post_categories = '/categories/study/linux/command';
    if (typeof(categories_count[post_categories]) == "undefined")
    {
        categories_count[post_categories] =0;
    }
    for(var key in categories_count)
    {
        if (key.length <= post_categories.length)
        {
            if (post_categories.substring(0, key.length) 
                == key.substring(0,key.length))
            {
                categories_count[key]+=1;
            }
        }
    }
    
    var post_categories = '/categories/study/linux/command';
    if (typeof(categories_count[post_categories]) == "undefined")
    {
        categories_count[post_categories] =0;
    }
    for(var key in categories_count)
    {
        if (key.length <= post_categories.length)
        {
            if (post_categories.substring(0, key.length) 
                == key.substring(0,key.length))
            {
                categories_count[key]+=1;
            }
        }
    }
    
    var post_categories = '/categories/study/linux/command';
    if (typeof(categories_count[post_categories]) == "undefined")
    {
        categories_count[post_categories] =0;
    }
    for(var key in categories_count)
    {
        if (key.length <= post_categories.length)
        {
            if (post_categories.substring(0, key.length) 
                == key.substring(0,key.length))
            {
                categories_count[key]+=1;
            }
        }
    }
    
    var post_categories = '/categories/study/linux/command';
    if (typeof(categories_count[post_categories]) == "undefined")
    {
        categories_count[post_categories] =0;
    }
    for(var key in categories_count)
    {
        if (key.length <= post_categories.length)
        {
            if (post_categories.substring(0, key.length) 
                == key.substring(0,key.length))
            {
                categories_count[key]+=1;
            }
        }
    }
    
    var post_categories = '/categories/study/linux/command';
    if (typeof(categories_count[post_categories]) == "undefined")
    {
        categories_count[post_categories] =0;
    }
    for(var key in categories_count)
    {
        if (key.length <= post_categories.length)
        {
            if (post_categories.substring(0, key.length) 
                == key.substring(0,key.length))
            {
                categories_count[key]+=1;
            }
        }
    }
    
    var post_categories = '/categories/study/linux/command';
    if (typeof(categories_count[post_categories]) == "undefined")
    {
        categories_count[post_categories] =0;
    }
    for(var key in categories_count)
    {
        if (key.length <= post_categories.length)
        {
            if (post_categories.substring(0, key.length) 
                == key.substring(0,key.length))
            {
                categories_count[key]+=1;
            }
        }
    }
    
    var post_categories = '/categories/study/linux/command';
    if (typeof(categories_count[post_categories]) == "undefined")
    {
        categories_count[post_categories] =0;
    }
    for(var key in categories_count)
    {
        if (key.length <= post_categories.length)
        {
            if (post_categories.substring(0, key.length) 
                == key.substring(0,key.length))
            {
                categories_count[key]+=1;
            }
        }
    }
    
    var post_categories = '/categories/study/linux/command';
    if (typeof(categories_count[post_categories]) == "undefined")
    {
        categories_count[post_categories] =0;
    }
    for(var key in categories_count)
    {
        if (key.length <= post_categories.length)
        {
            if (post_categories.substring(0, key.length) 
                == key.substring(0,key.length))
            {
                categories_count[key]+=1;
            }
        }
    }
    
    var post_categories = '/categories/study/linux/command';
    if (typeof(categories_count[post_categories]) == "undefined")
    {
        categories_count[post_categories] =0;
    }
    for(var key in categories_count)
    {
        if (key.length <= post_categories.length)
        {
            if (post_categories.substring(0, key.length) 
                == key.substring(0,key.length))
            {
                categories_count[key]+=1;
            }
        }
    }
    

    create_categories(categories, 0, categories_count);
    //document.write("hello")
  </script>
</aside>
</td-->
                <td id="td_posts" colspan="6" valign="top">
		  <article>
  <h1 id='header1' style="text-align: center;">
      小米路由器DIY
  </h1>
  <hr id='title_line'>
  <div>
    

<style type="text/css">
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #0c0;
    box-shadow: 1px 1px 1px #0e0;
    padding: 8pt;
    font-family: italic monospace;
    color: #C7EDCC;
    background-color: #111111;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: black;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
    code {
        border:groove #555555;
	border-width:thin;
        background-color: #111111;
	color: #C7EDCC;
    }


#table-of-contents {
    font-size: 9pt;
    position: fixed;
    right: 10px;
    top: 14em;
    margin:0;
    padding:0;
    border-width:1px;
    border-style:solid;
    background: #000000;
    -webkit-box-shadow: 0 0 1em #777777;
    -moz-box-shadow: 0 0 1em #777777;
    -webkit-border-bottom-left-radius: 5px;
    -moz-border-radius-bottomleft: 5px;
    text-align: right;
    /* ensure doesn't flow off the screen when expanded */
    max-height: 60%;
    overflow: auto; 
    z-index: 200;
}

#table-of-contents h2 {
    font-size: 9pt;
    max-width: 8em;
    font-weight: normal;
    padding-left: 0.5em;
    padding-top: 0.05em;
    padding-bottom: 0.05em; 
}

#table-of-contents ul {
    margin-left: 14pt; 
    margin-bottom: 10pt;
    padding: 0
}

#table-of-contents li {
    padding: 0;
    margin: 1px;
    list-style: none;
}

#table-of-contents ul>:first-child {
    color: blue;
}

#table-of-contents #text-table-of-contents {
    display: none;
    text-align: left;
}

#table-of-contents:hover #text-table-of-contents {
    display: block;
    padding: 0.5em;
    margin-top: -1.5em; 
}

</style>

<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgheadline1">1. 小米路由器ssh开启</a>
<ul>
<li><a href="#orgheadline2">1.1. 烧写开发板</a>
<ul>
<li><a href="#orgheadline3">1.1.1. 网址：ROM 2.0 开发版</a></li>
<li><a href="#orgheadline4">1.1.2. 烧写：</a></li>
<li><a href="#orgheadline5">1.1.3. 总结：</a></li>
</ul>
</li>
<li><a href="#orgheadline6">1.2. 烧写ssh</a>
<ul>
<li><a href="#orgheadline7">1.2.1. 网址：MiWiFi开放平台</a></li>
<li><a href="#orgheadline8">1.2.2. 下载：</a></li>
<li><a href="#orgheadline9">1.2.3. 烧写：</a></li>
<li><a href="#orgheadline10">1.2.4. 总结：</a></li>
</ul>
</li>
<li><a href="#orgheadline11">1.3. 访问文件系统权限</a></li>
</ul>
</li>
<li><a href="#orgheadline12">2. 小米路由器防火墙配置</a>
<ul>
<li><a href="#orgheadline13">2.1. 开启端口</a></li>
<li><a href="#orgheadline14">2.2. 端口转发</a></li>
<li><a href="#orgheadline15">2.3. 禁用端口</a></li>
</ul>
</li>
<li><a href="#orgheadline16">3. 使用opkg在小米路由器软件管理</a>
<ul>
<li><a href="#orgheadline17">3.1. 配置软件源地址</a></li>
<li><a href="#orgheadline18">3.2. 用opkg在小米路由器(openwrt)上进行软件管理</a></li>
<li><a href="#orgheadline19">3.3. 软件管理中遇到的问题</a>
<ul>
<li><a href="#orgheadline20">3.3.1. 找不到软件，则需更换软件源</a></li>
<li><a href="#orgheadline21">3.3.2. 无法安装，则需配置架构信息</a></li>
<li><a href="#orgheadline22">3.3.3. 安装成功，无法运行，需要更换二进制文件，使之支持当前路由器 cpu 架构</a></li>
</ul>
</li>
<li><a href="#orgheadline23">3.4. 参考资料</a></li>
</ul>
</li>
<li><a href="#orgheadline24">4. 小米路由器交叉编译环境配置</a></li>
<li><a href="#orgheadline25">5. 在小米路由器上搭建基于LNMP的Owncloud云平台</a>
<ul>
<li><a href="#orgheadline26">5.1. PC上搭建Owncloud</a>
<ul>
<li><a href="#orgheadline27">5.1.1. 安装openssl</a></li>
<li><a href="#orgheadline28">5.1.2. 安装php所需依赖</a></li>
<li><a href="#orgheadline29">5.1.3. 编译、安装php</a></li>
<li><a href="#orgheadline30">5.1.4. 安装nginx所需依赖</a></li>
<li><a href="#orgheadline31">5.1.5. 编译、安装nginx</a></li>
<li><a href="#orgheadline32">5.1.6. Mysql的root帐号建立</a></li>
<li><a href="#orgheadline33">5.1.7. php的配置和运行</a></li>
<li><a href="#orgheadline34">5.1.8. ssl key文件的生成</a></li>
<li><a href="#orgheadline35">5.1.9. nginx的配置和运行</a></li>
<li><a href="#orgheadline36">5.1.10. 搭建owncloud网站</a></li>
<li><a href="#orgheadline37">5.1.11. 安装Owncloud</a></li>
</ul>
</li>
<li><a href="#orgheadline38">5.2. 小米路由器上搭建Owncloud</a>
<ul>
<li><a href="#orgheadline39">5.2.1. 准备交叉编译环境</a></li>
<li><a href="#orgheadline40">5.2.2. 下载相关软件包</a></li>
<li><a href="#orgheadline41">5.2.3. 交叉编译安装MySql</a></li>
<li><a href="#orgheadline42">5.2.4. 交叉编译安装PHP</a></li>
<li><a href="#orgheadline43">5.2.5. 交叉编译安装nginx</a></li>
<li><a href="#orgheadline44">5.2.6. 部署到小米路由器上的内容</a></li>
</ul>
</li>
<li><a href="#orgheadline45">5.3. 参考资料</a></li>
</ul>
</li>
<li><a href="#orgheadline46">6. 小米路由器上使用 <code>git</code> 版本控制系统</a>
<ul>
<li><a href="#orgheadline47">6.1. 下载 <code>git</code> 源码</a></li>
<li><a href="#orgheadline48">6.2. 非交叉编译 <code>git</code> 过程</a></li>
<li><a href="#orgheadline49">6.3. 交叉编译 <code>git</code></a>
<ul>
<li><a href="#orgheadline50">6.3.1. 配置交叉编译环境路径</a></li>
<li><a href="#orgheadline51">6.3.2. 生成配置脚本</a></li>
<li><a href="#orgheadline52">6.3.3. 编译、安装</a></li>
<li><a href="#orgheadline53">6.3.4. 部署与配置</a></li>
<li><a href="#orgheadline54">6.3.5. <span class="todo nilWAIT_FORWARD">WAIT/FORWARD</span> FAQ <code>[%]</code><code>[/]</code></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgheadline55">7. Misc</a>
<ul>
<li><a href="#orgheadline56">7.1. 小米路由器添加ddns</a></li>
<li><a href="#orgheadline57">7.2. 小米路由器修改ssh启动的欢迎语</a></li>
</ul>
</li>
<li><a href="#orgheadline58">8. <span class="todo nilWAIT_FORWARD">WAIT/FORWARD</span> FAQ <code>[12/19]</code> <code>[63%]</code></a>
<ul>
<li><a href="#orgheadline59">8.1. <span class="done nilDONE">DONE</span> 小米路由如何开启ssh?</a>
<ul>
<li><a href="#orgheadline60">8.1.1. 下面内容仅参考暂不用</a></li>
</ul>
</li>
<li><a href="#orgheadline61">8.2. <span class="done nilDONE">DONE</span> 小米路由器防火墙如何配置?</a></li>
<li><a href="#orgheadline62">8.3. <span class="done nilDONE">DONE</span> 小米路由如何添加域名访问？</a></li>
<li><a href="#orgheadline63">8.4. <span class="done nilDONE">DONE</span> 小米路由器交叉编译环境配置</a></li>
<li><a href="#orgheadline64">8.5. <span class="done nilDONE">DONE</span> 如何使用软件管理工具管理小米路由上的软件?</a></li>
<li><a href="#orgheadline65">8.6. <span class="done nilDONE">DONE</span> 开启ssh后无法获得系统文件夹写入权限?</a></li>
<li><a href="#orgheadline66">8.7. <span class="done nilDONE">DONE</span> 在小米路由器上搭建基于LNMP的Owncloud云平台</a></li>
<li><a href="#orgheadline67">8.8. <span class="done nilCANCEL">CANCEL</span> Myowncloud</a>
<ul>
<li><a href="#orgheadline68">8.8.1. site: &lt;暂不可用&gt;</a></li>
<li><a href="#orgheadline69">8.8.2. step</a></li>
<li><a href="#orgheadline70">8.8.3. refer</a></li>
</ul>
</li>
<li><a href="#orgheadline71">8.9. <span class="done nilCANCEL">CANCEL</span> owncloud升级</a></li>
<li><a href="#orgheadline72">8.10. <span class="done nilCANCEL">CANCEL</span> owncloud issue</a></li>
<li><a href="#orgheadline73">8.11. <span class="done nilDONE">DONE</span> 如何小米路由器上使用 <code>git</code> 版本控制系统?</a></li>
<li><a href="#orgheadline74">8.12. <span class="todo nilMAYBE_FUTURE">MAYBE/FUTURE</span> 交叉编译mysql-5.7.11</a>
<ul>
<li><a href="#orgheadline75">8.12.1. try cmake</a></li>
</ul>
</li>
<li><a href="#orgheadline76">8.13. <span class="todo nilLATER">LATER</span> 小米路由器搭建ftp服务</a>
<ul>
<li><a href="#orgheadline77">8.13.1. 交叉编译环境</a></li>
<li><a href="#orgheadline78">8.13.2. 源代码下载：</a></li>
<li><a href="#orgheadline79">8.13.3. 编译libcrypt</a></li>
<li><a href="#orgheadline80">8.13.4. 修改Makefile</a></li>
<li><a href="#orgheadline81">8.13.5. 编译</a></li>
<li><a href="#orgheadline82">8.13.6. 开启防火墙</a></li>
<li><a href="#orgheadline83">8.13.7. 如何运行？</a></li>
<li><a href="#orgheadline84">8.13.8. </a></li>
</ul>
</li>
<li><a href="#orgheadline85">8.14. <span class="todo nilMAYBE_FUTURE">MAYBE/FUTURE</span> 交叉编译vim</a></li>
<li><a href="#orgheadline86">8.15. <span class="todo nilNEXT">NEXT</span> Seafile</a>
<ul>
<li><a href="#orgheadline87">8.15.1. <span class="done nilDONE">DONE</span> PC 上安装Seafile</a></li>
<li><a href="#orgheadline88">8.15.2. 编译Seafile</a></li>
<li><a href="#orgheadline89">8.15.3. 交叉编译Seafile</a></li>
<li><a href="#orgheadline90">8.15.4. 参考资料</a></li>
</ul>
</li>
<li><a href="#orgheadline91">8.16. <span class="todo nilWAIT_FORWARD">WAIT/FORWARD</span> SparkleShare</a>
<ul>
<li><a href="#orgheadline92">8.16.1. <span class="done nilCANCEL">CANCEL</span> PC上的编译安装</a></li>
<li><a href="#orgheadline93">8.16.2. Ubuntu上直接安装</a></li>
<li><a href="#orgheadline94">8.16.3. 参考网址：</a></li>
</ul>
</li>
<li><a href="#orgheadline95">8.17. <span class="todo nilMAYBE_FUTURE">MAYBE/FUTURE</span> dvcs-autosync</a></li>
<li><a href="#orgheadline96">8.18. <span class="done nilCANCEL">CANCEL</span> git annex</a>
<ul>
<li><a href="#orgheadline97">8.18.1. 源代码</a></li>
<li><a href="#orgheadline98">8.18.2. 参考资料</a></li>
</ul>
</li>
<li><a href="#orgheadline99">8.19. <span class="todo nilMAYBE_FUTURE">MAYBE/FUTURE</span> git lfs</a></li>
</ul>
</li>
</ul>
</div>
</div>

<p>
原文参考：<a href="http://vaqeteart.github.io/categories/study/linux/misc/xiaomi_router_tips.html">小米路由器DIY</a>
</p>

<p>
曾经还以为自己是一枚成长迅速的米粉，但是渐渐却发现，我不适合做为米粉。
</p>

<p>
尽管购买过红米手机、但是我现在觉得目前使用魅蓝更好用。
</p>

<p>
尽管之前购买了小米路由、小蚁摄像机、小米插排……现在也正在使用着，
</p>

<p>
但这并不表示我忠爱小米，只能说我是一个小米“受害者”，宣传的力量真是不可忽视。
</p>

<p>
我相信小米也有它自己的好处，但是真的觉得它不适合我，
</p>

<p>
在这台路由器上如此折腾，只是不得不使用已经花钱用买过的东西，很大程度上也可能是因为对Linux的兴趣。
</p>

<p>
这个文章没有贬低小米的意思，更无意与人争执，只是最开始表达一些个人的情绪，不喜者，可以略过。
</p>

<p>
分享此文出来供喜欢和不喜欢小米的朋友们参考，以及自己记录。
</p>

<p>
通过此文，可以让专业和有些专业背景的朋友们了解如下内容：
</p>

<ul class="org-ul">
<li>如何在特定平台上进行交叉编译，实现源码跨平台运行</li>
<li>如何在特定平台上搭建自己的云存储体系</li>
<li>如何在特定平台上搭建 <code>php/nginx</code> 提供web服务</li>
<li>如何在特定平台上搭建 <code>mysql</code> 数据库</li>
<li>如何在特定平台上搭建基于 <code>git</code> 的管理代码仓库服务</li>
<li>其它，待更新</li>
</ul>

<p>
这里的特定平台，小米路由器上实践，在其它 <code>openwrt</code> 或者 <code>linux</code> 系统上，应当能够类似实现。
</p>

<p>
接下来主要介绍在小米路由器上面讲述有关这些方面的问题。
</p>

<div id="outline-container-orgheadline1" class="outline-2">
<h2 id="orgheadline1"><a id="ID-e920b849-4dc8-4385-8644-9ba243894764"></a><span class="section-number-2">1</span> 小米路由器ssh开启</h2>
<div class="outline-text-2" id="text-1">
<p>
开启ssh访问，小米路由器需升级到开发版0.5.28及以上，小米路由器mini需升级到开发版0.3.84及以上。注意：稳定版不支持。
</p>
</div>

<div id="outline-container-orgheadline2" class="outline-3">
<h3 id="orgheadline2"><span class="section-number-3">1.1</span> 烧写开发板</h3>
<div class="outline-text-3" id="text-1-1">
<p>

</p>
</div>

<div id="outline-container-orgheadline3" class="outline-4">
<h4 id="orgheadline3"><span class="section-number-4">1.1.1</span> 网址：<a href="http://www1.miwifi.com/miwifi_download.html">ROM 2.0 开发版</a></h4>
<div class="outline-text-4" id="text-1-1-1">
<p>
下载：<a href="http://bigota.miwifi.com/xiaoqiang/rom/r2d/brcm4709_r2d_all_6c01b_2.11.67.bin">http://bigota.miwifi.com/xiaoqiang/rom/r2d/brcm4709_r2d_all_6c01b_2.11.67.bin</a>
</p>
</div>
</div>

<div id="outline-container-orgheadline4" class="outline-4">
<h4 id="orgheadline4"><span class="section-number-4">1.1.2</span> 烧写：</h4>
<div class="outline-text-4" id="text-1-1-2">
<pre class="example">
U盘刷机步骤：
1、准备一个系统格式为FAT或FAT32的U盘；
2、到小米路由器的官网miwifi.com下载用来进行刷机的ROM包；
重要的事情再说三遍：U盘刷机会清空硬盘上的数据！会清空硬盘上的数据！！会清空硬盘上的数据！！！
3、将下载好的ROM包放到U盘的根目录下，并命名为“miwifi.bin”；
4、对于指示灯为红色闪烁或者红色常亮的情况，直接将U盘插入路由器的USB接口，用细长的工具按住reset，待路由器指示灯变为黄灯闪烁时，松开reset；对于指示灯为其他状态的情况，需要先断开路由器的电源后，将U盘插入路由器的USB接口，用细长的工具按住reset，接通电源，待路由器指示灯变为黄灯闪烁时，松开reset
5、大约3-5分钟后，指示灯变成黄色常亮状态时可以拔掉U盘，此时刷机已经完成正在重启，稍等片刻路由器指示灯变蓝就可以正常使用了。
如果在刷机过程中，指示灯黄灯闪烁几秒后变为黄灯常亮状态，说明此次U盘刷机过程失败，请检查以上的刷机过程并重新进行刷机操作。
</pre>
</div>
</div>

<div id="outline-container-orgheadline5" class="outline-4">
<h4 id="orgheadline5"><span class="section-number-4">1.1.3</span> 总结：</h4>
<div class="outline-text-4" id="text-1-1-3">
<ol class="org-ol">
<li>下载rom</li>
<li>拷贝到u盘</li>
<li>路由器断电、插入u盘(fat32格式)</li>
<li>按住reset上电</li>
<li>等待黄灯闪烁，松开reset</li>
<li>一直等待，直至蓝灯。</li>
</ol>
</div>
</div>
</div>
<div id="outline-container-orgheadline6" class="outline-3">
<h3 id="orgheadline6"><span class="section-number-3">1.2</span> 烧写ssh</h3>
<div class="outline-text-3" id="text-1-2">
<p>

</p>
</div>

<div id="outline-container-orgheadline7" class="outline-4">
<h4 id="orgheadline7"><span class="section-number-4">1.2.1</span> 网址：<a href="http://www.miwifi.com/miwifi_open.html">MiWiFi开放平台</a></h4>
</div>

<div id="outline-container-orgheadline8" class="outline-4">
<h4 id="orgheadline8"><span class="section-number-4">1.2.2</span> 下载：<a href="https://d.miwifi.com/rom/ssh">https://d.miwifi.com/rom/ssh</a></h4>
</div>

<div id="outline-container-orgheadline9" class="outline-4">
<h4 id="orgheadline9"><span class="section-number-4">1.2.3</span> 烧写：</h4>
<div class="outline-text-4" id="text-1-2-3">
<pre class="example">
工具包使用方法：小米路由器需升级到开发版0.5.28及以上，小米路由器mini需升级到开发版0.3.84及以上。注意：稳定版不支持。
    请将下载的工具包bin文件复制到U盘（FAT/FAT32格式）的根目录下，保证文件名为miwifi_ssh.bin；
    断开小米路由器的电源，将U盘插入USB接口；
    按住reset按钮之后重新接入电源，指示灯变为黄色闪烁状态即可松开reset键；
    等待3-5秒后安装完成之后，小米路由器会自动重启，之后您就可以尽情折腾啦 ：）
</pre>
</div>
</div>

<div id="outline-container-orgheadline10" class="outline-4">
<h4 id="orgheadline10"><span class="section-number-4">1.2.4</span> 总结：</h4>
<div class="outline-text-4" id="text-1-2-4">
<ol class="org-ol">
<li>下载rom</li>
<li>拷贝到u盘</li>
<li>路由器断电、插入u盘(fat32格式)</li>
<li>按住reset上电</li>
<li>等待黄灯闪烁，松开reset</li>
<li>一直等待，直至蓝灯。</li>
</ol>
</div>
</div>
</div>
<div id="outline-container-orgheadline11" class="outline-3">
<h3 id="orgheadline11"><a id="ID-438b20dc-9055-47e1-98f3-bb98d31183fa"></a><span class="section-number-3">1.3</span> 访问文件系统权限</h3>
<div class="outline-text-3" id="text-1-3">
<p>
开启ssh后无法获得系统文件夹写入权限，只能读写外接硬盘的内容。这对有时候系统级别的配置不太方便。
</p>

<p>
这主要是因为挂载的时候，以只读方式挂载了相应的目录，执行下述命令即可：
</p>
<div class="org-src-container">

<pre class="src src-sh">$mount -o remount -rw /
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline12" class="outline-2">
<h2 id="orgheadline12"><a id="ID-8ba30038-f09d-4780-81ce-54f2c062f789"></a><span class="section-number-2">2</span> 小米路由器防火墙配置</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-orgheadline13" class="outline-3">
<h3 id="orgheadline13"><span class="section-number-3">2.1</span> 开启端口</h3>
<div class="outline-text-3" id="text-2-1">
<pre class="example">
使用WinSCP软件进入192.168.31.1 端口22，用户名 root 密码 admin 文件协议改为SCP进入,进入后打开/etc/config/firewall
这个文件的尾部增加：

    config rule 'httpdwan'      
    	option src 'wan'     
    	option dest_port '8088'
    	option proto 'tcp'
    	option target 'ACCEPT'
    	option name ''\''httpd wan accept tcp port 8088'\'''

保存后，SSH到路由的22端口执行 /etc/init.d/firewall restart 重启防火墙。
</pre>

<p>
参考：<a href="http://www.laohao.info/xiao-mi-lu-you-qi-fang-huo-qiang-kai-qi-duan-kou-rang-wai-bu-wang-luo-fang-wen-ni-di-xiao-mi-lu-you/">小米路由器防火墙开启端口，让外部网络访问你的小米路由</a>
</p>
</div>
</div>

<div id="outline-container-orgheadline14" class="outline-3">
<h3 id="orgheadline14"><span class="section-number-3">2.2</span> 端口转发</h3>
<div class="outline-text-3" id="text-2-2">
<p>
修改 <code>/etc/config/firewall</code>
</p>
<pre class="example">
# port redirect of remapped ssh port (22001) on wan
config redirect 'myssh'
option src wan
option src_dport 10022
option dest lan
option dest_port 22
option proto tcp
</pre>

<p>
重启防火墙 <code>/etc/init.d/firewall restart</code>
</p>

<p>
参考 <a href="http://jingyan.baidu.com/article/9113f81b3a5d982b3314c74a.html?st=3&amp;net_type=2&amp;bd_page_type=1&amp;os=0&amp;showimg=1&amp;rst=6">小米路由器mini如何设置外网访问ssh</a>
</p>
</div>
</div>

<div id="outline-container-orgheadline15" class="outline-3">
<h3 id="orgheadline15"><a id="ID-302570f5-16c1-4874-90df-b413b2dca2f0"></a><span class="section-number-3">2.3</span> 禁用端口</h3>
<div class="outline-text-3" id="text-2-3">
<p>
默认端口不对外开放。
</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline16" class="outline-2">
<h2 id="orgheadline16"><a id="ID-1beeb842-72bd-4682-b3b0-cabca3dd0b6c"></a><span class="section-number-2">3</span> 使用opkg在小米路由器软件管理</h2>
<div class="outline-text-2" id="text-3">
<p>
小米路由器系统是openwrt系统，该系统基于linux，使用 <code>opkg</code> 工具实现软件管理，该工具类似ubuntu中的 <code>apt-get</code> 或者centeros 中的 <code>yum</code> 工具。
</p>

<p>
目前的现状其实是：找不到适合xiaomi路由器架构的合适的软件源，通过openwrt的所有软件源中相应交叉工具链的信息，发现很难找到和小米路由器相符的软件。这样的结果是，即使使用某一个软件源，强行配置将对应软件安装到小米路由器中，也无法运行。 最稳妥的方式还是使用小米路由器提供的交叉编译工具链，通过源代码交叉编译要使用的软件包，这需要一些专业技术（例如如何通过autotools 配置交叉编译选项等等）， 所以对于小米路由器，普通用户其实也很难自由的安装所需软件。下面给出的信息，也算为遇到相关问题的同仁提供一个参考。
</p>

<p>
使用opkg管理软件的大致方式如下
</p>
</div>

<div id="outline-container-orgheadline17" class="outline-3">
<h3 id="orgheadline17"><span class="section-number-3">3.1</span> 配置软件源地址</h3>
<div class="outline-text-3" id="text-3-1">
<p>
配置文件为 <code>/etc/opkg.conf</code>, 下面是一个配置文件完整的例子：
</p>
<pre class="example">
#src/gz attitude_adjustment http://downloads.openwrt.org/attitude_adjustment/12.09/brcm4709/R2D/packages
#src/gz attitude_adjustment http://downloads.openwrt.org/attitude_adjustment/12.09/brcm63xx/generic/packages
src/gz attitude_adjustment http://downloads.openwrt.org/attitude_adjustment/12.09/brcm47xx/generic/packages
#src/gz attitude_adjustment http://downloads.openwrt.org/attitude_adjustment/12.09/omap4/generic/packages
dest root /data
dest ram /tmp
lists_dir ext /data/var/opkg-lists
option overlay_root /data

arch all 1
arch noarch 1
arch brcm4709 10
arch brcm47xx 100
arch brcm53xx 110
arch brcm63xx 120
arch omap4 130
</pre>
<p>
这里的含义不言而喻，最关键的还是最开始列出的地址信息，指明了软件源中所包括的软件从哪里下载。这里为 <code>http://downloads.openwrt.org/attitude_adjustment/12.09/brcm47xx/generic/packages</code> 。其它为安装时的路径和架构信息，用到之时自然会明白。
</p>
</div>
</div>

<div id="outline-container-orgheadline18" class="outline-3">
<h3 id="orgheadline18"><span class="section-number-3">3.2</span> 用opkg在小米路由器(openwrt)上进行软件管理</h3>
<div class="outline-text-3" id="text-3-2">
<p>
<code>opkg</code> 使用方法类似 ubuntu下的 <code>apt-get</code>, 具体如下：
</p>
<ul class="org-ul">
<li><p>
更新软件源
当我们修改软件元配置文件 <code>/etc/opkg.conf</code> 中的软件源信息之后，需要更新本地软件源索引，才能继续后面的使用。命令如下：
</p>
<div class="org-src-container">

<pre class="src src-sh">#opkg update
</pre>
</div></li>

<li><p>
查看当前系统支持安装的架构
</p>
<div class="org-src-container">

<pre class="src src-sh">$opkg print-architecture
</pre>
</div>
<p>
只有符合这里列出的架构的软件包，才能被安装。
</p></li>

<li><p>
直接下载 <code>*.ipk</code> 安装
我们可以直接下载相应的 <code>*.ipk</code> 文件进行安装， 例如安装screen
</p>
<div class="org-src-container">

<pre class="src src-sh">$wget -c http://downloads.openwrt.org/attitude_adjustment/12.09/brcm47xx/generic/packages/screen_4.0.3-3_brcm47xx.ipk
#opkg install screen_4.2.1-2_ralink.ipk
</pre>
</div>
<p>
这里， <code>ipk</code> 文件的地址，通过软件源配置文件可以猜到。
</p></li>

<li><p>
通过软件源配置文件中的软件源库进行安装
配置好软件源库，并且更新后，不用将 <code>.ipk</code> 文件下载，直接可以如下安装：
</p>
<div class="org-src-container">

<pre class="src src-sh">#opkg install libgcc
#opkg install ./libc_0.9.33.2-1_brcm47xx.ipk 
#opkg install ./screen_4.0.3-3_brcm47xx.ipk
</pre>
</div>
<p>
安装之后，工具会在 <code>/data/usr/</code> 相关的子目录中。
</p></li>

<li><p>
查找软件源库中是否存在某软件
假设我们查找是否存在包含 <code>screen</code> 字样的软件，可如下：
</p>
<div class="org-src-container">

<pre class="src src-sh">#opkg find screen
</pre>
</div></li>

<li><p>
查看软件源库中所有的软件
</p>
<div class="org-src-container">

<pre class="src src-sh">#opkg list
</pre>
</div></li>

<li><p>
查看已经安装的软件
</p>
<div class="org-src-container">

<pre class="src src-sh">#opkg list-installed
</pre>
</div></li>

<li><p>
卸载
</p>
<div class="org-src-container">

<pre class="src src-sh">#opkg remove --autoremove screen
#opkg remove --autoremove --force-removal-of-essential-packages libc
#opkg remove --autoremove --force-removal-of-essential-packages libgcc
</pre>
</div>
<p>
这里对screen这样的普通程序，卸载之时可以加上 <code>--autoremove</code> 同时卸载掉无用的依赖。而对于 <code>libc</code> 这样的特殊库，需要再加额外选项才能强制卸载。
</p></li>

<li><p>
更多卸载的命令可以查看帮助信息：
</p>

<div class="org-src-container">

<pre class="src src-sh">$opkg
</pre>
</div></li>
</ul>
</div>
</div>

<div id="outline-container-orgheadline19" class="outline-3">
<h3 id="orgheadline19"><span class="section-number-3">3.3</span> 软件管理中遇到的问题</h3>
<div class="outline-text-3" id="text-3-3">
</div><div id="outline-container-orgheadline20" class="outline-4">
<h4 id="orgheadline20"><span class="section-number-4">3.3.1</span> 找不到软件，则需更换软件源</h4>
<div class="outline-text-4" id="text-3-3-1">
<p>
我们想安装某软件之前，只需找到包含该软件的相应软件源地址后，填入 <code>opkg.conf</code> 中即可，例如你可能会找到如下的源：
</p>
<pre class="example">
#src/gz attitude_adjustment http://downloads.openwrt.org/attitude_adjustment/12.09/brcm4709/R2D/packages
#src/gz attitude_adjustment http://downloads.openwrt.org.cn/PandoraBox/ralink/packages/packages
#src/gz attitude_adjustment http://downloads.openwrt.org/attitude_adjustment/12.09/brcm47xx/generic/packages
#src/gz attitude_adjustment http://downloads.openwrt.org/attitude_adjustment/12.09/brcm63xx/generic/packages
src/gz attitude_adjustment http://downloads.openwrt.org/snapshots/trunk/bcm53xx/generic/packages/packages
</pre>
<p>
使用其中一个即可。软件源中实际的软件包文件都是*.ipk格式，是事先用交叉编译方式编译好的二进制程序。
</p>
</div>
</div>


<div id="outline-container-orgheadline21" class="outline-4">
<h4 id="orgheadline21"><span class="section-number-4">3.3.2</span> 无法安装，则需配置架构信息</h4>
<div class="outline-text-4" id="text-3-3-2">
<p>
如果无法安装，可能是由于架构不匹配导致，需要通过命令 <code>opkg print-architecture</code> 查看当前系统支持的架构，再根据被安装的安装包名称，确定需支持的架构。
</p>

<p>
如果当前系统不支持被安装软件包所需支持的架构，那么则修改/etc/opkg.conf 添加类似如下：
</p>
<pre class="example">
arch all 100
arch brcm4716 200
arch brcm47xx 300
arch bcm53xx 310
</pre>
<p>
这里安装的软件包为 <code>screen_4.0.3-3_brcm47xx.ipk</code>, 通过名字可知其架构为 <code>brcm47xx</code>; 而添加的 <code>arch brcm47xx</code> 与该软件包的架构匹配。 添加之后，所以即可安装成功。
</p>

<p>
注意：
安装成功不代表可以成功运行，参见后面。
</p>

<p>
修改 <code>/etc/opkg.conf</code> 的操作会修改 <code>opkg print-architecture</code> 默认配置。根据列出的结果，依次按照优先级匹配相应的内容。
</p>
</div>
</div>

<div id="outline-container-orgheadline22" class="outline-4">
<h4 id="orgheadline22"><span class="section-number-4">3.3.3</span> 安装成功，无法运行，需要更换二进制文件，使之支持当前路由器 cpu 架构</h4>
<div class="outline-text-4" id="text-3-3-3">
<p>
前面配置好架构之后虽然能够安装软件，但是不一定能够运行。这里仍以 <code>screen</code> 为例，如果仍然无法运行 <code>screen</code> 。则需要确认一下其二进制文件中的cpu架构信息。
</p>

<ol class="org-ol">
<li><p>
将安装好的二进制文件 <code>screen</code>, 以及小米路由器上可运行的原生的 <code>busybox</code> 二进制文件拷贝到linux上，用 <code>file</code> 查看其架构是否一样。
这里如下，
</p>

<p>
<code>screen</code> 中的架构信息为：
</p>
<div class="org-src-container">

<pre class="src src-sh">$file screen
screen: ELF 32-bit LSB executable, MIPS, MIPS32 version 1, dynamically linked (uses shared libs), corrupted section header size
</pre>
</div>

<p>
而 <code>busybox</code> 中的架构信息为：
</p>
<div class="org-src-container">

<pre class="src src-sh">busybox: ELF 32-bit LSB executable, ARM, version 1 (SYSV), dynamically linked (uses shared libs), stripped
</pre>
</div>

<p>
可见 <code>screen</code> 无法运行，是由于实际cpu架构不一致问题（注意，这里的架构不是前面配置的架构，而是运行所需的实际架构），导致无法运行。
</p></li>

<li>解决方法有二：
<ul class="org-ul">
<li>直接用小米官网上提供的小米路由器对应的交叉编译工具链，结合相应软件（screen）源代码，编译出一个可执行的程序。</li>
<li>在openwrt相关软件源网站中，寻找能够和当前主机架构一致（或最接近）的架构的软件源。</li>
</ul></li>
</ol>


<ol class="org-ol">
<li>寻找匹配架构的软件源
这里不讲交叉编译的方法（事实上交叉编译的方法各个软件各不相同）。讲述当软件无法运行之时，如何找到可以运行的软件。

<ul class="org-ul">
<li>首先，需要确定当前小米路由器上的 <code>busybox</code> 支持的cpu架构。
如前所述，通过 <code>file</code> 命令，可以看到是 <code>ARM, version 1 (SYSV),...</code> 。只有二进制文件中的信息和此相一致之时，才可能运行得起来。</li>

<li><p>
其次，确认配置文件中，软件源中软件所支持的cpu架构。
当然，我们可以先配置好架构信息，将软件安装上，然后类似前面，通过 <code>file</code> 命令查看相应的软件程序所支持的架构。但是这样做，太麻烦了，每检查一个软件源，就需要安装该源的软件，并且查看。其实有更简单的方法。
</p>

<p>
我们前面配置中使用的是如下软件源： <code>src/gz attitude_adjustment http://downloads.openwrt.org/attitude_adjustment/12.09/brcm47xx/generic/packages</code>, 所以到 <code>http://downloads.openwrt.org/attitude_adjustment/12.09/brcm47xx/generic/</code> 中，看到如下类似的链接：
</p>
<pre class="example">
Parent directory/	-	-
packages/	-	09-Jul-2014 08:05
OpenWrt-ImageBuilder-brcm47xx-for-linux-i486.tar.bz2	355705874	03-Apr-2013 08:39
OpenWrt-SDK-brcm47xx-for-linux-i486-gcc-4.6-linaro_uClibc-0.9.33.2.tar.bz2	629822123	03-Apr-2013 08:39
OpenWrt-Toolchain-brcm47xx-for-mipsel-gcc-4.6-linaro_uClibc-0.9.33.2.tar.bz2
</pre>
<p>
这里，注意 <code>xxxToolchainxxx</code>, 由此可知，之前软件源配置中指定的软件源是mipsel相关的架构（这也和前面我们通过file命令中看到的结果一致），和我们的arm不一致。
</p>

<p>
用类似的方法可以找到合适的架构，比如我们看到 <code>http://downloads.openwrt.org/attitude_adjustment/12.09/omap4/generic/</code> 中的信息：
</p>
<pre class="example">
OpenWrt-Toolchain-omap4-for-arm_v7-a-gcc-4.6-linaro_uClibc-0.9.33.2_eabi.tar.bz2
</pre>
<p>
发现这个软件源采用的arm架构，大致上和我们小米路由器上显示的 <code>busybox</code> 的架构更为接近，所以这个软件源中的软件可能会在小米路由器上运行起来。当然这里只是一个例子，还需实践一下（重新配置软件源、添加omap4的架构配置、更新软件源、安装软件、运行），才能确定。
</p></li>
</ul></li>
</ol>
</div>
</div>
</div>

<div id="outline-container-orgheadline23" class="outline-3">
<h3 id="orgheadline23"><span class="section-number-3">3.4</span> 参考资料</h3>
<div class="outline-text-3" id="text-3-4">
<ul class="org-ul">
<li><p>
关于软件源的问题参考
</p>

<p>
<a href="http://www.right.com.cn/FORUM/thread-158625-1-1.html">http://www.right.com.cn/FORUM/thread-158625-1-1.html</a>
</p>

<p>
<a href="http://bbs.xiaomi.cn/t-9915018">http://bbs.xiaomi.cn/t-9915018</a>
</p></li>

<li><p>
关于适用与openwrt系统的已有软件源网址，可到如下网站结合自己机器实际情况比对寻找：
</p>

<p>
<a href="https://wiki.openwrt.org/doc/techref/opkg">https://wiki.openwrt.org/doc/techref/opkg</a>
</p>

<p>
<a href="http://downloads.openwrt.org/snapshots/trunk/bcm53xx/generic/packages/packages">http://downloads.openwrt.org/snapshots/trunk/bcm53xx/generic/packages/packages</a>
</p>

<p>
<a href="http://downloads.openwrt.org.cn/PandoraBox/ralink/packages/packages/">http://downloads.openwrt.org.cn/PandoraBox/ralink/packages/packages/</a>
</p>

<p>
<a href="http://downloads.openwrt.org/attitude_adjustment/12.09/brcm47xx/generic/packages/">http://downloads.openwrt.org/attitude_adjustment/12.09/brcm47xx/generic/packages/</a>
</p>

<p>
<a href="https://downloads.openwrt.org/chaos_calmer/15.05.1/bcm53xx/generic/packages/">https://downloads.openwrt.org/chaos_calmer/15.05.1/bcm53xx/generic/packages/</a>
</p></li>

<li><p>
关于配置软件架构参考
</p>

<p>
<a href="https://wiki.openwrt.org/doc/techref/opkg">https://wiki.openwrt.org/doc/techref/opkg</a> <code>Adjust Architecturesn</code> 部分的内容。
</p></li>

<li><p>
关于安装最新ipk包提示postinst出错解决方法参见
</p>

<p>
<a href="http://www.ddhow.com/blog/postinst.html">http://www.ddhow.com/blog/postinst.html</a>
</p></li>
</ul>
</div>
</div>
</div>

<div id="outline-container-orgheadline24" class="outline-2">
<h2 id="orgheadline24"><a id="ID-812a4b1a-4b1b-4521-9dd1-34e0371d07f9"></a><span class="section-number-2">4</span> 小米路由器交叉编译环境配置</h2>
<div class="outline-text-2" id="text-4">
<p>
配置好小米交叉编译环境，所有的软件基本上从源码级别上原生即可编译生成，无需上网寻找各种人家做好的软件包。是最理想安装软件的方法。
</p>

<ol class="org-ol">
<li><p>
下载
</p>

<p>
首先到官网网站： <a href="http://www.miwifi.com/miwifi_open.html">小米开放平台</a> 下载交叉编译工具链。根据自己的路由器型号选择其中的 "插件开发文档" 链接。
</p>
<div class="org-src-container">

<pre class="src src-sh">$mkdir -p /home/miracle/work/1_inbox/xiaomirouter/test
$cd /home/miracle/work/1_inbox/xiaomirouter/test
$wget -c http://bigota.miwifi.com/xiaoqiang/sdk/tools/package/sdk_package.zip
</pre>
</div></li>

<li><p>
设置交叉编译环境
</p>

<div class="org-src-container">

<pre class="src src-sh">$unzip sdk_package.zip
$export PATH=/home/miracle/work/1_inbox/xiaomirouter/test/sdk_package/toolchain/bin:$PATH
</pre>
</div>

<p>
这里设置交叉编译环境是为了让源代码通过该交叉编译工具进行编译，这样生成的可执行文件才符合小米路由器cpu的架构，能够在小米路由器上执行。而pc上直接编译生成的可执行文件只能在pc上执行（因为pc和小米路由器的cpu架构不同）。
</p></li>
</ol>

<p>
之后的内容，全部基于该交叉编译工具链进行。从源代码配置、编译、安装生成可运行的软件可执行文件，许多开源软件，基本都是利用GNU Auto tools工具进行，遵循 <code>configure</code>, <code>make</code>, <code>make install</code> 三部曲。
</p>
</div>
</div>

<div id="outline-container-orgheadline25" class="outline-2">
<h2 id="orgheadline25"><a id="ID-d116ddc3-b3c0-4a82-93e9-628e0ecc2f69"></a><span class="section-number-2">5</span> 在小米路由器上搭建基于LNMP的Owncloud云平台</h2>
<div class="outline-text-2" id="text-5">
<p>
Mega Sync、Box、DropBox、苹果icloud、微软Sky Driver、Google的GDriver、腾讯微云、百度云、新浪微盘、坚果云、金山快盘、七牛、115网盘、华为网盘、Ubuntu One、
</p>

<p>
这里介绍如何在小米路由器上搭建自己的个人云存储系统。
</p>

<p>
在此之前，需要注意云存储和云备份是有区别的。在参考英文原文： <code>Cloud services: How do they compare?（译者/刘旭坤）</code> 中提到：
</p>
<ol class="org-ol">
<li>云存储的目的是方便地在不同设备之间共享文件，并不意味着一定会在电脑或手机上创建备份。如果发生误删，可能文件永远也找不回来了。</li>
<li>云备份则不同，如果本地的文件删除了在云端还有。</li>
</ol>

<p>
这里主要侧重的是云存储功能的建立。
</p>

<p>
如果单纯是为了云存储功能的搭建，采用许多可用的服务即可，例如：ftp、webdav等等。这里采用云平台，是考虑到日后扩展而准备的。
</p>

<p>
Web Server：云存储一般都基于Web Server后端，对于Web服务器，考虑到在小米路由器上搭建个人云，也可能会在将来基于此搭建个人站点，这里主要需求是：开源、免费、稳定、以及资源占用少、并发度高、流行度高（比较容易找到学习资料）。比较著名的Web Server有Apache、Tomcat、nginx、lighthttpd……对比众多服务器以及需求之后，选择nginx做为服务器。
</p>

<p>
云平台的选择：对于云，这里的主要需求是，开源、核心功能免费、扩展性强（扩展功能可以收费）。比较流行的个人云平台工具如：seafile、own cloud、SparkleShare、WonderBox等等，在对比了许多的介绍和需求之后，选择Own Cloud做为云平台。
</p>

<p>
由于Own Cloud使用php完成，综上，搭建Own cloud平台，可基于LNMP环境（Linux+Nginx+Mysql+Php）进行。搭建好的Own Cloud云平台，由于其本身的可扩展特点，具有的功能除传统网盘（如百度云、DropBox）外，还能支持webdav服务，以及自行添加插件App，比如OwnNote（基于Owncloud的云笔记）、tasks（基于Owncloud的任务管理）等等，这些应用可在Owncloud第三方插件提供处找到，也可自己基于Owncloud的开放接口开发出来。
</p>

<p>
由于小米路由器Cpu架构与传统PC机不同，所以这里先介绍在PC上搭建LNMP环境以及安装Own Cloud的方法，了解到与平台无关的核心过程后，然后再具体介绍在小米路由器上进行。
</p>
</div>
<div id="outline-container-orgheadline26" class="outline-3">
<h3 id="orgheadline26"><span class="section-number-3">5.1</span> PC上搭建Owncloud</h3>
<div class="outline-text-3" id="text-5-1">
<p>
PC上的Owncloud在两个系统上进行过，即：Ubuntu和Center OS。除个别依赖库外，尽量采用源代码编译的方式进行，这样的过程比较“通用”，在各个平台上过程大同小异。过程大致如下：
</p>
</div>

<div id="outline-container-orgheadline27" class="outline-4">
<h4 id="orgheadline27"><span class="section-number-4">5.1.1</span> 安装openssl</h4>
<div class="outline-text-4" id="text-5-1-1">
<p>
下载： <code>$wget -c http://www.openssl.org/source/openssl-1.0.2g.tar.gz</code>
</p>

<p>
配置、编译、安装如下：
</p>
<div class="org-src-container">

<pre class="src src-sh">$tar -xzvf openssl-1.0.2g.tar.gz &amp;&amp; cd openssl-1.0.2g
$./config --prefix=/usr/local/develop/openssl-1.0.2g
$sudo make depend
$sudo make 
$sudo make install
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline28" class="outline-4">
<h4 id="orgheadline28"><a id="ID-ec1983bd-1420-45b1-b21a-9353e0b9015e"></a><span class="section-number-4">5.1.2</span> 安装php所需依赖</h4>
<div class="outline-text-4" id="text-5-1-2">
</div>
<div id="outline-container-orgheadline100" class="outline-5">
<h5 id="orgheadline100"><span class="section-number-5">5.1.2.1</span> 在 Ubuntu 12.04 上：</h5>
<div class="outline-text-5" id="text-5-1-2-1">
<div class="org-src-container">

<pre class="src src-sh">$sudo apt-get install libxml2
$sudo apt-get install libxml2-dev
$sudo apt-get install libxml2-utils
$sudo apt-get install libcurl3
$sudo apt-get install libcurl
$sudo apt-get install libcurl4-gnutls-dev
$sudo apt-get install libjpeg-dev
$sudo apt-get install libpng-dev
$sudo apt-get install libmcrypt-dev
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline101" class="outline-5">
<h5 id="orgheadline101"><span class="section-number-5">5.1.2.2</span> 在 Center OS 上：</h5>
<div class="outline-text-5" id="text-5-1-2-2">
<div class="org-src-container">

<pre class="src src-sh">$sudo yum install libxml2
$sudo yum install libxml2-devel
$sudo yum install libcurl
$sudo yum install libcurl-devel
$sudo yum install libjpeg-devel
$sudo yum install libpng-devel
$sudo yum install libfreetype-devel
</pre>
</div>

<p>
另外在Center OS上对mysql的安装与启动如下：
</p>
<div class="org-src-container">

<pre class="src src-sh">$yum install mariadb-server mariadb-libs mariadb
$systemctl start mariadb.service
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline29" class="outline-4">
<h4 id="orgheadline29"><span class="section-number-4">5.1.3</span> 编译、安装php</h4>
<div class="outline-text-4" id="text-5-1-3">
<p>
下载：<a href="http://php.net/get/php-5.6.19.tar.bz2/from/a/mirror">http://php.net/get/php-5.6.19.tar.bz2/from/a/mirror</a>
</p>

<p>
配置、编译、安装如下：
</p>
<div class="org-src-container">

<pre class="src src-sh">$./configure --prefix=/usr/local/develop/php-5.6.19 --with-config-file-path=/usr/local/develop/php-5.6.19/etc --enable-fpm --with-fpm-user=www-data --with-fpm-group=www-data --with-mysql=mysqlnd --with-mysqli=mysqlnd --with-pdo-mysql=mysqlnd --with-iconv-dir --with-freetype-dir --with-jpeg-dir --with-png-dir --with-zlib --with-libxml-dir=/usr --enable-xml --disable-rpath --enable-magic-quotes --enable-safe-mode --enable-bcmath --enable-shmop --enable-sysvsem --enable-inline-optimization --with-curl --with-curlwrappers --enable-mbregex --enable-mbstring --with-mcrypt --enable-ftp --with-gd --enable-gd-native-ttf --with-openssl=/usr/local/develop/openssl-1.0.2g --with-mhash --enable-pcntl --enable-sockets --with-xmlrpc --enable-zip --enable-soap --without-pear --with-gettext --disable-fileinfo
$sudo make
$sudo make install
</pre>
</div>

<p>
另外注：
如果遇到如下错误：
</p>
<pre class="example">
ext/openssl/.libs/xp_ssl.o: In function `php_select_crypto_method':
/home/miracle/myinstalled/php-5.6.19/ext/openssl/xp_ssl.c:947: undefined reference to `SSLv3_client_method'
/home/miracle/myinstalled/php-5.6.19/ext/openssl/xp_ssl.c:947: undefined reference to `SSLv3_server_method'
</pre>

<p>
那么编译安装如下：
</p>
<div class="org-src-container">

<pre class="src src-sh">$sudo make EXTRA_CFLAGS=-DOPENSSL_NO_SSL3
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline30" class="outline-4">
<h4 id="orgheadline30"><span class="section-number-4">5.1.4</span> 安装nginx所需依赖</h4>
<div class="outline-text-4" id="text-5-1-4">
<p>
下载：
</p>
<div class="org-src-container">

<pre class="src src-sh">$wget ftp://ftp.csx.cam.ac.uk/pub/software/programming/pcre/pcre-8.38.tar.gz
$wget http://apache.opencas.org//apr/apr-util-1.5.4.tar.gz
$wget http://mirrors.cnnic.cn/apache//apr/apr-1.5.2.tar.bz2
</pre>
</div>

<p>
配置、编译、安装如下：
</p>
<div class="org-src-container">

<pre class="src src-sh">$cd apr-1.5.2
$sudo ./configure --prefix=/usr/local/develop/apr-1.5.2
$sudo make
$sudo make install

$cd apr-util-1.5.4
$sudo ./configure --prefix=/usr/local/develop/apr-util-1.5.4 --with-apr=/usr/local/develop/apr-1.5.2
$sudo make
$sudo make install

$cd pcre-8.38
$sudo ./configure --prefix=/usr/local/develop/pcre-8.38 --with-apr=/usr/local/develop/apr-1.5.2 --with-apr-util=/usr/local/develop/apr-util-1.5.4
$sudo make
$sudo make install
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline31" class="outline-4">
<h4 id="orgheadline31"><span class="section-number-4">5.1.5</span> 编译、安装nginx</h4>
<div class="outline-text-4" id="text-5-1-5">
<p>
下载： <code>wget http://nginx.org/download/nginx-1.8.1.tar.gz</code>
</p>

<p>
配置、编译、安装：
</p>
<div class="org-src-container">

<pre class="src src-sh">$./configure --prefix=/usr/local/develop/nginx-1.8.1 --with-openssl=~/myinstalled/openssl-1.0.2g --with-pcre=~/myinstalled/pcre-8.38 --with-http_ssl_module
$sudo make
$sudo make install
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline32" class="outline-4">
<h4 id="orgheadline32"><span class="section-number-4">5.1.6</span> Mysql的root帐号建立</h4>
<div class="outline-text-4" id="text-5-1-6">
<ol class="org-ol">
<li><p>
启动mysqld服务
</p>
<div class="org-src-container">

<pre class="src src-sh">#service mysqld start
</pre>
</div>

<p>
当然，可以用 <code>stop</code> 参数停止，用 <code>restart</code> 参数重启mysqld服务。 
</p></li>
</ol>


<ol class="org-ol">
<li><p>
设置mysql管理员密码
</p>
<div class="org-src-container">

<pre class="src src-sh">#mysqladmin -u root password '123'
</pre>
</div>

<p>
这里首先启动mysqld服务，然后设置mysql数据库root帐号密码,密码为123。 数据库安装好后，我们应该为mysql数据库创建一个管理帐号。执行这个命令之后， mysql数据库的管理员是root，密码是123(实践发现，不让设置成root之外的名字，应该有其他的方法)。 
</p></li>

<li><p>
使用root用户登录mysql
</p>
<div class="org-src-container">

<pre class="src src-sh">#mysql --user=root --password=123 
或者
#mysql -uroot -p123 
或者
#mysql -uroot -p 
&lt;手动输入密码&gt;
</pre>
</div>
<p>
这里，假设root用户的密码是123,最后一个命令会提示你额外输入密码。这样会有 <code>mysql&gt;</code> 提示符号，提示你和mysql进行交互。操作这些命令的时候，应该把mysqld服务器打开。注意，如果是连接到另外的机器上，则需要加入一个参数 <code>-h</code> 机器IP。
</p></li>
</ol>

<p>
至此，mysql服务确认完毕。
</p>
</div>
</div>

<div id="outline-container-orgheadline33" class="outline-4">
<h4 id="orgheadline33"><span class="section-number-4">5.1.7</span> php的配置和运行</h4>
<div class="outline-text-4" id="text-5-1-7">
</div><div id="outline-container-orgheadline102" class="outline-5">
<h5 id="orgheadline102"><span class="section-number-5">5.1.7.1</span> 对mysql的配置</h5>
<div class="outline-text-5" id="text-5-1-7-1">
<p>
为了能够安装owncloud，需要做php对mysql支持的配置，将源代码解压包中的 <code>php.ini-development</code> 拷贝到安装好的目录中（ <code>/usr/local/develop/php-5.6.19/etc</code> ），命名为 <code>php.ini</code> 修改如下： <code>pdo_mysql.default_socket=/var/run/mysqld/mysqld.sock</code> 。
</p>

<p>
注意，这个mysql默认的socket路径，通过 <code>ls /var/run/mysqld</code> 发现是这个路径，也可能是别的路径，可以通过在 <code>/etc/mysql/my.cnf</code> 中查看到。
</p>

<p>
如果不进行这个配置，后面搭建好owncloud网站之后，设置的时候可能会出现类似如下错误：
</p>
<pre class="example">
ownCloud is not installed - only a limited number of commands are available
Error while trying to create admin user: Failed to connect to the database: An exception occured in driver: SQLSTATE[HY000] [2002] No such file or directory
 -&gt;
</pre>
</div>
</div>

<div id="outline-container-orgheadline103" class="outline-5">
<h5 id="orgheadline103"><span class="section-number-5">5.1.7.2</span> 运行php</h5>
<div class="outline-text-5" id="text-5-1-7-2">
<p>
运行 <code>./php-fpm.sh start</code>
</p>

<p>
停止 <code>./php-fpm.sh stop</code>
</p>

<p>
<code>php-fpm.sh</code> 脚本如下（根据自己的情况，将开头定义的 <code>$PHP_PATH</code> 等变量做相应修改）：
</p>
<div class="org-src-container">

<pre class="src src-sh">$cat /etc/init.d/php-fpm.sh 
#!/bin/sh
#
PHP_PATH=/userdisk/data/opt/usr/local/develop
DESC="php-fpm daemon"
NAME=php-fpm
# php-fpm
DAEMON=$PHP_PATH/sbin/$NAME
CONFIGFILE=$PHP_PATH/etc/php-fpm.conf
PIDFILE=/var/run/$NAME.pid

rh_start() {
  $DAEMON -c $PHP_PATH/etc -y $CONFIGFILE || echo -n " already running"
}

rh_stop() {
  kill -QUIT `cat $PIDFILE` || echo -n " not running"
}

case "$1" in
  start)
        echo -n "Starting $DESC: $NAME"
        rh_start
        echo "."
        ;;
  stop)
        echo -n "Stopping $DESC: $NAME"
        rh_stop
        echo "."
        ;;
  restart)
        echo -n "Restarting $DESC: $NAME"
        rh_stop
        sleep 1
        rh_start
        echo "."
        ;;
  *)
         echo "Usage: $SCRIPTNAME {start|stop|restart}" &gt;&amp;2
         exit 3
        ;;
esac
exit 0
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline34" class="outline-4">
<h4 id="orgheadline34"><span class="section-number-4">5.1.8</span> ssl key文件的生成</h4>
<div class="outline-text-4" id="text-5-1-8">
<p>
因为要使用https方式访问搭建的网站，需要生成ssl的认证文件，在后面配置nginx之时会用到。
</p>
<div class="org-src-container">

<pre class="src src-sh">$openssl genrsa -des3 -out server.key 1024
$openssl req -new -key server.key -out server.csr
$cp server.key server.key.org
$openssl rsa -in server.key.org -out server.key
$openssl x509 -req -days 365 -in server.csr -signkey server.key -out server.crt
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline35" class="outline-4">
<h4 id="orgheadline35"><span class="section-number-4">5.1.9</span> nginx的配置和运行</h4>
<div class="outline-text-4" id="text-5-1-9">
</div><div id="outline-container-orgheadline104" class="outline-5">
<h5 id="orgheadline104"><span class="section-number-5">5.1.9.1</span> 运行脚本</h5>
<div class="outline-text-5" id="text-5-1-9-1">
<p>
先给出运行nginx的脚本，后面会用到（根据自己的情况，将开头定义的 <code>$NGINX_BIN</code> 等变量做相应修改）。
</p>
<div class="org-src-container">

<pre class="src src-sh">$cat /etc/init.d/nginx.sh
#!/bin/sh

NGINX_BIN=/usr/local/develop/nginx-1.8.1/sbin/nginx
NGINX_CONF_FILE="/usr/local/develop/nginx-1.8.1/conf/nginx.conf"
NGINX_PREFIX="/usr/local/develop"

start() {
        #mkdir -p /var/log/nginx
        #mkdir -p /var/lib/nginx
        $NGINX_BIN -p $NGINX_PREFIX -c $NGINX_CONF_FILE
        return $?
}

stop() {
        $NGINX_BIN -p $NGINX_PREFIX -s stop
        return $?
}

reload() {
        $NGINX_BIN -p $NGINX_PREFIX -s reload
        return $?
}

shutdown() {
        $NGINX_BIN -p $NGINX_PREFIX -s quit
}

case "$1" in
    start)
        start &amp;&amp; echo "Start success" || echo "Start fail."
        ;;
    stop)
        stop &amp;&amp; echo "Stop success" || echo "Stop fail."
        ;;
    reload)
        reload &amp;&amp; echo "Reload success" || echo "Reload fail."
        ;;
    shutdown)
        shutdown
        ;;
    *)
        echo $"Usage: $0 {start|stop|reload|shutdown}"
        exit 2
esac
</pre>
</div>
</div>
</div>
<div id="outline-container-orgheadline105" class="outline-5">
<h5 id="orgheadline105"><span class="section-number-5">5.1.9.2</span> 测试网站</h5>
<div class="outline-text-5" id="text-5-1-9-2">
<ol class="org-ol">
<li><p>
先写一个测试的php脚本，用来检测是否正确。
</p>
<div class="org-src-container">

<pre class="src src-sh">$mkdir -p ~/nginx
$cd ~/nginx
$vim index.php
&lt;?php
    const CONSTANT = 'Hello World';
    echo CONSTANT;
    phpinfo();   
?&gt;
</pre>
</div></li>

<li><p>
在nginx上配置测试站点
</p>
<div class="org-src-container">

<pre class="src src-sh">$cd /usr/local/develop/nginx-1.8.1/conf/
$vim nginx.conf
...前面省略...
server {
        listen       18080;
          server_name localhost;

          location / {
                     root   /home/miracle/nginx;
                     index  index.php index.html;
        }
          location ~ \.php$ {
                     fastcgi_pass   127.0.0.1:9000;
                     fastcgi_index  index.php;
                     fastcgi_param  SCRIPT_FILENAME  /home/miracle/nginx$fastcgi_script_name;
                     include        fastcgi_params;
          }
}
....后面省略...
$/etc/init.d/nginx.sh start
</pre>
</div></li>

<li><p>
访问站点
</p>

<p>
经过前面配置之后，打开浏览器，输入 <code>http://localhost:18080</code> 若打开对应的测试站点并运行 <code>index.php</code> 脚本成功，说明配置成功。
</p></li>
</ol>
</div>
</div>
</div>
<div id="outline-container-orgheadline36" class="outline-4">
<h4 id="orgheadline36"><span class="section-number-4">5.1.10</span> 搭建owncloud网站</h4>
<div class="outline-text-4" id="text-5-1-10">
<p>
对前面LNMP环境建立并且测试完成之后，搭建owncloud网站其主要工作就是修改 <code>nginx.conf</code> 配置文件了。在owncloud官网上有一个对nginx的配置说明，这里给出当前实践过，并且好用的配置。不做过多解释,根据自身情况，做相应修改应当不难。
</p>
</div>
<div id="outline-container-orgheadline106" class="outline-5">
<h5 id="orgheadline106"><span class="section-number-5">5.1.10.1</span> OwnCloud相关软件和文档获取</h5>
<div class="outline-text-5" id="text-5-1-10-1">
<ol class="org-ol">
<li><p>
服务端：
</p>
<div class="org-src-container">

<pre class="src src-sh">$wget -c https://download.owncloud.org/community/owncloud-8.2.2.tar.bz2
</pre>
</div></li>

<li><p>
客户端
客户端有用于PC的Linux、Window，也有用于手机IOS、Android版本。IOS版本的OwnCloud客户端竟然是收费的，不过没有关系，搭建好的Owncloud支持webdav，可以随便寻找一款文件同步工具（比如foldersync等）实现客户端的功能，具体可在后面列出的参考资料中寻找。
</p>

<p>
官方客户端下载网址是：
</p>
<pre class="example">
https://software.opensuse.org/download/package?project=isv:ownCloud:desktop&amp;package=owncloud-client
</pre></li>

<li>文档
文档的下载和在线版本，可在如下网站获取： <code>https://doc.owncloud.org/</code></li>
</ol>
</div>
</div>

<div id="outline-container-orgheadline107" class="outline-5">
<h5 id="orgheadline107"><span class="section-number-5">5.1.10.2</span> 配置用于OwnCloud的Nginx配置选项</h5>
<div class="outline-text-5" id="text-5-1-10-2">
<div class="org-src-container">

<pre class="src src-sh">$cat /usr/local/develop/nginx-1.8.1/conf/nginx.conf
...前面省略
###myown cloud with ssl
        upstream php-handler {
                server 127.0.0.1:9000;
#server unix:/var/run/php5-fpm.sock;
        }

        server {
                listen 18000;
                server_name 172.16.246.39;
# enforce https
                return 301 https://$server_name$request_uri;
        }
        server {
                listen 443 ssl;
                server_name 172.16.246.39;
                ssl_certificate /usr/local/develop/nginx-1.8.1/conf/server.crt;
                ssl_certificate_key /usr/local/develop/nginx-1.8.1/conf/server.key;
# Add headers to serve security related headers
                add_header Strict-Transport-Security "max-age=15768000; includeSubDomains; preload;";
                add_header X-Content-Type-Options nosniff;
                add_header X-Frame-Options "SAMEORIGIN";
                add_header X-XSS-Protection "1; mode=block";
                add_header X-Robots-Tag none;
                add_header X-Download-Options noopen;
                add_header X-Permitted-Cross-Domain-Policies none;

# Path to the root of your installation
                root /media/sda6/mycloud/owncloud;
# set max upload size
                client_max_body_size 1G;
                fastcgi_buffers 64 4K;
# Disable gzip to avoid the removal of the ETag header
                gzip off;
# Uncomment if your server is build with the ngx_pagespeed module
# This module is currently not supported.
#pagespeed off;
                index index.php;
                error_page 403 /core/templates/403.php;
                error_page 404 /core/templates/404.php;
                rewrite ^/.well-known/carddav /remote.php/dav/ permanent;
                rewrite ^/.well-known/caldav /remote.php/dav/ permanent;
# The following 2 rules are only needed for the user_webfinger app.
# Uncomment it if you're planning to use this app.
#rewrite ^/.well-known/host-meta /public.php?service=host-meta last;
#rewrite ^/.well-known/host-meta.json /public.php?service=host-meta-json last;

                location = /robots.txt {
                        allow all;
                        log_not_found off;
                        access_log off;
                }

                location ~ ^/(build|tests|config|lib|3rdparty|templates|data)/ {
                        deny all;
                }

                location ~ ^/(?:\.|autotest|occ|issue|indie|db_|console) {
                        deny all;
                }

                location / {
                        rewrite ^/remote/(.*) /remote.php last;
                        rewrite ^(/core/doc/[^\/]+/)$ $1/index.html;
                        try_files $uri $uri/ =404;
                }

                location ~ \.php(?:$|/) {
                        fastcgi_split_path_info ^(.+\.php)(/.+)$;
                        include fastcgi_params;
                        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
                        fastcgi_param PATH_INFO $fastcgi_path_info;
                        fastcgi_param HTTPS on;
                        fastcgi_param modHeadersAvailable true; #Avoid sending the security headers twice
#fastcgi_pass   127.0.0.1:9000;
                                fastcgi_pass   php-handler;
                        fastcgi_intercept_errors on;
                }

                location ~* \.(?:css|js)$ {
                        add_header Cache-Control "public, max-age=7200";
# Add headers to serve security related headers
                        add_header Strict-Transport-Security "max-age=15768000; includeSubDomains; preload;";
                        add_header X-Content-Type-Options nosniff;
                        add_header X-Frame-Options "SAMEORIGIN";
                        add_header X-XSS-Protection "1; mode=block";
                        add_header X-Robots-Tag none;
                        add_header X-Download-Options noopen;
                        add_header X-Permitted-Cross-Domain-Policies none;
# Optional: Don't log access to assets
                        access_log off;
                }

# Optional: Don't log access to other assets
                location ~* \.(?:jpg|jpeg|gif|bmp|ico|png|swf)$ {
                        access_log off;
                }
        }
...后面省略
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgheadline37" class="outline-4">
<h4 id="orgheadline37"><span class="section-number-4">5.1.11</span> 安装Owncloud</h4>
<div class="outline-text-4" id="text-5-1-11">
<p>
具体安装过程以及期间遇到的问题，可参考文档进行，下面给出大致过程。
</p>
</div>
<div id="outline-container-orgheadline108" class="outline-5">
<h5 id="orgheadline108"><span class="section-number-5">5.1.11.1</span> 设置OwnCloud的安装目录</h5>
<div class="outline-text-5" id="text-5-1-11-1">
<p>
先将Owncloud解压，然后设置文件权限。需要设置owncloud中data和config目录等的用户和组为 <code>www-data</code> 。在文档中具体介绍了为什么要这样设置。这里简化起见，设置之后，再将权限设置为777，并不是最优方案。
</p>
<div class="org-src-container">

<pre class="src src-sh">$tar -xjvf owncloud-8.2.2.tar.bz2
$mv owncloud-8.2.2 /media/sda6/mycloud/owncloud
$cd /media/sda6/mycloud
$sudo chown -R www-data.www-data owncloud
$sudo chmod 777 -R owncloud
$mkdir oc_data
$sudo chown -R www-data.www-data oc_data
$sudo chmod 777 -R oc_data
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline111" class="outline-5">
<h5 id="orgheadline111"><span class="section-number-5">5.1.11.2</span> 配置Owncloud添加管理员账户</h5>
<div class="outline-text-5" id="text-5-1-11-2">
</div><ol class="org-ol"><li><a id="orgheadline109"></a>基本配置<br  /><div class="outline-text-6" id="text-5-1-11-2-1">
<p>
我们可以根据前面的 <code>nginx.conf</code> 设置，直接使用 <code>https://localhost</code> 访问，进入Owncloud初始设置界面。为便于描述，这里直接用命令行方式对其进行设置，效果相同。
</p>

<p>
命令实质是运行owncloud中的 <code>occ</code> php脚本，运行之时要以 <code>www-data</code> 身份进行（不同系统，可能为不同的http名称，参考官方文档）。如下：
</p>
<div class="org-src-container">

<pre class="src src-sh">$ cd /media/sda6/mycloud/owncloud
$ sudo -u www-data php occ maintenance:install --database "mysql" --database-name "ownclouddb" --database-user "root" --database-pass "&lt;之前设置的mysql数据库root密码&gt;" --admin-pass "&lt;owncloud 的管理员admin 账户密码&gt;" --data-dir "/media/sda6/mycloud/oc_data"
</pre>
</div>

<p>
上述命令是设置owncloud采用哪种数据库、使用的管理员账户是什么，以及数据存放的位置。运行之后，我们便可以登录 <code>https://localhost</code> 进行访问了。期间创建的文件数据都存放在 <code>media/sda6/mycloud/oc_data</code> 中，能够直接浏览。
</p>
</div></li>

<li><a id="orgheadline110"></a>额外配置<br  /><div class="outline-text-6" id="text-5-1-11-2-2">
<p>
如上配置之后，可以本地访问owncloud，但是如果想要实现远程其它机器也能访问，还需修改 <code>owncloud/config/config.php</code> 如下：
将
</p>
<pre class="example">
array (
    0 =&gt; 'localhost',
    ),
</pre>
<p>
修改为：
</p>
<pre class="example">
array (
    0 =&gt; 'localhost',
    1 =&gt; '112.74.19.38',
    ),
</pre>

<p>
这里， <code>112.74.19.38</code> 是本地机器对外的ip地址，也可使用DNS域名。
</p>
</div></li></ol>
</div>
</div>
</div>

<div id="outline-container-orgheadline38" class="outline-3">
<h3 id="orgheadline38"><span class="section-number-3">5.2</span> 小米路由器上搭建Owncloud</h3>
<div class="outline-text-3" id="text-5-2">
<p>
网上找到过别人搭建的Nginx环境，但是不能直接使用（还是需要php和mysql等其他环境），也用opkg 工具尝试过安装相关的工具，基本没有适用于自己架构的软件源（或者很难找到）。
</p>

<p>
最终还是完全从源代码开始，交叉编译、安装了所需的所有软件包和依赖库，完成LNMP下Own cloud环境的搭建，还是自给自足可靠，当前期间也参考了许多其他人的过程。
</p>
</div>
<div id="outline-container-orgheadline39" class="outline-4">
<h4 id="orgheadline39"><span class="section-number-4">5.2.1</span> 准备交叉编译环境</h4>
<div class="outline-text-4" id="text-5-2-1">
<p>
参考：<a href="#orgheadline63">小米路由器交叉编译环境配置</a>
</p>
</div>
</div>

<div id="outline-container-orgheadline40" class="outline-4">
<h4 id="orgheadline40"><span class="section-number-4">5.2.2</span> 下载相关软件包</h4>
<div class="outline-text-4" id="text-5-2-2">
<ul class="org-ul">
<li>State "INBOX"      from              <span class="timestamp-wrapper"><span class="timestamp">[2016-04-27 三 11:15]</span></span></li>
</ul>
<div class="org-src-container">

<pre class="src src-sh">$cd /home/miracle/work/1_inbox/xiaomirouter/test
$wget -c http://xmlsoft.org/sources/libxml2-2.7.8.tar.gz
$wget -c http://zlib.net/zlib-1.2.8.tar.gz
$wget -c ftp://ftp.csx.cam.ac.uk/pub/software/programming/pcre/pcre-8.38.tar.gz
$wget -c http://www.openssl.org/source/openssl-1.0.2g.tar.gz
$wget -c http://cn2.php.net/distributions/php-5.6.19.tar.xz
$wget -c https://curl.haxx.se/download/curl-7.48.0.tar.gz
$wget -c https://codeload.github.com/smart-make/libjpeg/zip/master
$wget -c http://iweb.dl.sourceforge.net/project/libpng/libpng16/1.6.21/libpng-1.6.21.tar.xz
$wget -c http://ftp.yzu.edu.tw/nongnu//freetype/freetype-2.6.3.tar.gz
$wget -c http://iweb.dl.sourceforge.net/project/mhash/mhash/0.9.9.9/mhash-0.9.9.9.tar.gz
$wget -c http://heanet.dl.sourceforge.net/project/mcrypt/Libmcrypt/2.5.8/libmcrypt-2.5.8.tar.bz2
$wget -c http://tenet.dl.sourceforge.net/project/mcrypt/MCrypt/2.6.8/mcrypt-2.6.8.tar.gz
$wget -c ftp://ftp.gnu.org/gnu/gettext/gettext-0.19.tar.gz
$wget -c http://heanet.dl.sourceforge.net/project/unixodbc/unixODBC/2.3.4/unixODBC-2.3.4.tar.gz
$wget -c http://nginx.org/download/nginx-1.8.1.tar.gz
</pre>
</div>
<p>
owncloud-8.2.2.tgz
</p>
</div>
</div>

<div id="outline-container-orgheadline41" class="outline-4">
<h4 id="orgheadline41"><span class="section-number-4">5.2.3</span> 交叉编译安装MySql</h4>
<div class="outline-text-4" id="text-5-2-3">
<p>
注意，这里编译的是 <code>mysql-5.1.72</code> 其它更新的版本可能没有相应的configure文件。
</p>
</div>
<div id="outline-container-orgheadline112" class="outline-5">
<h5 id="orgheadline112"><span class="section-number-5">5.2.3.1</span> 下载相关软件包</h5>
<div class="outline-text-5" id="text-5-2-3-1">
<div class="org-src-container">

<pre class="src src-sh">$wget -c http://mirror.hust.edu.cn/gnu/ncurses/ncurses-5.6.tar.gz
$wget -c http://cdn.mysql.com/archives/mysql-5.1/mysql-5.1.72.tar.gz
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline113" class="outline-5">
<h5 id="orgheadline113"><span class="section-number-5">5.2.3.2</span> 编译PC板的MySql</h5>
<div class="outline-text-5" id="text-5-2-3-2">
<div class="org-src-container">

<pre class="src src-sh">$tar -xzvf mysql-5.1.72.tar.gz 
$mv mysql-5.1.72/ mysql-5.1.72_pc
$cd mysql-5.1.72_pc
$./configure --prefix=/usr/local/develop/mysql-5.1.72
$make
</pre>
</div>
<p>
目的是为交叉编译过程顺利进行，这里先生成一个特殊的只能在pc上运行的工具。
</p>
</div>
</div>

<div id="outline-container-orgheadline115" class="outline-5">
<h5 id="orgheadline115"><span class="section-number-5">5.2.3.3</span> 交叉编译安装ncurses</h5>
<div class="outline-text-5" id="text-5-2-3-3">
<p>
这个工具需要先编译，这样后面的MySql和php对gettext的交叉编译才不会出现问题。
</p>
<div class="org-src-container">

<pre class="src src-sh">$tar -xzvf ncurses-5.6.tar.gz
$cd ncurses-5.6/
$./configure --host=arm-xiaomi-linux-uclibcgnueabi --prefix=/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop --enable-static CC=arm-xiaomi-linux-uclibcgnueabi-gcc
$make 
$make install
</pre>
</div>
</div>


<ol class="org-ol"><li><a id="orgheadline114"></a>交叉编译的MySql<br  /><div class="outline-text-6" id="text-5-2-3-3-1">
<ol class="org-ol">
<li><p>
首先修改configure文件，使之不会在交叉编译的时候运行测试软件
</p>
<div class="org-src-container">

<pre class="src src-sh">$tar -xzvf mysql-5.1.72.tar.gz 
$cd mysql-5.1.72
$vim configure
</pre>
</div>

<p>
因为交叉编译的程序无法在pc上运行，如果运行生成的测试软件，必然会由于无法运行而报错，导致后面步骤无法继续。
</p>

<p>
找到类似如下代码：
</p>
<pre class="example">
if test "$cross_compiling" = yes; then
{ { $as_echo "$as_me:$LINENO: error: in \`$ac_pwd':" &gt;&amp;5
$as_echo "$as_me: error: in \`$ac_pwd':" &gt;&amp;2;}
{ { $as_echo "$as_me:$LINENO: error: cannot run test program while cross compiling
See \`config.log' for more details." &gt;&amp;5
$as_echo "$as_me: error: cannot run test program while cross compiling
See \`config.log' for more details." &gt;&amp;2;}
{ (exit 1); exit 1; }; }; }
</pre>

<p>
修改为：
</p>
<pre class="example">
if test "$cross_compiling" = yes; then
echo "skip corss_compiling test";
</pre></li>

<li><p>
配置与编译
</p>
<div class="org-src-container">

<pre class="src src-sh">$./configure --prefix=/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop --without-docs --without-man --without-debug --with-charset=utf8 --with-extra-charsets=gbk,gb2312,utf8,ascii --enable-local-infile --with-mysqld-user=root --host=arm-xiaomi-linux-uclibcgnueabi --with-named-curses-libs=/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop/lib/libncurses.a CC=arm-xiaomi-linux-uclibcgnueabi-gcc
$make
</pre>
</div>

<p>
这里运行 <code>make</code> 编译时，会报类似如下错误：
</p>
<pre class="example">
make[2]:正在离开目录 `/home/miracle/work/1_inbox/xiaomirouter/test/mysql-5.1.72/sql'
./gen_lex_hash &gt; lex_hash.h-t
/bin/bash: ./gen_lex_hash: 无法执行二进制文件
make[1]: *** [lex_hash.h] 错误 126
make[1]:正在离开目录 `/home/miracle/work/1_inbox/xiaomirouter/test/mysql-5.1.72/sql'
</pre>

<p>
拷贝前面pc版本MySql中的gen_lex_hash继续：
</p>
<div class="org-src-container">

<pre class="src src-sh">$cp ../mysql-5.1.72_pc/sql/gen_lex_hash sqlmiracle@miracle-Zhaoyang-cd sql
$touch sql/gen_lex_hash
$cd ..
$make
</pre>
</div>

<p>
仍然可能报告如下错误：
</p>
<pre class="example">
sql_parse.cc:5741:21: error: 操作符‘&lt;’没有左操作数
#if STACK_DIRECTION &lt; 0
</pre>

<p>
修改如下：
</p>
<div class="org-src-container">

<pre class="src src-sh">$vim sql/sql_parse.cc
</pre>
</div>

<p>
将
</p>
<pre class="example">
5739 #ifndef EMBEDDED_LIBRARY
5740 
5741 #if STACK_DIRECTION &lt; 0                                                                                                                         
5742 #define used_stack(A,B) (long) (A - B)
5743 #else
5744 #define used_stack(A,B) (long) (B - A)
5745 #endif
</pre>

<p>
修改为
</p>
<pre class="example">
5739 #ifndef EMBEDDED_LIBRARY
5740 #define STACK_DIRECTION 1                                                                                                                       
5741 #if STACK_DIRECTION &lt; 0
5742 #define used_stack(A,B) (long) (A - B)
5743 #else
5744 #define used_stack(A,B) (long) (B - A)
5745 #endif
</pre>

<p>
然后继续编译、安装如下
</p>
<div class="org-src-container">

<pre class="src src-sh">$make
$make install
</pre>
</div>

<p>
至此，交叉编译版本的MySql编译安装完毕。
</p></li>
</ol>
</div></li></ol>
</div>
</div>

<div id="outline-container-orgheadline42" class="outline-4">
<h4 id="orgheadline42"><span class="section-number-4">5.2.4</span> 交叉编译安装PHP</h4>
<div class="outline-text-4" id="text-5-2-4">
</div><div id="outline-container-orgheadline116" class="outline-5">
<h5 id="orgheadline116"><span class="section-number-5">5.2.4.1</span> 交叉编译安装libxml</h5>
<div class="outline-text-5" id="text-5-2-4-1">
<p>
需要编译的版本是libxml2-2.7.8，更高的版本需要编译python。
</p>
<div class="org-src-container">

<pre class="src src-sh">$tar -xzvf libxml2-2.7.8.tar.gz 
$cd libxml2-2.7.8/
$./configure --host=arm-xiaomi-linux-uclibcgnueabi --enable-static --prefix=/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop CC=arm-xiaomi-linux-uclibcgnueabi-gcc
$make
$make install
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline117" class="outline-5">
<h5 id="orgheadline117"><span class="section-number-5">5.2.4.2</span> 交叉编译安装zlib</h5>
<div class="outline-text-5" id="text-5-2-4-2">
<div class="org-src-container">

<pre class="src src-sh">$export CC=arm-xiaomi-linux-uclibcgnueabi-gcc
$./configure  -static --prefix=/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop 
$make 
$make install
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline118" class="outline-5">
<h5 id="orgheadline118"><span class="section-number-5">5.2.4.3</span> 交叉编译安装pcre</h5>
<div class="outline-text-5" id="text-5-2-4-3">
<div class="org-src-container">

<pre class="src src-sh">$export CC=
$tar -xzvf pcre-8.38.tar.gz 
$cd pcre-8.38/
$./configure --host=arm-xiaomi-linux-uclibcgnueabi --enable-static --prefix=/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop CC=arm-xiaomi-linux-uclibcgnueabi-gcc
$make
$make install
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline119" class="outline-5">
<h5 id="orgheadline119"><span class="section-number-5">5.2.4.4</span> 交叉编译安装openssl</h5>
<div class="outline-text-5" id="text-5-2-4-4">
<div class="org-src-container">

<pre class="src src-sh">$tar -xzvf openssl-1.0.2g.tar.gz 
$cd openssl-1.0.2g/
$./Configure shared no-asm --prefix=/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop os/compiler:arm-xiaomi-linux-uclibcgnueabi-gcc
$make
$make install
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline120" class="outline-5">
<h5 id="orgheadline120"><span class="section-number-5">5.2.4.5</span> 交叉编译安装libcurl</h5>
<div class="outline-text-5" id="text-5-2-4-5">
<div class="org-src-container">

<pre class="src src-sh">$tar -xzvf curl-7.48.0.tar.gz 
$cd curl-7.48.0/
$./configure --host=arm-xiaomi-linux-uclibcgnueabi --enable-static --prefix=/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop CC=arm-xiaomi-linux-uclibcgnueabi-gcc
$make
$make install
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline121" class="outline-5">
<h5 id="orgheadline121"><span class="section-number-5">5.2.4.6</span> 交叉编译安装libjpeg</h5>
<div class="outline-text-5" id="text-5-2-4-6">
<div class="org-src-container">

<pre class="src src-sh">$unzip libjpeg-master.zip 
$cd libjpeg-master/
$./configure --host=arm-xiaomi-linux-uclibcgnueabi --enable-static --prefix=/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop CC=arm-xiaomi-linux-uclibcgnueabi-gcc
$make
$make install
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline122" class="outline-5">
<h5 id="orgheadline122"><span class="section-number-5">5.2.4.7</span> 交叉编译安装libpng</h5>
<div class="outline-text-5" id="text-5-2-4-7">
<div class="org-src-container">

<pre class="src src-sh">$tar -xJvf libpng-1.6.21.tar.xz 
$cd libpng-1.6.21
$./configure --host=arm-xiaomi-linux-uclibcgnueabi --enable-static --with-zlib-prefix=/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop --prefix=/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop CC=arm-xiaomi-linux-uclibcgnueabi-gcc LDFLAGS=-L/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop/lib CFLAGS=-I/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop/include CPPFLAGS=-I/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop/include
$make
$make install
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline123" class="outline-5">
<h5 id="orgheadline123"><span class="section-number-5">5.2.4.8</span> 交叉编译安装libfreetype</h5>
<div class="outline-text-5" id="text-5-2-4-8">
<div class="org-src-container">

<pre class="src src-sh">$tar -xzvf freetype-2.6.3.tar.gz
$cd freetype-2.6.3
$./configure --host=arm-xiaomi-linux-uclibcgnueabi --enable-static --with-zlib-prefix=/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop --prefix=/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop CC=arm-xiaomi-linux-uclibcgnueabi-gcc LDFLAGS=-L/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop/lib CFLAGS=-I/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop/include CPPFLAGS=-I/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop/include LIBPNG_LIBS=-lpng
$make
$make install
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline124" class="outline-5">
<h5 id="orgheadline124"><span class="section-number-5">5.2.4.9</span> 交叉编译安装libmhash</h5>
<div class="outline-text-5" id="text-5-2-4-9">
<div class="org-src-container">

<pre class="src src-sh">$tar -xzvf mhash-0.9.9.9.tar.gz
$cd mhash-0.9.9.9/
$./configure --host=arm-xiaomi-linux-uclibcgnueabi --enable-static --with-zlib-prefix=/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop --prefix=/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop CC=arm-xiaomi-linux-uclibcgnueabi-gcc LDFLAGS=-L/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop/lib CFLAGS=-I/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop/include CPPFLAGS=-I/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop/include
</pre>
</div>

<p>
至此，会报告 <code>rpl_malloc</code> 相关错误，需要修改如下：
</p>
<div class="org-src-container">

<pre class="src src-sh">$vim include/mutils/mhash_config.h
</pre>
</div>

<p>
交叉编译時autotools认为工具链的libc中不包含 <code>malloc</code> 和 <code>realloc</code> ，然后擅自做主张替换成了 <code>rpl_malloc</code> 和 <code>rpl_realloc</code> 。把相关的几句话注释如下：
</p>
<pre class="example">
257 //#define malloc rpl_malloc
</pre>

<p>
然后编译安装如下：
</p>
<div class="org-src-container">

<pre class="src src-sh">$make
$make install
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline125" class="outline-5">
<h5 id="orgheadline125"><span class="section-number-5">5.2.4.10</span> 交叉编译安装libmcrypt-2.5.8</h5>
<div class="outline-text-5" id="text-5-2-4-10">
<div class="org-src-container">

<pre class="src src-sh">$tar -xjvf libmcrypt-2.5.8.tar.bz2
$cd libmcrypt-2.5.8
</pre>
</div>

<p>
还不能直接配置，需要如下修改：
</p>
<div class="org-src-container">

<pre class="src src-sh">$vim ./config.sub
</pre>
</div>

<p>
添加对xiaomi路由器的支持：
</p>
<pre class="example">
...
287     arm-xiaomi-linux)
288       os=-linux
289       ;;
290     *-*-*)                                                                                                                                        
291         echo Invalid configuration \`$1\': machine \`$basic_machine\' not recognized 1&gt;&amp;2
292         exit 1
293         ;;
...
</pre>

<p>
配置如下：
</p>
<div class="org-src-container">

<pre class="src src-sh">$./configure --prefix=/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop --host=arm-xiaomi-linux CC=arm-xiaomi-linux-uclibcgnueabi-gcc
</pre>
</div>

<p>
编译之前需要如下修改：
</p>
<div class="org-src-container">

<pre class="src src-sh">$vim config.h
</pre>
</div>

<p>
注释如下宏定义使得可以编译：
</p>
<pre class="example">
174 /* Define to rpl_malloc if the replacement function should be used. */                                                                            
175 //#define malloc rpl_malloc
176 
177 /* Define to rpl_realloc if the replacement function should be used. */
178 //#define realloc rpl_realloc
</pre>

<p>
编译、安装如下：
</p>
<div class="org-src-container">

<pre class="src src-sh">$make
$make install
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline126" class="outline-5">
<h5 id="orgheadline126"><span class="section-number-5">5.2.4.11</span> 交叉编译安装mcrypt</h5>
<div class="outline-text-5" id="text-5-2-4-11">
<p>
这个貌似不用安装，但是保险起见还是把它安装上去。
配置如下：
</p>
<div class="org-src-container">

<pre class="src src-sh">$tar -xzvf mcrypt-2.6.8.tar.gz
$cd mcrypt-2.6.8
$./configure --with-gnu-ld --host=arm-xiaomi-linux-uclibcgnueabi --enable-static --with-zlib-prefix=/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop --prefix=/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop CC=arm-xiaomi-linux-uclibcgnueabi-gcc LDFLAGS=-L/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop/lib CFLAGS=-I/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop/include CPPFLAGS=-I/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop/include
</pre>
</div>

<p>
交叉编译之前，需要将 <code>Makefile</code> 中对非交叉编译包含的路径 <code>/usr/lib</code> 的依赖去掉如下修改：
</p>
<div class="org-src-container">

<pre class="src src-sh">$vim Makefile
92 #CFLAGS = -I/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop/include -I/usr/include -Wall                                            
93 CFLAGS = -I/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop/include -Wall

$vim src/Makefile
91 #CFLAGS = -I/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop/include -I/usr/include -Wall
92 CFLAGS = -I/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop/include -Wall
</pre>
</div>

<p>
编译安装如下：
</p>
<div class="org-src-container">

<pre class="src src-sh">$make
$make install
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline127" class="outline-5">
<h5 id="orgheadline127"><span class="section-number-5">5.2.4.12</span> 交叉编译安装gettext</h5>
<div class="outline-text-5" id="text-5-2-4-12">
<p>
这个也貌似不需要安装，但是为保险起见也将其安装如下：
</p>
<div class="org-src-container">

<pre class="src src-sh">$tar -xzvf gettext-0.19.tar.gz
$cd gettext-0.19/
$./configure --host=arm-xiaomi-linux-uclibcgnueabi --enable-static --with-libncurses-prefix=/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop --with-named-curses-libs=/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop/lib/libncurses.a --prefix=/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop CC=arm-xiaomi-linux-uclibcgnueabi-gcc
$make
$make install
</pre>
</div>

<p>
注意：此处可能导致后面 <code>gettext</code> 之时报错，如果报错，那么如下再进行一次 <code>ncurses</code> 编译：
</p>
<div class="org-src-container">

<pre class="src src-sh">$cd ncurses-5.6/
$./configure --host=arm-xiaomi-linux-uclibcgnueabi --prefix=/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop --with-shared CC=arm-xiaomi-linux-uclibcgnueabi-gcc
$make 
$make install
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline128" class="outline-5">
<h5 id="orgheadline128"><span class="section-number-5">5.2.4.13</span> 交叉编译安装libodbc</h5>
<div class="outline-text-5" id="text-5-2-4-13">
<p>
似乎无用，保险起见，编译安装如下：
</p>
<div class="org-src-container">

<pre class="src src-sh">$tar -xzvf unixODBC-2.3.4.tar.gz 
$cd unixODBC-2.3.4/
$./configure --host=arm-xiaomi-linux-uclibcgnueabi --prefix=/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop --with-shared CC=arm-xiaomi-linux-uclibcgnueabi-gcc
$make
$make install
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline141" class="outline-5">
<h5 id="orgheadline141"><span class="section-number-5">5.2.4.14</span> 交叉编译安装php</h5>
<div class="outline-text-5" id="text-5-2-4-14">
<p>
这个部分是最关键，也最复杂。前面一切都是为了这个php做准备，有了php后面的nginx也才能够正常支持php的网站。
</p>

<p>
本文采用php-5.6.19，下载地址如下：<a href="http://php.net/get/php-5.6.19.tar.gz/from/a/mirror">http://php.net/get/php-5.6.19.tar.gz/from/a/mirror</a>
</p>

<p>
如果需要最新地址，可到如下网址下载：<a href="http://php.net/downloads.php">http://php.net/downloads.php</a>
</p>
</div>

<ol class="org-ol"><li><a id="orgheadline129"></a>代码与依赖<br  /><div class="outline-text-6" id="text-5-2-4-14-1">
<div class="org-src-container">

<pre class="src src-sh">$tar -xzvf php-5.6.19.tar.gz
</pre>
</div>

<p>
拷贝交叉编译工具链中的 <code>libc.so</code>, <code>libm.so</code> 库。这步虽然可能不必要（小米路由器上已有运行库），但是编译时确实需要。
</p>
<div class="org-src-container">

<pre class="src src-sh">$mkdir -p /home/miracle/work/1_inbox/xiaomirouter/test/usr/lib
$cp /home/miracle/work/1_inbox/xiaomirouter/test/sdk_package/toolchain/arm-xiaomi-linux-uclibcgnueabi/sysroot/usr/lib/{libc.so,libm.so} $_
</pre>
</div>
</div></li>

<li><a id="orgheadline130"></a>配置前的修改<br  /><div class="outline-text-6" id="text-5-2-4-14-2">
<p>
使用configure脚本配置，会导致测试test的时候报错，错误原因类似mysql的配置，是因为交叉编译产生的测试程序不能直接运行，进而无法通过测试，修改configure脚本如下：
</p>
<div class="org-src-container">

<pre class="src src-sh">$vim configure
</pre>
</div>

<p>
将如下脚本片段：
</p>
<pre class="example">
if test "$cross_compiling" = yes; then :
{ { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" &gt;&amp;5
$as_echo "$as_me: error: in \`$ac_pwd':" &gt;&amp;2;}
as_fn_error $? "cannot run test program while cross compiling
See \`config.log' for more details" "$LINENO" 5 ; }
else
</pre>

<p>
修改为：
</p>
<pre class="example">
if test "$cross_compiling" = yes; then :
	echo "skip corss_compiling test";
 # { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" &gt;&amp;5
#$as_echo "$as_me: error: in \`$ac_pwd':" &gt;&amp;2;}
#as_fn_error $? "cannot run test program while cross compiling
#See \`config.log' for more details" "$LINENO" 5 ; }
else
</pre>
</div></li>

<li><a id="orgheadline131"></a>配置1&#x2013;用于确认导出变量的配置<br  /><div class="outline-text-6" id="text-5-2-4-14-3">
<p>
经过如上修改之后， <code>./configure</code> 脚本能够运行通过。但是，仅仅如此还是不够，这样配置后，即使后面的编译过程通过了，所得到的php也有许多的问题，这些问题只有在运行时才可能会被发现，那样我们有需要重新交叉编译、配置php了。过程比较麻烦，这里给出一些需要修改的地方，希望能够尽量避免日后重新配置安装。但是如果不得不重新配置安装的话，这里也为将来出现问题时如何解决给出了一个参考。
</p>

<p>
我们编译php，首先做如下配置：
</p>
<div class="org-src-container">

<pre class="src src-sh">$./configure --host=arm-xiaomi-linux-uclibcgnueabi --prefix=/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop --enable-fpm --with-fpm-user=www-data --with-fpm-group=www-data --with-mysql=mysqlnd --with-mysqli=mysqlnd --with-pdo-mysql=mysqlnd --with-iconv-dir --with-freetype-dir --with-jpeg-dir=/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop --with-png-dir --with-zlib --with-libxml-dir=/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop --enable-xml --disable-rpath  --enable-bcmath --enable-shmop --enable-sysvsem --enable-inline-optimization --with-curl=/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop --enable-mbregex --enable-mbstring --enable-ftp --with-gd --enable-gd-native-ttf --with-openssl=/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop --with-openssl-dir=/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop --with-mcrypt=/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop --with-mhash --with-unixODBC=/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop --enable-pcntl --enable-sockets --with-xmlrpc --enable-zip --enable-soap  --enable-opcache=no --without-pear --disable-fileinfo CC=arm-xiaomi-linux-uclibcgnueabi-gcc --with-gettext=/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop LDFLAGS=-L/home/miracle/work/1_inbox/xiaomirouter/test/usr/lib CFLAGS=-I/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop/include CPPFLAGS=-I/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop/include CFLAGS=-I/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop/include/freetype2 CPPFLAGS=-I/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop/include/freetype2
</pre>
</div>
</div></li>

<li><a id="orgheadline135"></a>确定需要额外修改的配置信息<br  /><div class="outline-text-6" id="text-5-2-4-14-4">
<p>
这里需要修改的内容比较复杂，不可能完全将修改的内容在这里给出。但是相信进行到这里的朋友肯定也对自己所做的事情很清楚了，不需要详细的描述，通过这里给出的方法，应当能够自己根据实际情况将configure修改成适合自己的样子。
</p>
</div>
<ol class="org-ol"><li><a id="orgheadline133"></a>配置支持的函数开关<br  /><div class="outline-text-7" id="text-5-2-4-14-4-1">
<p>
上述配置完成之后，会生成一个 <code>config.log</code>, 其中包含了配置时的信息。对比在pc上配置、编译php后生成的 <code>config.log</code> 与该交叉配置、编译php的 <code>config.log</code> ，找到 <code>ac_cv_func_xxx</code> 变量的配置结果，会发现，有些pc版上为 <code>yes</code> ，而交叉编译版本时变成了 <code>no</code> 的变量，在交叉编译的configure中，根据自身路由器的情况，一般会将相应位置修改回 <code>yes</code> 。
</p>

<p>
这里修改的变量内容很多，不一一列出，需要自行搜索。一般是在configure脚本中判断该变量之前的地方将其值修改。如果编译出错，一般是这样添加的变量对应的某些函数在当前交叉编译环境库中找不到，这时候，再在configure中将相应的函数定义相关变量的 <code>yes</code> 之处改回 <code>no</code> 即可。比如这里曾经修改过的： <code>getloadavg</code>, <code>res_nsearch</code>, <code>strfmon</code>.对应的函数就找不到，所以都又被 <code>disable</code> 了。
</p>

<p>
例如如下就是修改过的代码片段：
</p>
<pre class="example">
67029 ac_cv_func_fork=yes
67030 ac_cv_func_waitpid=yes
67031 ac_cv_func_sigaction=yes
67032 
67033 if test "$PHP_PCNTL" != "no"; then
</pre>
</div>

<ol class="org-ol"><li><a id="orgheadline132"></a>例子<br  /><div class="outline-text-8" id="text-5-2-4-14-4-1-1">
<p>
下面的例子，展示了我们为什么要添加这些函数变量。
</p>

<ol class="org-ol">
<li><p>
发现运行问题
</p>

<p>
最初配置好php之后，适当修改 <code>Makefile</code> (修改方式参见后面)， 编译、安装完成之后，运行某个php脚本时，发现php提示找不到 <code>glob</code> 的错误。 
</p></li>

<li><p>
对比php运行环境
</p>

<p>
于是在pc和小米路由器上写了一个简单的php脚本，
</p>
<div class="org-src-container">

<pre class="src src-php">&lt;?php&gt;
phpinfo()
&lt;?&gt;
</pre>
</div>

<p>
然后搭建好webserver并在浏览器上显示该脚本的运行结果，发现，pc版本中支持的函数多了一个 <code>glob</code>, 这应当是在pc上没有错误，而在小米路由器上有错误的原因。
</p></li>

<li><p>
修改源码包中相关内容
</p>

<p>
该glob函数的定义，可以需要修改源代码，但是更根本的原因更可能是 <code>configure</code> 配置信息有问题，导致一些自动生成的源代码缺少了相关的函数定义。
</p>

<p>
于是再对比pc版和交叉编译版的 <code>config.log</code> 发现确实对 <code>glob</code> 相关的定义有所不同，最终追踪到修改 <code>configure</code> 脚本如下：
</p>

<div class="org-src-container">

<pre class="src src-sh">$vim configure
...
87993 ac_cv_func_glob=yes
87994 for ac_func in getcwd getwd asinh acosh atanh log1p hypot glob strfmon nice fpclass isinf isnan mempcpy strpncpy
87995 do :
...
</pre>
</div></li>
</ol>

<p>
同理，推测其它函数应当也有类似的问题，于是干脆直接对比 <code>config.log</code>, 将pc上激活，而在交叉编译版却被禁止的变量尽量都打开。
</p>
</div></li></ol></li>

<li><a id="orgheadline134"></a>配置其它选项参数<br  /><div class="outline-text-7" id="text-5-2-4-14-4-2">
<p>
参照类似前面的方式，对比pc版本和交叉编译版本 <code>config.log</code> 文件，找到其它看起来比较重要的、却在pc上打开，交叉编译版本关闭的一些选项参数，进行类似修改。
比如：
</p>
<pre class="example">
ac_cv_header_wchar_h=yes
ac_cv_lib_crypt_crypt=yes
ac_cv_header_time=yes
ac_cv_header_time_h=yes
ac_cv_crypt_md5=yes
ac_cv_crypt_sha256=yes
ac_cv_crypt_sha512=yes
</pre>

<p>
这些是我找到的一些看起来比较重要的变量，都依次在 <code>configure</code> 中将相应的变量直接硬编码成 <code>yes</code> 值了。
</p>
</div></li></ol></li>

<li><a id="orgheadline136"></a>配置2&#x2013;最终配置<br  /><div class="outline-text-6" id="text-5-2-4-14-5">
<p>
经过上述修改后，我们应该可以直接运行如下配置命令，生成Makefile了。
</p>
<div class="org-src-container">

<pre class="src src-sh">$./configure --host=arm-xiaomi-linux-uclibcgnueabi --prefix=/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop --enable-fpm --with-fpm-user=www-data --with-fpm-group=www-data --with-mysql=mysqlnd --with-mysqli=mysqlnd --with-pdo-mysql=mysqlnd --with-iconv-dir --with-freetype-dir --with-jpeg-dir=/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop --with-png-dir --with-zlib --with-libxml-dir=/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop --enable-xml --disable-rpath  --enable-bcmath --enable-shmop --enable-sysvsem --enable-inline-optimization --with-curl=/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop --enable-mbregex --enable-mbstring --enable-ftp --with-gd --enable-gd-native-ttf --with-openssl=/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop --with-openssl-dir=/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop --with-mcrypt=/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop --with-mhash --with-unixODBC=/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop --enable-pcntl --enable-sockets --with-xmlrpc --enable-zip --enable-soap  --enable-opcache=no --without-pear --disable-fileinfo CC=arm-xiaomi-linux-uclibcgnueabi-gcc --with-gettext=/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop LDFLAGS=-L/home/miracle/work/1_inbox/xiaomirouter/test/usr/lib CFLAGS=-I/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop/include CPPFLAGS=-I/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop/include CFLAGS=-I/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop/include/freetype2 CPPFLAGS=-I/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop/include/freetype2
</pre>
</div>
</div></li>

<li><a id="orgheadline137"></a>Makefile修改<br  /><div class="outline-text-6" id="text-5-2-4-14-6">
<div class="org-src-container">

<pre class="src src-sh">$vim Makefile
</pre>
</div>
<p>
具体修改主要解决的是路径的问题，防止交叉编译的时候，链接到非交叉编译库的路径。修改的内容主要包括：
</p>
<ol class="org-ol">
<li>去掉 <code>CFLAGS_CLEAN</code>, <code>INCLUDES</code>, <code>ext/iconv/iconv.lo</code> 中对 <code>/usr/include</code> 的包含。</li>
<li>​去掉 <code>EXTRA_LDFLAGS</code>, <code>EXTRA_LDFLAGS_PROGRAM</code>, <code>PHP_LDFLAGS</code> 中对 <code>/usr/lib</code> 的搜索。</li>
</ol>
</div></li>

<li><a id="orgheadline138"></a>代码修改<br  /><div class="outline-text-6" id="text-5-2-4-14-7">
<p>
经过前面对Makefile修改之后，还需对源代码进行一些修改，以避免出现编译错误。大致如下：
</p>

<ol class="org-ol">
<li><p>
修改1
</p>
<div class="org-src-container">

<pre class="src src-sh">$vim include/../main/php_config.h
</pre>
</div>

<p>
修改片段：
</p>
<pre class="example">
15 //#define uint unsigned int
16 //#define ulong unsigned long  
...
535 #define HAVE_CRYPT 1  
...
2516 /* Define to `unsigned int ' if &lt;sys/types.h&gt; does not define. */
2517 //#define uint unsigned int
2518 
2519 /* Define to `unsigned long ' if &lt;sys/types.h&gt; does not define. */
2520 //#define ulong unsigned long
</pre>

<p>
该修改主要解决对uint和ulong重复定义的错误信息。
</p></li>

<li><p>
修改2
</p>
<div class="org-src-container">

<pre class="src src-sh">$vim php-5.6.19/ext/zip/lib/zip_add.c
</pre>
</div>

<p>
将如下片段：
</p>
<pre class="example">
111 #if SIZEOF_OFF_T == 8                                                                                                                              
112 #define ZIP_OFF_MAX ZIP_INT64_MAX
113 #elif SIZEOF_OFF_T == 4
114 #define ZIP_OFF_MAX ZIP_INT32_MAX
115 #elif SIZEOF_OFF_T == 2
116 #define ZIP_OFF_MAX ZIP_INT16_MAX
117 #else
118 #error unsupported size of off_t
119 #endif
</pre>

<p>
改成：
</p>
<pre class="example">
111 //#if SIZEOF_OFF_T == 8
112 //#define ZIP_OFF_MAX ZIP_INT64_MAX
113 //#elif SIZEOF_OFF_T == 4
114 #define ZIP_OFF_MAX ZIP_INT32_MAX
115 //#elif SIZEOF_OFF_T == 2
116 //#define ZIP_OFF_MAX ZIP_INT16_MAX
117 //#else
118 //#error unsupported size of off_t
119 //#endif
</pre>

<p>
该修改主要解决平台字节位相关错误，这些错误可能在运行时才能够体现出来比较难以定位，在这里修改小米路由器就是32字长的CPU，所以去掉无用的判断。
</p></li>

<li><p>
修改3
</p>
<div class="org-src-container">

<pre class="src src-sh">$vim ext/standard/basic_functions.c
</pre>
</div>

<p>
添加#if HAVE_CRYPT&#x2026;#endif 宏包含如下代码块：
</p>
<div class="org-src-container">

<pre class="src src-C">...
1837 /* {{{ password.c */
1838 #if HAVE_CRYPT
1839 ZEND_BEGIN_ARG_INFO_EX(arginfo_password_hash, 0, 0, 2)
1840     ZEND_ARG_INFO(0, password)
1841     ZEND_ARG_INFO(0, algo)
1842     ZEND_ARG_INFO(0, options)
1843 ZEND_END_ARG_INFO()
1844 ZEND_BEGIN_ARG_INFO_EX(arginfo_password_get_info, 0, 0, 1)
1845     ZEND_ARG_INFO(0, hash)
1846 ZEND_END_ARG_INFO()
1847 ZEND_BEGIN_ARG_INFO_EX(arginfo_password_needs_rehash, 0, 0, 2)
1848     ZEND_ARG_INFO(0, hash)
1849     ZEND_ARG_INFO(0, algo)
1850     ZEND_ARG_INFO(0, options)
1851 ZEND_END_ARG_INFO()
1852 ZEND_BEGIN_ARG_INFO_EX(arginfo_password_verify, 0, 0, 2)
1853     ZEND_ARG_INFO(0, password)
1854     ZEND_ARG_INFO(0, hash)
1855 ZEND_END_ARG_INFO()
1856 #endif
1857 /* }}} */
...
2866 #if HAVE_CRYPT
2867     PHP_FE(password_hash,                                                   arginfo_password_hash)
2868     PHP_FE(password_get_info,                                               arginfo_password_get_info)
2869     PHP_FE(password_needs_rehash,                                           arginfo_password_needs_rehash)
2870     PHP_FE(password_verify,                                                 arginfo_password_verify)
2871 #endif 
...
3628 #if HAVE_CRYPT
3629     BASIC_MINIT_SUBMODULE(password)
3630 #endif
</pre>
</div>

<p>
该修改主要解决如下类似错误：
</p>
<pre class="example">
ext/standard/basic_functions.o: In function `zm_startup_basic':
basic_functions.c:(.text+0x12d4): undefined reference to `zm_startup_password'
ext/standard/basic_functions.o: In function `.LC795':
basic_functions.c:(.rodata+0x9de8): undefined reference to `zif_password_hash'
basic_functions.c:(.rodata+0x9dfc): undefined reference to `zif_password_get_info'
basic_functions.c:(.rodata+0x9e10): undefined reference to `zif_password_needs_rehash'
basic_functions.c:(.rodata+0x9e24): undefined reference to `zif_password_verify'
collect2: error: ld returned 1 exit status
</pre></li>
</ol>
</div></li>

<li><a id="orgheadline139"></a>交叉编译1-生成主要的二进制文件<br  /><div class="outline-text-6" id="text-5-2-4-14-8">
<p>
经过如上修改之后，即可以编译代码，如下：
</p>
<div class="org-src-container">

<pre class="src src-sh">$make
</pre>
</div>

<p>
如上的编译并不能完全顺利进行下来，期间遇到如下问题：
</p>
<pre class="example">
Generating phar.php
/bin/bash: /home/miracle/work/1_inbox/xiaomirouter/test/php-5.6.19/sapi/cli/php: 无法执行二进制文件
make: *** [ext/phar/phar.php] 错误 126
</pre>

<p>
原因是编译过程中需要在pc上运行 <code>sapi/cli/php</code> 生成一些必要的文件，但是由于编译过程是交叉编译，所以运行这个命令失败。需要借助pc版的php生成相应文件，大致过程见后面。
</p>
</div></li>

<li><a id="orgheadline140"></a>交叉编译2-借助pc版本的php完成最终编译<br  /><div class="outline-text-6" id="text-5-2-4-14-9">
<p>
前面也提到了，前面出现的错误不需要修改什么，但是需要事先编译好一个pc版本的php。pc上php的编译在前面有所介绍。
</p>

<p>
当交叉编译出现这个错误之后，将事先编译好的pc版的 <code>php</code> 程序替换交叉编译源码目录中的 <code>php-5.6.19/sapi/cli/php</code> ，然后继续 <code>make</code> 即可。 <code>make</code> 之后，不要忘记再替换回之前的备份。
</p>

<ol class="org-ol">
<li><p>
使用pc版本的 <code>php</code> 继续完成编译、安装
</p>
<div class="org-src-container">

<pre class="src src-sh">$cd sapi/cli
$mv php php.arm
$cp /usr/local/develop/php-5.6.19/bin/php .
（这里/usr/local/develop/php-5.6.19是pc上的php的路径）
$cd ../../
$make
$make install
</pre>
</div></li>

<li><p>
用之前交叉编译版本的 <code>php</code> 替换回安装好的程序中的 <code>php</code> 程序
</p>
<div class="org-src-container">

<pre class="src src-sh">$cd sapi/cli
$cp php php.pc
$cp php.arm php
$cp php /home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop/bin
</pre>
</div></li>
</ol>

<p>
至此，Php的交叉编译过程完成。
</p>
</div></li></ol>
</div>
</div>

<div id="outline-container-orgheadline43" class="outline-4">
<h4 id="orgheadline43"><span class="section-number-4">5.2.5</span> 交叉编译安装nginx</h4>
<div class="outline-text-4" id="text-5-2-5">
</div><div id="outline-container-orgheadline142" class="outline-5">
<h5 id="orgheadline142"><span class="section-number-5">5.2.5.1</span> 代码解压</h5>
<div class="outline-text-5" id="text-5-2-5-1">
<div class="org-src-container">

<pre class="src src-sh">$tar -xzvf nginx-1.8.1.tar.gz
$cd nginx-1.8.1
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline143" class="outline-5">
<h5 id="orgheadline143"><span class="section-number-5">5.2.5.2</span> 修改配置文件</h5>
<div class="outline-text-5" id="text-5-2-5-2">
<p>
源代码中的 <code>auto</code> 目录修改会影响后面用 <code>configure</code> 生成的 <code>objs/ngx_auto_config.h</code> 的内容。如果没有修改相应的配置文件，则在后面编译之时修改该头文件中相应的定义也行。保险起见，最好从配置文件上进行修改。
</p>

<ol class="org-ol">
<li><p>
cpu位相关内容
</p>
<div class="org-src-container">

<pre class="src src-sh">$vim auto/types/sizeof
</pre>
</div>

<p>
修改如下：
</p>
<pre class="example">
15 ngx_size=4                                                                                                                                        
...&lt;中间的注释掉&gt;...
18 case $ngx_size in
</pre>

<p>
因为目标机器（小米路由器）是32位，而这里测试程序是对编译主机检测的结果，如果该结果与目标机器不一致就会运行出错。例如我机器是64位，没有改这个，运行nginx读取配置文件的时候有如下错：
</p>
<pre class="example">
nginx: [emerg] "worker_processes" directive invalid value in /userdisk/data/opt/usr/local/develop/conf/nginx.conf:2
</pre>
<p>
这类运行时才出现的错误，一般很难定位，所以在开始尽量能避免则避免。
</p>

<p>
另外要注意 <code>auto/endianness</code> , 需要交叉编译这个文件定义的测试程序，然后放到小米路由器上运行一下，看其结果与ｐｃ上对比看是否一样，以决定NGX_HAVE_LITTLE_ENDIAN宏的定义。
</p></li>

<li><p>
一些系统调用的支持配置
</p>
<div class="org-src-container">

<pre class="src src-sh">$vim auto/os/linux
</pre>
</div>

<p>
注释修改类似如下
</p>
<pre class="example">
87 # O_PATH and AT_EMPTY_PATH were introduced in 2.6.39, glibc 2.14                                                                                  
88 
89 #ngx_feature="O_PATH"
90 #ngx_feature_name="NGX_HAVE_O_PATH"
91 #ngx_feature_run=no
92 #ngx_feature_incs="#include &lt;sys/types.h&gt;
93 #                  #include &lt;sys/stat.h&gt;
94 #                  #include &lt;fcntl.h&gt;"
95 #ngx_feature_path=
96 #ngx_feature_libs=
97 #ngx_feature_test="int fd; struct stat sb;
98 #                  fd = openat(AT_FDCWD, \".\", O_PATH|O_DIRECTORY|O_NOFOLLOW);
99 #                  if (fstatat(fd, \"\", &amp;sb, AT_EMPTY_PATH) != 0) return 1"
100 #. auto/feature
...
169 # crypt_r()
170 
171 #ngx_feature="crypt_r()"
172 #ngx_feature_name="NGX_HAVE_GNU_CRYPT_R"
173 #ngx_feature_run=no
174 #ngx_feature_incs="#include &lt;crypt.h&gt;"
175 #ngx_feature_path=
176 #ngx_feature_libs=-lcrypt
177 #ngx_feature_test="struct crypt_data  cd;
178 #                  crypt_r(\"key\", \"salt\", &amp;cd);"
179 #. auto/feature
</pre>

<p>
如果这里的内容没有修改的话，那么在后面编译之时的代码，应当如下修改
</p>
<div class="org-src-container">

<pre class="src src-sh">$vim objs/ngx_auto_config.h
</pre>
</div>

<p>
修改片段：
</p>
<pre class="example">
...
38 //#ifndef NGX_HAVE_O_PATH
39 //#define NGX_HAVE_O_PATH  1
40 //#endif                                                                                                                                          
...
63 //#ifndef NGX_HAVE_GNU_CRYPT_R
64 //#define NGX_HAVE_GNU_CRYPT_R  1
65 //#endif 
...
</pre></li>
</ol>
</div>
</div>

<div id="outline-container-orgheadline144" class="outline-5">
<h5 id="orgheadline144"><span class="section-number-5">5.2.5.3</span> 配置</h5>
<div class="outline-text-5" id="text-5-2-5-3">
<div class="org-src-container">

<pre class="src src-sh">$./configure  --with-openssl=/home/miracle/work/1_inbox/xiaomirouter/test/openssl-1.0.2g --with-pcre=/home/miracle/work/1_inbox/xiaomirouter/test/openssl-1.0.2g --with-http_ssl_module --with-http_dav_module --prefix=/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline145" class="outline-5">
<h5 id="orgheadline145"><span class="section-number-5">5.2.5.4</span> 修改Makefile</h5>
<div class="outline-text-5" id="text-5-2-5-4">
<div class="org-src-container">

<pre class="src src-sh">$vim objs/Makefile
</pre>
</div>

<ol class="org-ol">
<li><p>
修改1-交叉编译工具与选项
</p>
<pre class="example">
#CC =	cc
CC=arm-xiaomi-linux-uclibcgnueabi-gcc
#CFLAGS =  -pipe  -O -W -Wall -Wpointer-arith -Wno-unused-parameter -Werror -g 
CFLAGS =  -pipe  -O -W -Wall -Wpointer-arith -Wno-unused-parameter 
CFLAGS+=-I/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop/include
CPP =	$(CC) -E
CPPFLAGS+=-I/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop/include
LINK =	$(CC)
LDFLAGS+=-L/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop/lib
</pre></li>

<li><p>
修改2-头文件的包含
</p>
<pre class="example">
ALL_INCS = -I src/core \
-I src/event \
-I src/event/modules \
-I src/os/unix \
-I /home/miracle/work/1_inbox/xiaomirouter/test/openssl-1.0.2g \
-I /home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop/include \
-I objs \
-I src/http \
-I src/http/modules \
-I src/mail
</pre></li>

<li><p>
修改3-依赖模块头文件(openssl与pcre)
</p>
<pre class="example">
CORE_DEPS = src/core/nginx.h \
...
/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop/include/openssl/ssl.h \
/home/miracle/work/1_inbox/xiaomirouter/test/pcre-8.38/pcre.h \
objs/ngx_auto_config.h
</pre></li>

<li><p>
修改4-依赖模块安装路径包含(openssl与相应的交叉编译安装路径)
</p>
<pre class="example">
CORE_INCS = -I src/core \
-I src/event \
-I src/event/modules \
-I src/os/unix \
-I /home/miracle/work/1_inbox/xiaomirouter/test/openssl-1.0.2g \
-I /home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop/include \
-I objs
</pre></li>

<li><p>
修改5-libpcre.a的链接
</p>
<pre class="example">
objs/nginx:	objs/src/core/nginx.o \
...
objs/ngx_modules.o \
/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop/lib/libpcre.a
</pre></li>

<li><p>
修改6-链接 <code>lz</code> 的路径
</p>
<pre class="example">
$(LINK) -o objs/nginx \
...
objs/ngx_modules.o \
-lpthread -lcrypt /home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop/lib/libpcre.a /home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop/lib/libssl.a /home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop/lib/libcrypto.a -ldl -L/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop/lib -lz
</pre></li>

<li><p>
修改7-注释掉不需要的编译
</p>
<pre class="example">
#/home/miracle/work/1_inbox/xiaomirouter/test/openssl-1.0.2g/pcre.h:	#/home/miracle/work/1_inbox/xiaomirouter/test/openssl-1.0.2g/Makefile

#/home/miracle/work/1_inbox/xiaomirouter/test/openssl-1.0.2g/Makefile:	objs/Makefile
#cd /home/miracle/work/1_inbox/xiaomirouter/test/openssl-1.0.2g \
#&amp;&amp; if [ -f Makefile ]; then $(MAKE) distclean; fi \
#&amp;&amp; CC="$(CC)" CFLAGS="-O2 -fomit-frame-pointer -pipe " \
#./configure --disable-shared 

#/home/miracle/work/1_inbox/xiaomirouter/test/openssl-1.0.2g/.libs/libpcre.a:	#/home/miracle/work/1_inbox/xiaomirouter/test/openssl-1.0.2g/Makefile
#cd /home/miracle/work/1_inbox/xiaomirouter/test/openssl-1.0.2g \
#&amp;&amp; $(MAKE) libpcre.la

#/home/miracle/work/1_inbox/xiaomirouter/test/openssl-1.0.2g/.openssl/include/openssl/ssl.h:	objs/Makefile
#cd /home/miracle/work/1_inbox/xiaomirouter/test/openssl-1.0.2g \
#&amp;&amp; if [ -f Makefile ]; then $(MAKE) clean; fi \
#&amp;&amp; ./config --prefix=/home/miracle/work/1_inbox/xiaomirouter/test/openssl-1.0.2g/.openssl no-shared  \
#&amp;&amp; $(MAKE) \
#&amp;&amp; $(MAKE) install LIBDIR=lib
</pre></li>
</ol>
</div>
</div>

<div id="outline-container-orgheadline146" class="outline-5">
<h5 id="orgheadline146"><span class="section-number-5">5.2.5.5</span> 交叉编译、安装</h5>
<div class="outline-text-5" id="text-5-2-5-5">
<div class="org-src-container">

<pre class="src src-sh">$make
$make install
</pre>
</div>

<p>
至此，nginx交叉编译、安装完成。
</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline44" class="outline-4">
<h4 id="orgheadline44"><span class="section-number-4">5.2.6</span> 部署到小米路由器上的内容</h4>
<div class="outline-text-4" id="text-5-2-6">
</div><div id="outline-container-orgheadline147" class="outline-5">
<h5 id="orgheadline147"><span class="section-number-5">5.2.6.1</span> 安装包部署</h5>
<div class="outline-text-5" id="text-5-2-6-1">
<p>
每次升级路由器,都需要重新部署配置文件.
</p>

<div class="org-src-container">

<pre class="src src-sh">$vim /etc/profile
</pre>
</div>

<div class="org-src-container">

<pre class="src src-sh">#custom
export PATH=$PATH:/userdisk/data/opt/usr/local/develop/bin
export PATH=$PATH:/userdisk/data/opt/usr/local/develop/sbin
export PATH=$PATH:/userdisk/data/opt/usr/local/develop/libexec
export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/userdisk/data/opt/usr/local/develop/lib
export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/userdisk/data/opt/usr/local/develop/lib/mysql
</pre>
</div>
</div>
</div>
<div id="outline-container-orgheadline148" class="outline-5">
<h5 id="orgheadline148"><span class="section-number-5">5.2.6.2</span> 配置文件以及数据库的部署</h5>
<div class="outline-text-5" id="text-5-2-6-2">
<p>
先给出一个脚本 <code>install.sh</code>, 用来集中描述对配置文件的部署：
</p>
<div class="org-src-container">

<pre class="src src-sh">#!/bin/sh
PREFIX=/userdisk/data/opt/usr/local/develop
[ -f /etc/my.cnf ] &amp;&amp; echo "/etc/my.cnf exists, skip." || cp ./my.cnf /etc
[ -f $PREFIX/etc/php-fpm.conf ] &amp;&amp; echo "$PREFIX/etc/php-fpm.conf exists, skip."|| cp ./php-fpm.conf $PREFIX/etc
[ -f $PREFIX/etc/php.ini ] &amp;&amp; echo "$PREFIX/etc/php.ini exists, skip."|| cp ./php.ini $PREFIX/etc
[ -f $PREFIX/conf/nginx.conf ] &amp;&amp; echo "$PREFIX/conf/nginx.conf exists, skip."|| cp ./nginx.conf $PREFIX/conf

mkdir -p $PREFIX/data
mkdir -p $PREFIX/tmp
chmod 777 -R $PREFIX/tmp
mysql_install_db --user=root --basedir=$PREFIX --datadir=$PREFIX/data
</pre>
</div>

<p>
对于以上脚本，我们需要了解如下：
</p>
<ol class="org-ol">
<li><p>
<code>PREFIX=/userdisk/data/opt/usr/local/develop</code>
</p>

<p>
这句话指定了我们将要将交叉编译的内容部署到小米路由器上的哪个路径，路径用环境变量 <code>PREFIX</code> 来指定。
</p></li>

<li><p>
<code>[ -f /etc/my.cnf ] &amp;&amp; echo "/etc/my.cnf exists, skip." || cp ./my.cnf /etc</code>
</p>

<p>
这句话指定 MySql 的配置文件，这个文件拷贝自源码包下的 <code>support-files/my-small.cnf</code>, 将其修改后拷贝到小米路由器的 <code>/etc</code> 下，并重命名为 <code>my.cnf</code> 做为MySql的配置文件。
</p>

<p>
对于该文件的修改主要如下片段：
</p>
<pre class="example">
[mysqld]
user = root
basedir	= /userdisk/data/opt/usr/local/develop
</pre></li>

<li><p>
<code>[ -f $PREFIX/etc/php-fpm.conf ] &amp;&amp; echo "$PREFIX/etc/php-fpm.conf exists, skip."|| cp ./php-fpm.conf $PREFIX/etc</code>
</p>

<p>
这句话给出 <code>php-fpm</code> 的配置，该文件拷贝自安装目录 <code>$PREFIX/etc/php-fpm.conf</code> 下的 <code>php-fpm.conf.default</code> 文件， 主要修改如下：
</p>

<pre class="example">
[global]
; Pid file
; Note: the default prefix is /home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop/var
; Default Value: none
;pid = run/php-fpm.pid

; Error log file
; If it's set to "syslog", log is sent to syslogd instead of being written
; in a local file.
; Note: the default prefix is /home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop/var
; Default Value: log/php-fpm.log
;error_log = log/php-fpm.log

...

;   'port'                 - to listen on a TCP socket to all IPv4 addresses on a
;                            specific port;
;   '[::]:port'            - to listen on a TCP socket to all addresses
;                            (IPv6 and IPv4-mapped) on a specific port;
;   '/path/to/unix/socket' - to listen on a unix socket.
; Note: This value is mandatory.
listen = 127.0.0.1:9000

...

; Redirect worker stdout and stderr into main error log. If not set, stdout and
; stderr will be redirected to /dev/null according to FastCGI specs.
; Note: on highloaded environement, this can cause some delay in the page
; process time (several ms).
; Default Value: no
;catch_workers_output = yes
</pre></li>

<li><p>
<code>[ -f $PREFIX/etc/php.ini ] &amp;&amp; echo "$PREFIX/etc/php.ini exists, skip."|| cp ./php.ini $PREFIX/etc</code>
</p>

<p>
这个文件拷贝自源代码包中的 <code>php.ini-development</code>, 修改如下：
</p>

<pre class="example">
...

; Log errors to specified file. PHP's default behavior is to leave this value
; empty.
; http://php.net/error-log
; Example:
;error_log = php_errors.log
; Log errors to syslog (Event Log on Windows).
error_log = /userdisk/data/opt/usr/local/develop/var/log/php_errors.log

...

; Maximum size of POST data that PHP will accept.
; Its value may be 0 to disable the limit. It is ignored if POST data reading
; is disabled through enable_post_data_reading.
; http://php.net/post-max-size
post_max_size = 512M

...

; Directory in which the loadable extensions (modules) reside.
; http://php.net/extension-dir
; extension_dir = "./"
; On windows:
extension_dir = "/userdisk/data/opt/usr/local/develop/lib/php/extensions/no-debug-non-zts-20131226"

...

; Directory where the temporary files should be placed.
; Defaults to the system default (see sys_get_temp_dir)
; sys_temp_dir = "/tmp"
sys_temp_dir = "/userdisk/data/opt/usr/local/develop/tmp"

...

; Maximum allowed size for uploaded files.
; http://php.net/upload-max-filesize
upload_max_filesize = 512M

...

; Default socket name for local MySQL connects.  If empty, uses the built-in
; MySQL defaults.
; http://php.net/pdo_mysql.default-socket
pdo_mysql.default_socket= /tmp/mysql.sock

...

;
;     session.save_path = "N;MODE;/path"
;
; where MODE is the octal representation of the mode. Note that this
; does not overwrite the process's umask.
; http://php.net/session.save-path
; session.save_path = "/tmp"
session.save_path = "/userdisk/data/opt/usr/local/develop/tmp"

...
</pre></li>

<li><p>
<code>[ -f $PREFIX/conf/nginx.conf ] &amp;&amp; echo "$PREFIX/conf/nginx.conf exists, skip."|| cp ./nginx.conf $PREFIX/conf</code>
</p>

<p>
这个是nginx的配置文件，在 <code>$PREFIX/conf/</code> 中有一个备份的文件 <code>nginx.conf.default</code>, (其他的nginx配置也是类似的备份方式)，对该文件的修改，和PC上基本一样。
</p>

<p>
这里给出其完整配置如下：
</p>

<pre class="example">
worker_processes  2;

error_log  /userdisk/data/opt/usr/local/develop/logs/error.log;
#error_log  /userdisk/data/opt/usr/local/develop/logs/error.log  notice;
#error_log  /userdisk/data/opt/usr/local/develop/logs/error.log  info;
#error_log  /userdisk/data/opt/usr/local/develop/logs/error.log  alert;

pid        /var/run/nginx.pid;


events {
worker_connections  1024;
}


http {
include       mime.types;
default_type  application/octet-stream;

log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '
'$status $body_bytes_sent "$http_referer" '
'"$http_user_agent" "$http_x_forwarded_for"';

access_log  /userdisk/data/opt/usr/local/develop/logs/access.log  main;

sendfile        on;
#tcp_nopush     on;

#keepalive_timeout  0;
keepalive_timeout  65;

#gzip  on;

###test php
server {
listen       18080;
server_name 192.168.31.1;

location / {
#root   /userdisk/data/web/test;
root   /userdisk/data/web/test;
index  index.php index.html;
}

# pass the PHP scripts to FastCGI server listening on 192.168.31.1:19000
#
location ~ \.php$ {
fastcgi_pass   127.0.0.1:19000;
fastcgi_index  index.php;
fastcgi_param  SCRIPT_FILENAME  /userdisk/data/web/test$fastcgi_script_name;
include        fastcgi_params;
}
}

###myown cloud with ssl
upstream php-handler {
server 127.0.0.1:19000;
#server unix:/var/run/php5-fpm.sock;
}

server {
listen 18000;
server_name 192.168.31.1;
# enforce https
return 301 https://$server_name$request_uri;
}
server {
listen 443 ssl;
server_name 192.168.31.1;
ssl_certificate /userdisk/data/web/server.crt;
ssl_certificate_key /userdisk/data/web/server.key;
# Add headers to serve security related headers
add_header Strict-Transport-Security "max-age=15768000; includeSubDomains; preload;";
add_header X-Content-Type-Options nosniff;
add_header X-Frame-Options "SAMEORIGIN";
add_header X-XSS-Protection "1; mode=block";
add_header X-Robots-Tag none;
add_header X-Download-Options noopen;
add_header X-Permitted-Cross-Domain-Policies none;

# Path to the root of your installation
root /userdisk/data/web;
# set max upload size
location / {
index index.html;
}

location /blog {
alias /userdisk/data/web/blog;
index index.html;
}
location /blog/quietheart {
alias /userdisk/data/web/blog/quietheart;
index index.html;
}

location /mycloud/owncloud {
alias /userdisk/data/web/mycloud/owncloud;
client_max_body_size 1G;
fastcgi_buffers 64 4K;
# Disable gzip to avoid the removal of the ETag header
gzip off;
# Uncomment if your server is build with the ngx_pagespeed module
# This module is currently not supported.
#pagespeed off;
index index.php;
error_page 403 /core/templates/403.php;
error_page 404 /core/templates/404.php;
rewrite ^/.well-known/carddav /remote.php/dav/ permanent;
rewrite ^/.well-known/caldav /remote.php/dav/ permanent;
# The following 2 rules are only needed for the user_webfinger app.
# Uncomment it if you're planning to use this app.
#rewrite ^/.well-known/host-meta /public.php?service=host-meta last;
#rewrite ^/.well-known/host-meta.json /public.php?service=host-meta-json last;
rewrite ^/remote/(.*) /remote.php last;
rewrite ^(/core/doc/[^\/]+/)$ $1/index.html;
try_files $uri $uri/ =404;
}

location = /robots.txt {
allow all;
log_not_found off;
access_log off;
}

location ~ ^/(build|tests|config|lib|3rdparty|templates|data)/ {
deny all;
}

location ~ ^/(?:\.|autotest|occ|issue|indie|db_|console) {
deny all;
}

#		location / {
#		rewrite ^/remote/(.*) /remote.php last;
#		rewrite ^(/core/doc/[^\/]+/)$ $1/index.html;
#			try_files $uri $uri/ =404;
#		}

location ~ \.php(?:$|/) {
fastcgi_split_path_info ^(.+\.php)(/.+)$;
include fastcgi_params;
fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
fastcgi_param PATH_INFO $fastcgi_path_info;
fastcgi_param HTTPS on;
fastcgi_param modHeadersAvailable true; #Avoid sending the security headers twice
#fastcgi_pass   127.0.0.1:9000;
fastcgi_pass   php-handler;
fastcgi_intercept_errors on;
}

location ~* \.(?:css|js)$ {
add_header Cache-Control "public, max-age=7200";
# Add headers to serve security related headers
add_header Strict-Transport-Security "max-age=15768000; includeSubDomains; preload;";
add_header X-Content-Type-Options nosniff;
add_header X-Frame-Options "SAMEORIGIN";
add_header X-XSS-Protection "1; mode=block";
add_header X-Robots-Tag none;
add_header X-Download-Options noopen;
add_header X-Permitted-Cross-Domain-Policies none;
# Optional: Don't log access to assets
access_log off;
}

# Optional: Don't log access to other assets
location ~* \.(?:jpg|jpeg|gif|bmp|ico|png|swf)$ {
access_log off;
}
}
}
</pre></li>

<li><p>
创建程序运行时所需要的目录
</p>

<p>
如下目录需要手动创建，运行时会向其中写入相关的文件：
</p>
<div class="org-src-container">

<pre class="src src-sh">$mkdir -p $PREFIX/data
$mkdir -p $PREFIX/tmp
$chmod 777 -R $PREFIX/tmp
</pre>
</div></li>

<li><p>
安装数据库相关内容
</p>

<p>
主要是数据库所在路径，配置之后即可启动MySql服务，如下：
</p>
<div class="org-src-container">

<pre class="src src-sh">$mysql_install_db --user=root --basedir=$PREFIX --datadir=$PREFIX/data
</pre>
</div></li>
</ol>
</div>
</div>

<div id="outline-container-orgheadline149" class="outline-5">
<h5 id="orgheadline149"><span class="section-number-5">5.2.6.3</span> 编写运行脚本</h5>
<div class="outline-text-5" id="text-5-2-6-3">
<p>
启动脚本主要包括：MySql启动脚本、Php环境启动脚本、以及nginx启动脚本。
</p>

<p>
后面会给出使用方式，这里先给出脚本内容分别如下：
</p>
<ol class="org-ol">
<li><p>
MySql启动脚本：mysql.server
</p>
<div class="org-src-container">

<pre class="src src-sh">#!/bin/sh
# Copyright Abandoned 1996 TCX DataKonsult AB &amp; Monty Program KB &amp; Detron HB
# This file is public domain and comes with NO WARRANTY of any kind

# MySQL daemon start/stop script.

# Usually this is put in /etc/init.d (at least on machines SYSV R4 based
# systems) and linked to /etc/rc3.d/S99mysql and /etc/rc0.d/K01mysql.
# When this is done the mysql server will be started when the machine is
# started and shut down when the systems goes down.

# Comments to support chkconfig on RedHat Linux
# chkconfig: 2345 64 36
# description: A very fast and reliable SQL database engine.

# Comments to support LSB init script conventions
### BEGIN INIT INFO
# Provides: mysql
# Required-Start: $local_fs $network $remote_fs
# Should-Start: ypbind nscd ldap ntpd xntpd
# Required-Stop: $local_fs $network $remote_fs
# Default-Start:  2 3 4 5
# Default-Stop: 0 1 6
# Short-Description: start and stop MySQL
# Description: MySQL is a very fast and reliable SQL database engine.
### END INIT INFO

# If you install MySQL on some other places than /home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop/mysql-5.1.72, then you
# have to do one of the following things for this script to work:
#
# - Run this script from within the MySQL installation directory
# - Create a /etc/my.cnf file with the following information:
#   [mysqld]
#   basedir=&lt;path-to-mysql-installation-directory&gt;
# - Add the above to any other configuration file (for example ~/.my.ini)
#   and copy my_print_defaults to /usr/bin
# - Add the path to the mysql-installation-directory to the basedir variable
#   below.
#
# If you want to affect other MySQL variables, you should make your changes
# in the /etc/my.cnf, ~/.my.cnf or other MySQL configuration files.

# If you change base dir, you must also change datadir. These may get
# overwritten by settings in the MySQL configuration files.

basedir=/userdisk/data/opt/usr/local/develop
datadir=

# Default value, in seconds, afterwhich the script should timeout waiting
# for server start. 
# Value here is overriden by value in my.cnf. 
# 0 means don't wait at all
# Negative numbers mean to wait indefinitely
service_startup_timeout=900

# The following variables are only set for letting mysql.server find things.

# Set some defaults
pid_file=
server_pid_file=
use_mysqld_safe=1
user=root
if test -z "$basedir"
then
basedir=/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop/mysql-5.1.72
bindir=/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop/mysql-5.1.72/bin
if test -z "$datadir"
then
datadir=/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop/mysql-5.1.72/var
fi
sbindir=/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop/mysql-5.1.72/sbin
libexecdir=/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop/mysql-5.1.72/libexec
else
bindir="$basedir/bin"
if test -z "$datadir"
then
datadir="$basedir/data"
fi
sbindir="$basedir/sbin"
libexecdir="$basedir/libexec"
fi

# datadir_set is used to determine if datadir was set (and so should be
# *not* set inside of the --basedir= handler.)
datadir_set=

#
# Use LSB init script functions for printing messages, if possible
#
lsb_functions="/lib/lsb/init-functions"
if test -f $lsb_functions ; then
. $lsb_functions
else
log_success_msg()
{
echo " SUCCESS! $@"
}
log_failure_msg()
{
echo " ERROR! $@"
}
fi

PATH=/sbin:/usr/sbin:/bin:/usr/bin:$basedir/bin
export PATH

mode=$1    # start or stop
shift
other_args="$*"   # uncommon, but needed when called from an RPM upgrade action
# Expected: "--skip-networking --skip-grant-tables"
# They are not checked here, intentionally, as it is the resposibility
# of the "spec" file author to give correct arguments only.

case `echo "testing\c"`,`echo -n testing` in
*c*,-n*) echo_n=   echo_c=     ;;
*c*,*)   echo_n=-n echo_c=     ;;
*)       echo_n=   echo_c='\c' ;;
esac

parse_server_arguments() {
for arg do
case "$arg" in
--basedir=*)  basedir=`echo "$arg" | sed -e 's/^[^=]*=//'`
bindir="$basedir/bin"
if test -z "$datadir_set"; then
datadir="$basedir/data"
fi
sbindir="$basedir/sbin"
libexecdir="$basedir/libexec"
;;
--datadir=*)  datadir=`echo "$arg" | sed -e 's/^[^=]*=//'`
datadir_set=1
;;
--user=*)  user=`echo "$arg" | sed -e 's/^[^=]*=//'` ;;
--pid-file=*) server_pid_file=`echo "$arg" | sed -e 's/^[^=]*=//'` ;;
--service-startup-timeout=*) service_startup_timeout=`echo "$arg" | sed -e 's/^[^=]*=//'` ;;
--use-mysqld_safe) use_mysqld_safe=1;;
--use-manager)     use_mysqld_safe=0;;
esac
done
}

parse_manager_arguments() {
for arg do
case "$arg" in
--pid-file=*) pid_file=`echo "$arg" | sed -e 's/^[^=]*=//'` ;;
--user=*)  user=`echo "$arg" | sed -e 's/^[^=]*=//'` ;;
esac
done
}

wait_for_pid () {
verb="$1"
manager_pid="$2"  # process ID of the program operating on the pid-file
i=0
avoid_race_condition="by checking again"
while test $i -ne $service_startup_timeout ; do

case "$verb" in
'created')
# wait for a PID-file to pop into existence.
test -s $pid_file &amp;&amp; i='' &amp;&amp; break
;;
'removed')
# wait for this PID-file to disappear
test ! -s $pid_file &amp;&amp; i='' &amp;&amp; break
;;
*)
echo "wait_for_pid () usage: wait_for_pid created|removed manager_pid"
exit 1
;;
esac

# if manager isn't running, then pid-file will never be updated
if test -n "$manager_pid"; then
if kill -0 "$manager_pid" 2&gt;/dev/null; then
:  # the manager still runs
else
# The manager may have exited between the last pid-file check and now.  
if test -n "$avoid_race_condition"; then
avoid_race_condition=""
continue  # Check again.
fi

# there's nothing that will affect the file.
log_failure_msg "Manager of pid-file quit without updating file."
return 1  # not waiting any more.
fi
fi

echo $echo_n ".$echo_c"
i=`expr $i + 1`
sleep 1
done

if test -z "$i" ; then
log_success_msg
return 0
else
log_failure_msg
return 1
fi
}

# Get arguments from the my.cnf file,
# the only group, which is read from now on is [mysqld]
if test -x ./bin/my_print_defaults
then
print_defaults="./bin/my_print_defaults"
elif test -x $bindir/my_print_defaults
then
print_defaults="$bindir/my_print_defaults"
elif test -x $bindir/mysql_print_defaults
then
print_defaults="$bindir/mysql_print_defaults"
else
# Try to find basedir in /etc/my.cnf
conf=/etc/my.cnf
print_defaults=
if test -r $conf
then
subpat='^[^=]*basedir[^=]*=\(.*\)$'
dirs=`sed -e "/$subpat/!d" -e 's//\1/' $conf`
for d in $dirs
do
d=`echo $d | sed -e 's/[     ]//g'`
if test -x "$d/bin/my_print_defaults"
then
print_defaults="$d/bin/my_print_defaults"
break
fi
if test -x "$d/bin/mysql_print_defaults"
then
print_defaults="$d/bin/mysql_print_defaults"
break
fi
done
fi

# Hope it's in the PATH ... but I doubt it
test -z "$print_defaults" &amp;&amp; print_defaults="my_print_defaults"
fi

#
# Read defaults file from 'basedir'.   If there is no defaults file there
# check if it's in the old (depricated) place (datadir) and read it from there
#

extra_args=""
if test -r "$basedir/my.cnf"
then
extra_args="-e $basedir/my.cnf"
else
if test -r "$datadir/my.cnf"
then
extra_args="-e $datadir/my.cnf"
fi
fi

parse_server_arguments `$print_defaults $extra_args mysqld server mysql_server mysql.server`

# Look for the pidfile 
parse_manager_arguments `$print_defaults $extra_args manager`

#
# Set pid file if not given
#
if test -z "$pid_file"
then
pid_file=$datadir/mysqlmanager-`/bin/hostname`.pid
else
case "$pid_file" in
/* ) ;;
* )  pid_file="$datadir/$pid_file" ;;
esac
fi
if test -z "$server_pid_file"
then
server_pid_file=$datadir/`/bin/hostname`.pid
else
case "$server_pid_file" in
/* ) ;;
* )  server_pid_file="$datadir/$server_pid_file" ;;
esac
fi

case "$mode" in
'start')
# Start daemon

# Safeguard (relative paths, core dumps..)
cd $basedir

manager=$bindir/mysqlmanager
if test -x $libexecdir/mysqlmanager
then
manager=$libexecdir/mysqlmanager
elif test -x $sbindir/mysqlmanager
then
manager=$sbindir/mysqlmanager
fi

echo $echo_n "Starting MySQL"
if test -x $manager -a "$use_mysqld_safe" = "0"
then
if test -n "$other_args"
then
log_failure_msg "MySQL manager does not support options '$other_args'"
exit 1
fi
# Give extra arguments to mysqld with the my.cnf file. This script may
# be overwritten at next upgrade.
"$manager" \
--mysqld-safe-compatible \
--user="$user" \
--pid-file="$pid_file" &gt;/dev/null 2&gt;&amp;1 &amp;
wait_for_pid created $!; return_value=$?

# Make lock for RedHat / SuSE
if test -w /var/lock/subsys
then
touch /var/lock/subsys/mysqlmanager
fi
exit $return_value
elif test -x $bindir/mysqld_safe
then
# Give extra arguments to mysqld with the my.cnf file. This script
# may be overwritten at next upgrade.
pid_file=$server_pid_file
$bindir/mysqld_safe --datadir=$datadir --pid-file=$server_pid_file $other_args &gt;/dev/null 2&gt;&amp;1 &amp;
wait_for_pid created $!; return_value=$?

# Make lock for RedHat / SuSE
if test -w /var/lock/subsys
then
touch /var/lock/subsys/mysql
fi
exit $return_value
else
log_failure_msg "Couldn't find MySQL manager ($manager) or server ($bindir/mysqld_safe)"
fi
;;

'stop')
# Stop daemon. We use a signal here to avoid having to know the
# root password.

# The RedHat / SuSE lock directory to remove
lock_dir=/var/lock/subsys/mysqlmanager

# If the manager pid_file doesn't exist, try the server's
if test ! -s "$pid_file"
then
pid_file=$server_pid_file
lock_dir=/var/lock/subsys/mysql
fi

if test -s "$pid_file"
then
mysqlmanager_pid=`cat $pid_file`

if (kill -0 $mysqlmanager_pid 2&gt;/dev/null)
then
echo $echo_n "Shutting down MySQL"
kill $mysqlmanager_pid
# mysqlmanager should remove the pid_file when it exits, so wait for it.
wait_for_pid removed "$mysqlmanager_pid"; return_value=$?
else
log_failure_msg "MySQL manager or server process #$mysqlmanager_pid is not running!"
rm $pid_file
fi

# delete lock for RedHat / SuSE
if test -f $lock_dir
then
rm -f $lock_dir
fi
exit $return_value
else
log_failure_msg "MySQL manager or server PID file could not be found!"
fi
;;

'restart')
# Stop the service and regardless of whether it was
# running or not, start it again.
if $0 stop  $other_args; then
$0 start $other_args
else
log_failure_msg "Failed to stop running server, so refusing to try to start."
exit 1
fi
;;

'reload'|'force-reload')
if test -s "$server_pid_file" ; then
read mysqld_pid &lt;  $server_pid_file
kill -HUP $mysqld_pid &amp;&amp; log_success_msg "Reloading service MySQL"
touch $server_pid_file
else
log_failure_msg "MySQL PID file could not be found!"
exit 1
fi
;;
'status')
# First, check to see if pid file exists
if test -s "$server_pid_file" ; then 
read mysqld_pid &lt; $server_pid_file
if kill -0 $mysqld_pid 2&gt;/dev/null ; then 
log_success_msg "MySQL running ($mysqld_pid)"
exit 0
else
log_failure_msg "MySQL is not running, but PID file exists"
exit 1
fi
else
# Try to find appropriate mysqld process
mysqld_pid=`pidof $libexecdir/mysqld`

# test if multiple pids exist
pid_count=`echo $mysqld_pid | wc -w`
if test $pid_count -gt 1 ; then
log_failure_msg "Multiple MySQL running but PID file could not be found ($mysqld_pid)"
exit 5
elif test -z $mysqld_pid ; then 
if test "$use_mysqld_safe" = "0" ; then 
lockfile=/var/lock/subsys/mysqlmanager
else
lockfile=/var/lock/subsys/mysql
fi 
if test -f $lockfile ; then 
log_failure_msg "MySQL is not running, but lock exists"
exit 2
fi 
log_failure_msg "MySQL is not running"
exit 3
else
log_failure_msg "MySQL is running but PID file could not be found"
exit 4
fi
fi
;;
*)
# usage
echo "Usage: $0  {start|stop|restart|reload|force-reload|status}  [ MySQL server options ]"
exit 1
;;
esac

exit 0
</pre>
</div></li>

<li><p>
php环境运行脚本： <code>php-fpm.sh</code>
</p>

<div class="org-src-container">

<pre class="src src-sh">#!/bin/sh
#
PHP_PATH=/userdisk/data/opt/usr/local/develop
DESC="php-fpm daemon"
NAME=php-fpm
# php-fpm
DAEMON=$PHP_PATH/sbin/$NAME
CONFIGFILE=$PHP_PATH/etc/php-fpm.conf
PIDFILE=/var/run/$NAME.pid

rh_start() {
$DAEMON -c $PHP_PATH/etc -y $CONFIGFILE || echo -n " already running"
}

rh_stop() {
kill -QUIT `cat $PIDFILE` || echo -n " not running"
}

case "$1" in
start)
echo -n "Starting $DESC: $NAME"
rh_start
echo "."
;;
stop)
echo -n "Stopping $DESC: $NAME"
rh_stop
echo "."
;;
restart)
echo -n "Restarting $DESC: $NAME"
rh_stop
sleep 1
rh_start
echo "."
;;
*)
echo "Usage: $SCRIPTNAME {start|stop|restart}" &gt;&amp;2
exit 3
;;
esac
exit 0
</pre>
</div></li>
</ol>
</div>
</div>

<div id="outline-container-orgheadline150" class="outline-5">
<h5 id="orgheadline150"><span class="section-number-5">5.2.6.4</span> 创建数据库根用户帐号与http帐号</h5>
<div class="outline-text-5" id="text-5-2-6-4">
<p>
数据库帐号用于登录和操作数据库，http帐号是访问某些Owncloud安装目录子目录数据所需要的帐号。
</p>

<p>
该过程只需执行一次，如下：
</p>

<div class="org-src-container">

<pre class="src src-sh">$./mysql.server start
$mysqladmin -u root password '&lt;根用户密码&gt;'
$vim /etc/passwd
...添加www-data用户类似如下...
www-data:x:1024:1024:www-data:/root:/bin/ash
$vim /etc/group
...添加www-data组类似如下...
www-data:x:1024:
</pre>
</div>
</div>
</div>
<div id="outline-container-orgheadline151" class="outline-5">
<h5 id="orgheadline151"><span class="section-number-5">5.2.6.5</span> readme</h5>
<div class="outline-text-5" id="text-5-2-6-5">
<pre class="example">
(one time)1. ./install.sh
3. ./mysql.server start
(one time)4. mysqladmin -u root password '&lt;6+&gt;'
(one time)5. edit
/etc/passwd
www-data:x:1024:1024:www-data:/root:/bin/ash
/etc/group
www-data:x:1024:
6. ./php-fpm.sh start
(one time every two year)7.openssl
export OPENSSL_CONF=/userdisk/data/opt/usr/local/develop/ssl/openssl.cnf
openssl genrsa -des3 -out server.key 1024
openssl req -new -key server.key -out server.csr

cp server.key server.key.org
openssl rsa -in server.key.org -out server.key
openssl x509 -req -days 730 -in server.csr -signkey server.key -out server.crt
8. ./nginx.sh start


mkdir /userdisk/data/web/mycloud/oc_data
mkdir /userdisk/data/usr/local/develop/tmp
chmod -R 777 /userdisk/data/usr/local/develop/tmp
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline45" class="outline-3">
<h3 id="orgheadline45"><a id="ID-8a9f336b-8b34-4a69-966d-d8b33c3d9e60"></a><span class="section-number-3">5.3</span> 参考资料</h3>
<div class="outline-text-3" id="text-5-3">
<p>
云存储相关：
seafile:开源，部分收费（比如目录选择性同步、搜索、文件读写控制）,服务还不错，界面比较简陋。
<a href="https://www.seafile.com/download/">https://www.seafile.com/download/</a>
</p>

<p>
*own cloud：开源，免费，服务一般，有人反映卡，功能齐全，支持平台多。
<a href="https://owncloud.org/">https://owncloud.org/</a>
</p>

<p>
SparkleShare（开源免费，不支持IOS，使用git做为引擎，中文支持差？）
<a href="http://www.oschina.net/p/sparkleshare/similar_projects?lang=25&amp;sort=time">http://www.oschina.net/p/sparkleshare/similar_projects?lang=25&amp;sort=time</a>
</p>

<p>
云存储架构cloudstack vs openstack
<a href="http://infosec.blog.51cto.com/226250/1565179">http://infosec.blog.51cto.com/226250/1565179</a>
</p>

<p>
介绍Linux下常见的开源云平台&amp;&amp;存储服务
<a href="http://blog.csdn.net/gatieme/article/details/44977487">http://blog.csdn.net/gatieme/article/details/44977487</a>
</p>

<p>
对比sparkleshare、owncloud、seafile
<a href="https://www.reddit.com/r/linux/comments/1efdnd/sparkleshare_owncloud_or_seafile/">https://www.reddit.com/r/linux/comments/1efdnd/sparkleshare_owncloud_or_seafile/</a>
</p>

<p>
三大WEB服务器对比分析
<a href="http://hai0378.iteye.com/blog/1860220">http://hai0378.iteye.com/blog/1860220</a>
</p>

<p>
openssl key的生成
<a href="http://www.poluoluo.com/server/201401/261178.html">http://www.poluoluo.com/server/201401/261178.html</a>
</p>


<p>
nginx配置相关
<a href="http://www.nginx.cn/591.html">http://www.nginx.cn/591.html</a>
</p>

<p>
文件同步工具：
<a href="http://alternativeto.net/software/goodsync/">http://alternativeto.net/software/goodsync/</a>
</p>

<p>
<a href="http://www.pc6.com/pc/wenjiantongburj/">http://www.pc6.com/pc/wenjiantongburj/</a>
</p>

<p>
小米路由安装nginx：
<a href="http://www.miui.com/thread-2592877-1-1.html">http://www.miui.com/thread-2592877-1-1.html</a>
</p>

<p>
小米路由器交叉编译php：
<a href="http://bbs.xiaomi.cn/t-11228942">http://bbs.xiaomi.cn/t-11228942</a>
</p>

<p>
小米开放平台
<a href="http://www.miwifi.com/miwifi_open.html">http://www.miwifi.com/miwifi_open.html</a>
</p>
</div>
</div>
</div>


<div id="outline-container-orgheadline46" class="outline-2">
<h2 id="orgheadline46"><a id="ID-41a0f28c-65fa-4092-93e1-1562271e1702"></a><span class="section-number-2">6</span> 小米路由器上使用 <code>git</code> 版本控制系统</h2>
<div class="outline-text-2" id="text-6">
</div>

<div id="outline-container-orgheadline47" class="outline-3">
<h3 id="orgheadline47"><span class="section-number-3">6.1</span> 下载 <code>git</code> 源码</h3>
<div class="outline-text-3" id="text-6-1">
<div class="org-src-container">

<pre class="src src-sh">$wget --no-check-certificate -c https://codeload.github.com/git/git/tar.gz/v2.8.2
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline48" class="outline-3">
<h3 id="orgheadline48"><span class="section-number-3">6.2</span> 非交叉编译 <code>git</code> 过程</h3>
<div class="outline-text-3" id="text-6-2">
<p>
先了解一下非交叉编译的过程，再进行交叉编译。
</p>
<ol class="org-ol">
<li><p>
生成配置脚本
</p>
<div class="org-src-container">

<pre class="src src-sh">$tar -xzvf git-2.8.2.tar.gz
$cd git-2.8.2
$make configure
$./configure --prefix=/usr/local/develop --without-tcltk
</pre>
</div>
<p>
执行完 <code>configure</code> 之后，会生成一个 <code>config.mak.autogen</code> 文件， <code>Makefile</code> 中会包含这个文件。
</p></li>

<li><p>
手动配置编译模块
</p>

<p>
根据 <code>INSTALL</code> 介绍，按需配置需要需掉的编译模块，修改 <code>config.mak.autogen</code>
</p>
<div class="org-src-container">

<pre class="src src-sh">$vim config.mak.autogen
...
####Custom
NO_PERL=YesPlease
#NO_TCLTK=YesPlease

$make all
</pre>
</div>
<p>
<code>git</code> 有些功能还是需要外部依赖的，这里，将 <code>perl</code> 和 <code>tcltk</code> 相关内容去掉。会影响的功能，参见 <code>INSTALL</code> 介绍。
</p>

<p>
实际执行完 <code>make all</code> 后，就可在当前目录中运行 <code>./git</code> 进行测试了。
</p></li>
</ol>
</div>
</div>

<div id="outline-container-orgheadline49" class="outline-3">
<h3 id="orgheadline49"><span class="section-number-3">6.3</span> 交叉编译 <code>git</code></h3>
<div class="outline-text-3" id="text-6-3">
</div><div id="outline-container-orgheadline50" class="outline-4">
<h4 id="orgheadline50"><span class="section-number-4">6.3.1</span> 配置交叉编译环境路径</h4>
<div class="outline-text-4" id="text-6-3-1">
<p>
参考：<a href="#orgheadline63">小米路由器交叉编译环境配置</a>
</p>
</div>
</div>

<div id="outline-container-orgheadline51" class="outline-4">
<h4 id="orgheadline51"><span class="section-number-4">6.3.2</span> 生成配置脚本</h4>
<div class="outline-text-4" id="text-6-3-2">
<div class="org-src-container">

<pre class="src src-sh">$tar -xzvf git-2.8.2.tar.gz
$cd git-2.8.2
$make configure
$./configure --host=arm-xiaomi-linux-uclibcgnueabi --prefix=/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop --with-curl=/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop/lib --without-tcltk CC=arm-xiaomi-linux-uclibcgnueabi-gcc LDFLAGS=-L/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop/lib CFLAGS=-I/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop/include CPPFLAGS=-I/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop/include
</pre>
</div>
<p>
执行完 <code>configure</code> 之后，会生成一个 <code>config.mak.autogen</code> 文件， <code>Makefile</code> 中会包含这个文件。
</p>

<p>
注意，运行 <code>configure</code> 之前，需要如下修改 <code>configure</code> 脚本，否则会出现无法运行测试文件相关的错误。修改如下：
</p>
<div class="org-src-container">

<pre class="src src-sh">$vim configure
...
6250 if test "$cross_compiling" = yes; then :                                                                                                         
6251     echo "skip corss_compiling test";
6252 #  { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" &gt;&amp;5
6253 #$as_echo "$as_me: error: in \`$ac_pwd':" &gt;&amp;2;}
6254 #as_fn_error $? "cannot run test program while cross compiling
6255 #See \`config.log' for more details" "$LINENO" 5; }
...
6300 if test "$cross_compiling" = yes; then :
6301     echo "skip corss_compiling test";                                                                                                            
6302 #  { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" &gt;&amp;5
6303 #$as_echo "$as_me: error: in \`$ac_pwd':" &gt;&amp;2;}
6304 #as_fn_error $? "cannot run test program while cross compiling
6305 #See \`config.log' for more details" "$LINENO" 5; }
6306 else
...
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline52" class="outline-4">
<h4 id="orgheadline52"><span class="section-number-4">6.3.3</span> 编译、安装</h4>
<div class="outline-text-4" id="text-6-3-3">
<div class="org-src-container">

<pre class="src src-sh">$make all
$make install
</pre>
</div>
<p>
至此， <code>git</code> 的交叉编译完成，部署到服务器添加环境变量后上即可运行。
</p>

<p>
注意，编译之前需要修改 <code>Makefile</code> 使用交叉编译工具链
</p>
<div class="org-src-container">

<pre class="src src-sh">$vim Makefile
...
439 CC = arm-xiaomi-linux-uclibcgnueabi-cc                                                                                                           
440 AR = arm-xiaomi-linux-uclibcgnueabi-ar
...
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline53" class="outline-4">
<h4 id="orgheadline53"><span class="section-number-4">6.3.4</span> 部署与配置</h4>
<div class="outline-text-4" id="text-6-3-4">
<p>
由于编译、安装时本地目录与部署的目录不同，运行的时候可能会出现各种问题。建议本地安装的目录和部署目录尽量一致。(考虑 <code>chroot</code> ?)
</p>

<p>
假设编译时安装的路径为： <code>/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop</code>
</p>

<p>
部署的路径为： <code>/userdisk/data/opt/usr/local/develop</code>
</p>

<p>
根据 <code>man</code> 手册，
运行: <code>git config --system xxx</code> 会读写 <code>/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop/etc</code> 路径（小米路由器上不存在）
</p>

<p>
运行: <code>git config --global xxx</code> 会读写 <code>~/.gitconfig</code> (小米路由器只读)
</p>

<p>
运行: <code>git config xxx</code> 会读写 <code>.git/config</code>, 对于第一次运行的来说，不存在这个路径。
</p>

<p>
意图最初的配置文件在 <code>/userdisk/data/opt/usr/local/develop/etc/gitconfig</code> 读取，（因为无法操作 <code>system</code> 的以及 <code>global</code> 的配置）
</p>

<p>
所以，有几个方法在第一次运行git时指定配置：
</p>
<ol class="org-ol">
<li><p>
配置 <code>GIT_CONFIG</code>
</p>
<div class="org-src-container">

<pre class="src src-sh">$export GIT_CONFIG=/userdisk/data/opt/usr/local/develop/etc/gitconfig
$git config init.templatedir /userdisk/data/opt/usr/local/develop/share/git-core/templates
</pre>
</div>

<p>
但是这样会修改已有的 <code>local</code> 的 config, 行为，使之在已有git repo中运行时，不会修改其 <code>.git/config</code>
</p></li>

<li><p>
命令行中指定路径
</p>
<div class="org-src-container">

<pre class="src src-sh">$git -C &lt;config path&gt; xxx
</pre>
</div>
<p>
但是这样默认会在路径中寻找 <code>config</code> 的文件，实践似乎不管用。
</p></li>

<li><p>
命令行指定选项
</p>
<div class="org-src-container">

<pre class="src src-sh">$git -c init.templatedir=/userdisk/data/opt/usr/local/develop/share/git-core/templates clone xxx
</pre>
</div></li>
</ol>


<ol class="org-ol">
<li><p>
开启标准路径文件写权限。
</p>

<p>
执行下述命令即可：
</p>
<div class="org-src-container">

<pre class="src src-sh">$mount -o remount -rw /
</pre>
</div>

<p>
参考：<a href="#orgheadline65">开启ssh后无法获得系统文件夹写入权限?</a>
</p></li>
</ol>

<p>
注意了，第一次运行，一定要指定好 <code>git config init.templatedir /userdisk/data/opt/usr/local/develop/share/git-core/templates</code>
</p>

<p>
最后，当已经有了一个仓库之时，直接用 <code>git config</code> 为相应的本地库设置好那些需要设置的选项，默认系统最好设置如下内容如：
</p>
<div class="org-src-container">

<pre class="src src-sh">$git config --global init.templatedir /userdisk/data/opt/usr/local/develop/share/git-core/templates
$git config --global http.sslVerify false
$git config --global user.name "quietheart@xiaomi"
$git config --global user.email "vaqeteart@qq.com"
</pre>
</div>

<p>
这些信息保存在 <code>~/.gitconfig</code> 中。
</p>
</div>
</div>

<div id="outline-container-orgheadline54" class="outline-4">
<h4 id="orgheadline54"><span class="section-number-4">6.3.5</span> <span class="todo WAIT_FORWARD">WAIT/FORWARD</span> FAQ <code>[%]</code><code>[/]</code></h4>
<div class="outline-text-4" id="text-6-3-5">
<ul class="org-ul">
<li>State "WAIT/FORWARD" from              <span class="timestamp-wrapper"><span class="timestamp">[2016-08-09 二 15:36] </span></span> <br  />
wait for all done.</li>
</ul>
</div>
<div id="outline-container-orgheadline152" class="outline-5">
<h5 id="orgheadline152"><span class="section-number-5">6.3.5.1</span> <span class="done DONE">DONE</span> fatal: Unable to find remote helper for 'https'</h5>
<div class="outline-text-5" id="text-6-3-5-1">
<ul class="org-ul">
<li>State "DONE"       from              <span class="timestamp-wrapper"><span class="timestamp">[2016-07-27 三 09:24]</span></span></li>
</ul>
<p>
添加路径: <code>export PATH=$PATH:/userdisk/data/opt/usr/local/develop/libexec/git-core</code>
</p>
</div>
</div>

<div id="outline-container-orgheadline153" class="outline-5">
<h5 id="orgheadline153"><span class="section-number-5">6.3.5.2</span> <span class="done DONE">DONE</span> warning: templates not found /home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop/share/git-core/templates</h5>
<div class="outline-text-5" id="text-6-3-5-2">
<ul class="org-ul">
<li>State "DONE"       from              <span class="timestamp-wrapper"><span class="timestamp">[2016-07-27 三 09:24]</span></span></li>
</ul>
<p>
命令中指定templates： <code>git -c init.templatedir=/userdisk/data/opt/usr/local/develop/share/git-core/templates clone htt
ps://vaqeteart@bitbucket.org/vaqeteart/quietheart.git</code>
or in config file:
</p>
<pre class="example">
[init]
     templatedir = /userdisk/data/opt/usr/local/develop/share/git-core/templates
</pre>
</div>
</div>

<div id="outline-container-orgheadline154" class="outline-5">
<h5 id="orgheadline154"><a id="ID-c7960eeb-4799-49d8-93f6-53c696cb1303"></a><span class="section-number-5">6.3.5.3</span> <span class="done DONE">DONE</span> Protocol "https" not supported or disabled in libcurl</h5>
<div class="outline-text-5" id="text-6-3-5-3">
<ul class="org-ul">
<li>State "DONE"       from              <span class="timestamp-wrapper"><span class="timestamp">[2016-07-27 三 09:24]</span></span></li>
</ul>
<p>
编译 <code>libcurl</code> 之时需要加入相关选项：
</p>
<div class="org-src-container">

<pre class="src src-sh">./configure --host=arm-xiaomi-linux-uclibcgnueabi --enable-static --prefix=/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop --enable-http --with-ssl=/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop/ CC=arm-xiaomi-linux-uclibcgnueabi-gcc
</pre>
</div>

<p>
之后再编译 <code>git</code>
</p>

<p>
注意，编译 <code>libcurl</code> 如果出现无法链接 <code>libssl.a</code>, 需要加入 <code>-fPIC</code> 重新编译 <code>openssl</code>, 编译完成之后，运行 <code>curl --version</code> 即可看到支持不支持 <code>https</code> 。
</p>
</div>
</div>

<div id="outline-container-orgheadline155" class="outline-5">
<h5 id="orgheadline155"><span class="section-number-5">6.3.5.4</span> xiaomi路由器上建立一个本地仓库后，最好用什么配置做为默认的本地仓库配置？</h5>
<div class="outline-text-5" id="text-6-3-5-4">
<p>
如下：
</p>
<div class="org-src-container">

<pre class="src src-sh">$git config init.templatedir /userdisk/data/opt/usr/local/develop/share/git-core/templates
$git config http.sslVerify false
$git config receive.denycurrentbranch ignore
</pre>
</div>
</div>
</div>
<div id="outline-container-orgheadline156" class="outline-5">
<h5 id="orgheadline156"><span class="section-number-5">6.3.5.5</span> <span class="todo WAIT_FORWARD">WAIT/FORWARD</span> SSL certificate problem: unable to get local issuer certificate</h5>
<div class="outline-text-5" id="text-6-3-5-5">
<ul class="org-ul">
<li>State "WAIT/FORWARD" from "NEXT"       <span class="timestamp-wrapper"><span class="timestamp">[2016-08-09 二 15:34] </span></span> <br  />
wair for more secury method.</li>
<li>State "NEXT"       from              <span class="timestamp-wrapper"><span class="timestamp">[2016-07-27 三 09:24]</span></span></li>

<li><p>
方法1：命令行中禁用 <code>https</code> 验证（不安全）
</p>
<div class="org-src-container">

<pre class="src src-sh">$git -c init.templatedir=/userdisk/data/opt/usr/local/develop/share/git-core/templates -c http.sslVerify=false clone https://vaqeteart@bitbucket.org/vaqeteart/quietheart.git
</pre>
</div></li>

<li><p>
方法2：环境变量禁用 <code>https</code> 验证（不安全）
</p>
<div class="org-src-container">

<pre class="src src-sh">$export GIT_SSL_NO_VERIFY=true
$git -c init.templatedir=/userdisk/data/opt/usr/local/develop/share/git-core/templates clone https://github.com/vaqeteart/vaqeteart.github.io
</pre>
</div></li>

<li>方法3：ssh-keygen??</li>
</ul>
</div>
</div>

<div id="outline-container-orgheadline157" class="outline-5">
<h5 id="orgheadline157"><span class="section-number-5">6.3.5.6</span> <span class="done DONE">DONE</span> 其他主机如何clone库？</h5>
<div class="outline-text-5" id="text-6-3-5-6">
<ul class="org-ul">
<li>State "DONE"       from "NEXT"       <span class="timestamp-wrapper"><span class="timestamp">[2016-08-09 二 15:35]</span></span></li>
<li>State "NEXT"       from "DONE"       <span class="timestamp-wrapper"><span class="timestamp">[2016-08-03 三 19:37]</span></span></li>
<li>State "DONE"       from "DONE"       <span class="timestamp-wrapper"><span class="timestamp">[2016-08-03 三 19:37]</span></span></li>
<li>State "DONE"       from "NEXT"       <span class="timestamp-wrapper"><span class="timestamp">[2016-07-28 四 17:04]</span></span></li>
<li>State "NEXT"       from              <span class="timestamp-wrapper"><span class="timestamp">[2016-07-28 四 17:02]</span></span></li>
</ul>

<p>
如果开启了ssh功能，假设小米路由器上的git库路径为 <code>/path/to/gitrepo</code>, 账户为 <code>user</code>, 密码为 <code>passwd</code>, 那么其它主机只需要：
</p>
<div class="org-src-container">

<pre class="src src-sh">$git clone user@ip:/path/to/gitrepo .
....根据提示输入密码passwd....
</pre>
</div>

<p>
由于小米路由器上的ssh端口做了映射，所以clone之前，先将主机上的 <code>.ssh/config</code> 中加入类似如下：
</p>
<pre class="example">
Host xiaomi
HostName &lt;主机域名或者ip&gt;
User user
Port &lt;被映射的端口&gt;
IdentityFile ~/.ssh/id_rsa
</pre>

<p>
之后只需如下进行：
</p>
<div class="org-src-container">

<pre class="src src-sh">$git clond ssh://xiaomi:&lt;path&gt;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline158" class="outline-5">
<h5 id="orgheadline158"><span class="section-number-5">6.3.5.7</span> <span class="done DONE">DONE</span> <code>ash: git-upload-pack: not found</code></h5>
<div class="outline-text-5" id="text-6-3-5-7">
<ul class="org-ul">
<li>State "DONE"       from "NEXT"       <span class="timestamp-wrapper"><span class="timestamp">[2016-08-09 二 15:35]</span></span></li>
<li>State "NEXT"       from              <span class="timestamp-wrapper"><span class="timestamp">[2016-08-03 三 19:37]</span></span></li>
</ul>

<p>
主要是运行 <code>git-upload-pack</code> 的路径不对。
</p>

<ol class="org-ol">
<li>命令行中指定</li>
</ol>
<div class="org-src-container">

<pre class="src src-sh">$git clone --upload-pack "/userdisk/data/opt/usr/local/develop/bin/git-upload-pack" ssh://xxx
</pre>
</div>

<p>
或在服务器上，为 <code>git-upload-pack</code> 建立软链接，类似如下：
</p>
<div class="org-src-container">

<pre class="src src-sh">$ln -s /userdisk/data/opt/usr/local/develop/bin/git-upload-pack /usr/bin
</pre>
</div>

<p>
参考:
</p>

<p>
<a href="http://stackoverflow.com/questions/11128464/git-upload-pack-command-not-found">http://stackoverflow.com/questions/11128464/git-upload-pack-command-not-found</a>
</p>

<p>
<a href="http://www.linuxidc.com/Linux/2012-07/66270.htm">http://www.linuxidc.com/Linux/2012-07/66270.htm</a>
</p>
</div>
</div>

<div id="outline-container-orgheadline159" class="outline-5">
<h5 id="orgheadline159"><span class="section-number-5">6.3.5.8</span> <span class="done DONE">DONE</span> error: cannot run pack-objects: No such file or directory</h5>
<div class="outline-text-5" id="text-6-3-5-8">
<ul class="org-ul">
<li>State "DONE"       from "NEXT"       <span class="timestamp-wrapper"><span class="timestamp">[2016-08-09 二 15:35]</span></span></li>
<li>State "NEXT"       from              <span class="timestamp-wrapper"><span class="timestamp">[2016-08-08 一 14:17]</span></span></li>
</ul>
<p>
类似前面，为全部git组件创建软链接的方式最简单（创建之前最好能检查一下已有的）：
</p>

<div class="org-src-container">

<pre class="src src-sh">$ln -s /userdisk/data/opt/usr/local/develop/libexec/git-core/* /usr/bin
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline160" class="outline-5">
<h5 id="orgheadline160"><span class="section-number-5">6.3.5.9</span> <span class="done DONE">DONE</span> <code>error: failed to push some refs to 'ssh://xiaomi</code></h5>
<div class="outline-text-5" id="text-6-3-5-9">
<ul class="org-ul">
<li>State "DONE"       from "NEXT"       <span class="timestamp-wrapper"><span class="timestamp">[2016-08-09 二 15:35]</span></span></li>
<li>State "NEXT"       from              <span class="timestamp-wrapper"><span class="timestamp">[2016-08-08 一 14:17]</span></span></li>
</ul>

<p>
远程客户端运行 <code>git push</code> 之时出现，应当在服务端为当前git仓库打开允许 <code>push</code> 的选项，如下：
</p>
<div class="org-src-container">

<pre class="src src-sh">$git config receive.denycurrentbranch ignore
</pre>
</div>

<p>
推送之后，到服务端上（xiaomi路由器上），可用 <code>git log</code> 查看到远端的修改，但是其工作目录中如果包含工作文件的话，推送的内容不会反映到工作目录中。
</p>

<p>
这个时候，应当将工作目录中的内容备份，然后:
</p>
<div class="org-src-container">

<pre class="src src-sh">$git reset --hard
</pre>
</div>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline55" class="outline-2">
<h2 id="orgheadline55"><span class="section-number-2">7</span> Misc</h2>
<div class="outline-text-2" id="text-7">
</div><div id="outline-container-orgheadline56" class="outline-3">
<h3 id="orgheadline56"><a id="ID-96bd1991-9c0f-4869-b406-c6eced64bd6b"></a><span class="section-number-3">7.1</span> 小米路由器添加ddns</h3>
<div class="outline-text-3" id="text-7-1">
<p>
ddns可以实现当ip地址不固定的时候，也能通过域名正确访问到相应的路由器。
</p>

<p>
大致原理是需要有一个ddns服务提供商，然后路由器定时、及时地将ip地址变化信息及时更新给ddns服务商，ddns服务商将域名与最新的ip地址相对应。
</p>

<p>
在路由器web管理界面上有相应的选项，建议用花生壳提供的动态路由。现在花生壳注册用户名和密码，获取到一个免费的域名，再将账户信息填写到路由器中ddns的相应位置即可。
</p>
</div>
</div>

<div id="outline-container-orgheadline57" class="outline-3">
<h3 id="orgheadline57"><a id="ID-f5bb8834-de46-4077-bddc-e0a15b1dc790"></a><span class="section-number-3">7.2</span> 小米路由器修改ssh启动的欢迎语</h3>
<div class="outline-text-3" id="text-7-2">
<p>
修改 <code>/etc/banner</code> 文件。
</p>
</div>
</div>
</div>
<div id="outline-container-orgheadline58" class="outline-2">
<h2 id="orgheadline58"><span class="section-number-2">8</span> <span class="todo WAIT_FORWARD">WAIT/FORWARD</span> FAQ <code>[12/19]</code> <code>[63%]</code></h2>
<div class="outline-text-2" id="text-8">
<ul class="org-ul">
<li>State "WAIT/FORWARD" from              <span class="timestamp-wrapper"><span class="timestamp">[2016-04-07 四 18:52] </span></span> <br  />
wait for all resolved.</li>
</ul>
</div>
<div id="outline-container-orgheadline59" class="outline-3">
<h3 id="orgheadline59"><span class="section-number-3">8.1</span> <span class="done DONE">DONE</span> 小米路由如何开启ssh?</h3>
<div class="outline-text-3" id="text-8-1">
<ul class="org-ul">
<li>State "DONE"       from "WAIT/FORWARD" <span class="timestamp-wrapper"><span class="timestamp">[2016-04-16 六 18:21]</span></span></li>
<li>State "WAIT/FORWARD" from "DONE"       <span class="timestamp-wrapper"><span class="timestamp">[2016-04-07 四 18:58] </span></span> <br  />
等待整理。</li>
<li>State "DONE"       from "INBOX"      <span class="timestamp-wrapper"><span class="timestamp">[2016-03-14 一 17:12]</span></span></li>
</ul>
<p>
Capture Time:<span class="timestamp-wrapper"><span class="timestamp">[2016-03-02 三 14:56]</span></span>
</p>
<hr  />
<p>
开启ssh可以本地局域网登录的方法，参考：<a href="#orgheadline1">小米路由器ssh开启</a>
</p>

<p>
官网：
<a href="http://www.miwifi.com/miwifi_open.html">http://www.miwifi.com/miwifi_open.html</a>
</p>

<p>
外网访问参考：
<a href="http://jingyan.baidu.com/article/9113f81b3a5d982b3314c74a.html?st=3&amp;net_type=2&amp;bd_page_type=1&amp;os=0&amp;showimg=1&amp;rst=6">http://jingyan.baidu.com/article/9113f81b3a5d982b3314c74a.html?st=3&amp;net_type=2&amp;bd_page_type=1&amp;os=0&amp;showimg=1&amp;rst=6</a>
</p>

<p>
如果实现公网访问，需要开启防火墙端口。
</p>
</div>

<div id="outline-container-orgheadline60" class="outline-4">
<h4 id="orgheadline60"><span class="section-number-4">8.1.1</span> 下面内容仅参考暂不用</h4>
<div class="outline-text-4" id="text-8-1-1">
<p>
小米路由器mini如何设置外网访问ssh
</p>

<p>
关键是
修改 <code>/etc/config/firewall</code>
</p>
<pre class="example">
# port redirect of remapped ssh port (22001) on wan
config redirect 'myssh'       
option src              wan       
option src_dport        22001       
option dest             lan       
option dest_port        22       
option proto            tcp
</pre>

<p>
重启防火墙 <code>/etc/init.d/firewall restart</code>
</p>

<p>
登录： <code>ssh -p 10022 root@&lt;ip&gt;</code>
</p>

<p>
远程传输： <code>scp -P 10022 &lt;file&gt; root@&lt;ip&gt;:&lt;path&gt;</code>
</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline61" class="outline-3">
<h3 id="orgheadline61"><span class="section-number-3">8.2</span> <span class="done DONE">DONE</span> 小米路由器防火墙如何配置?</h3>
<div class="outline-text-3" id="text-8-2">
<ul class="org-ul">
<li>State "DONE"       from "WAIT/FORWARD" <span class="timestamp-wrapper"><span class="timestamp">[2016-04-13 三 19:35]</span></span></li>
<li>State "WAIT/FORWARD" from "INBOX"      <span class="timestamp-wrapper"><span class="timestamp">[2016-03-28 一 11:27] </span></span> <br  />
wait for more organize.</li>
<li>State "INBOX"      from              <span class="timestamp-wrapper"><span class="timestamp">[2016-03-15 二 09:38]</span></span></li>
</ul>

<p>
参见：<a href="#orgheadline12">小米路由器防火墙配置</a>
</p>
</div>
</div>

<div id="outline-container-orgheadline62" class="outline-3">
<h3 id="orgheadline62"><span class="section-number-3">8.3</span> <span class="done DONE">DONE</span> 小米路由如何添加域名访问？</h3>
<div class="outline-text-3" id="text-8-3">
<ul class="org-ul">
<li>State "DONE"       from "INBOX"      <span class="timestamp-wrapper"><span class="timestamp">[2016-04-13 三 19:42]</span></span></li>
</ul>
<p>
Capture Time:<span class="timestamp-wrapper"><span class="timestamp">[2016-03-02 三 14:56]</span></span>
</p>
<hr  />
<p>
首先申请dns域名，然后将之与ip关联，但是由于ip地址不固定，所以需要使用ddns服务。参见：<a href="#orgheadline56">小米路由器添加ddns</a>
</p>
</div>
</div>

<div id="outline-container-orgheadline63" class="outline-3">
<h3 id="orgheadline63"><a id="ID-c3532fb4-fe93-448b-be0c-a7f443999174"></a><span class="section-number-3">8.4</span> <span class="done DONE">DONE</span> 小米路由器交叉编译环境配置</h3>
<div class="outline-text-3" id="text-8-4">
<ul class="org-ul">
<li>State "DONE"       from "WAIT/FORWARD" <span class="timestamp-wrapper"><span class="timestamp">[2016-08-08 一 17:23]</span></span></li>
<li>State "WAIT/FORWARD" from "DONE"       <span class="timestamp-wrapper"><span class="timestamp">[2016-08-08 一 11:42] </span></span> <br  />
wait for arrange.</li>
<li>State "DONE"       from              <span class="timestamp-wrapper"><span class="timestamp">[2016-07-26 二 16:59]</span></span></li>
</ul>

<p>
参考：<a href="#orgheadline24">小米路由器交叉编译环境配置</a>
</p>
</div>
</div>

<div id="outline-container-orgheadline64" class="outline-3">
<h3 id="orgheadline64"><span class="section-number-3">8.5</span> <span class="done DONE">DONE</span> 如何使用软件管理工具管理小米路由上的软件?</h3>
<div class="outline-text-3" id="text-8-5">
<ul class="org-ul">
<li>State "DONE"       from "INBOX"      <span class="timestamp-wrapper"><span class="timestamp">[2016-04-16 六 18:19]</span></span></li>
</ul>
<p>
Capture Time:<span class="timestamp-wrapper"><span class="timestamp">[2016-03-04 五 18:28]</span></span>
</p>
<hr  />
<p>
小米路由器是openwrt的系统，可借助opkg工具，参考：<a href="#orgheadline16">使用opkg在小米路由器软件管理</a>
</p>
</div>
</div>

<div id="outline-container-orgheadline65" class="outline-3">
<h3 id="orgheadline65"><a id="ID-c4e46793-af9e-4f13-ba43-f609a121c196"></a><span class="section-number-3">8.6</span> <span class="done DONE">DONE</span> 开启ssh后无法获得系统文件夹写入权限?</h3>
<div class="outline-text-3" id="text-8-6">
<ul class="org-ul">
<li>State "DONE"       from "WAIT/FORWARD" <span class="timestamp-wrapper"><span class="timestamp">[2016-08-08 一 17:25]</span></span></li>
<li>State "WAIT/FORWARD" from              <span class="timestamp-wrapper"><span class="timestamp">[2016-08-05 五 17:21] </span></span> <br  />
wait for more.</li>
</ul>

<p>
参考：<a href="#orgheadline11">访问文件系统权限</a>
</p>
</div>
</div>

<div id="outline-container-orgheadline66" class="outline-3">
<h3 id="orgheadline66"><span class="section-number-3">8.7</span> <span class="done DONE">DONE</span> 在小米路由器上搭建基于LNMP的Owncloud云平台</h3>
<div class="outline-text-3" id="text-8-7">
<ul class="org-ul">
<li>State "DONE"       from "WAIT/FORWARD" <span class="timestamp-wrapper"><span class="timestamp">[2016-08-08 一 17:37]</span></span></li>
<li>State "WAIT/FORWARD" from "DONE"       <span class="timestamp-wrapper"><span class="timestamp">[2016-04-16 六 16:45] </span></span> <br  />
wait for arrange.</li>
<li>State "DONE"       from "INBOX"      <span class="timestamp-wrapper"><span class="timestamp">[2016-04-16 六 16:45]</span></span></li>
</ul>
<p>
Capture Time:<span class="timestamp-wrapper"><span class="timestamp">[2016-03-04 五 19:55]</span></span>
</p>
<hr  />

<p>
注，Owncloud功能比较全面，但是也相对不是很稳定，而且感觉消耗资源。对于资源紧张的小米路由器，目前已经不考虑用其做为主要云服务器。暂时用git来满足分布访问的需求。直接考虑的方式，获取有更好的能替代Owncloud的方式。
</p>

<p>
参考：<a href="#orgheadline25">在小米路由器上搭建基于LNMP的Owncloud云平台</a>
</p>
</div>
</div>

<div id="outline-container-orgheadline67" class="outline-3">
<h3 id="orgheadline67"><span class="section-number-3">8.8</span> <span class="done CANCEL">CANCEL</span> Myowncloud</h3>
<div class="outline-text-3" id="text-8-8">
<ul class="org-ul">
<li>State "CANCEL"     from "WAIT/FORWARD" <span class="timestamp-wrapper"><span class="timestamp">[2016-08-08 一 17:33] </span></span> <br  />
Owncloud不稳定，数据虽然不会丢失，但是有时也很麻烦，已经不采用，此处仅供参考。</li>
<li>State "WAIT/FORWARD" from              <span class="timestamp-wrapper"><span class="timestamp">[2016-08-08 一 17:32] </span></span> <br  />
wait for arrange.</li>
</ul>

<p>
注，Owncloud功能比较全面，但是也相对不是很稳定，而且感觉消耗资源。对于资源紧张的小米路由器，目前已经不考虑用其做为主要云服务器。暂时用git来满足分布访问的需求。直接考虑的方式，获取有更好的能替代Owncloud的方式。
</p>
</div>

<div id="outline-container-orgheadline68" class="outline-4">
<h4 id="orgheadline68"><span class="section-number-4">8.8.1</span> site: &lt;暂不可用&gt;</h4>
</div>
<div id="outline-container-orgheadline69" class="outline-4">
<h4 id="orgheadline69"><span class="section-number-4">8.8.2</span> step</h4>
<div class="outline-text-4" id="text-8-8-2">
</div><div id="outline-container-orgheadline167" class="outline-5">
<h5 id="orgheadline167"><span class="section-number-5">8.8.2.1</span> 安装apache(pc)</h5>
<div class="outline-text-5" id="text-8-8-2-1">
<p>
这里，安装apache之前需要安装组件：apr,apr-util,pcre，最后再安装httpd。
</p>

<p>
这里，发现nginx更适合，所以不用apache了。
</p>
</div>

<ol class="org-ol"><li><a id="orgheadline161"></a>下载<br  /><div class="outline-text-6" id="text-8-8-2-1-1">
<div class="org-src-container">

<pre class="src src-sh">$ wget -c http://apache.opencas.org//httpd/httpd-2.4.18.tar.bz2
$ wget -c http://mirrors.cnnic.cn/apache//apr/apr-1.5.2.tar.bz2
$ wget -c http://apache.opencas.org//apr/apr-util-1.5.4.tar.gz
$ wget -c ftp://ftp.csx.cam.ac.uk/pub/software/programming/pcre/pcre-8.38.tar.gz
</pre>
</div>
</div></li>

<li><a id="orgheadline162"></a>安装<br  /><div class="outline-text-6" id="text-8-8-2-1-2">
<div class="org-src-container">

<pre class="src src-sh">$sudo ./configure --prefix=/usr/local/development/apr-1.5.2
$sudo make
$sudo make install

$sudo ./configure --prefix=/usr/local/development/apr-util-1.5.4 --with-apr=/usr/local/development/apr-1.5.2
$sudo make
$sudo make install

$sudo ./configure --prefix=/usr/local/development/pcre-8.38 --with-apr=/usr/local/development/apr-1.5.2 --with-apr-util=/usr/local/development/apr-util-1.5.4
$sudo make
$sudo make install

$sudo ./configure --prefix=/usr/local/development/httpd-2.4.18 --enable-so --enable-mods-shared=all --with-apr=/usr/local/development/apr-1.5.2 --with-apr-util=/usr/local/development/apr-util-1.5.4 --with-pcre=/usr/local/development/pcre-8.38
$sudo make
$sudo make install
$sudo ln -s /usr/local/development/httpd-2.4.18/bin/apachectl /etc/init.d
</pre>
</div>
</div></li>

<li><a id="orgheadline163"></a>启动<br  /><div class="outline-text-6" id="text-8-8-2-1-3">
<div class="org-src-container">

<pre class="src src-sh">$sudo /etc/init.d/apachectl start
</pre>
</div>
</div></li>

<li><a id="orgheadline164"></a>调试<br  /><div class="outline-text-6" id="text-8-8-2-1-4">
<p>
如果启动出现如下两个错误：
</p>
<pre class="example">
miracle@miracle-Zhaoyang-E49:~/myinstalled/httpd-2.4.18$ sudo /etc/init.d/apachectl start
AH00558: httpd: Could not reliably determine the server's fully qualified domain name, using 127.0.1.1. Set the 'ServerName' directive globally to sup
press this message
(98)Address already in use: AH00072: make_sock: could not bind to address 0.0.0.0:80
no listening sockets available, shutting down
AH00015: Unable to open logs
</pre>

<p>
那么
第一个问题：修改 <code>/usr/local/development/httpd-2.4.18/conf/httpd.conf</code>, 添加 <code>ServerName localhost:80</code>.
第二个问题：应该是端口被占用，可能启动了其他apache，可以如下修改  <code>/usr/local/development/httpd-2.4.18/conf/httpd.conf</code>
</p>
<pre class="example">
Listen 90
ServerName localhost:90
</pre>
</div></li>

<li><a id="orgheadline165"></a>访问<br  /><div class="outline-text-6" id="text-8-8-2-1-5">
<p>
基于如上配置，打开浏览器，地址栏键入 <code>localhost:90</code> 看到 "It works!" 即表示成功。
</p>
</div></li>

<li><a id="orgheadline166"></a>配置<br  /></li></ol>
</div>

<div id="outline-container-orgheadline178" class="outline-5">
<h5 id="orgheadline178"><span class="section-number-5">8.8.2.2</span> 安装nginx(xiaomirouter)</h5>
<div class="outline-text-5" id="text-8-8-2-2">
<p>
<code>cd ~/xiaomirouter</code>
</p>
</div>
<ol class="org-ol"><li><a id="orgheadline168"></a>下载<br  /><div class="outline-text-6" id="text-8-8-2-2-1">
<div class="org-src-container">

<pre class="src src-sh">$wget -c http://bigota.miwifi.com/xiaoqiang/sdk/tools/package/sdk_package.zip
$wget -c http://nginx.org/download/nginx-1.8.1.tar.gz
$wget -c http://www.openssl.org/source/openssl-1.0.2g.tar.gz
$wget -c http://mirrors.cnnic.cn/apache//apr/apr-1.5.2.tar.bz2
$wget -c http://apache.opencas.org//apr/apr-util-1.5.4.tar.gz
$wget -c ftp://ftp.csx.cam.ac.uk/pub/software/programming/pcre/pcre-8.38.tar.gz
#$wget -c http://nchc.dl.sourceforge.net/project/libpng/zlib/1.2.8/zlib-1.2.8.tar.gz
</pre>
</div>
</div></li>

<li><a id="orgheadline169"></a>配置交叉编译工具环境<br  /><div class="outline-text-6" id="text-8-8-2-2-2">
<div class="org-src-container">

<pre class="src src-sh">$export PATH=~/xiaomirouter/test/sdk_package/toolchain/bin:$PATH
$export CUSTOM_PREFIX=/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop
</pre>
</div>
</div></li>

<li><a id="orgheadline171"></a>交叉编译<br  /><ol class="org-ol"><li><a id="orgheadline170"></a>openssl<br  /><div class="outline-text-7" id="text-8-8-2-2-3-1">
<div class="org-src-container">

<pre class="src src-sh">$tar -xzvf openssl-1.0.2g.tar.gz
$export CROSS_COMPILE=arm-xiaomi-linux-uclibcgnueabi-
$cd openssl-1.0.2g
./config no-asm shared --prefix=$CUSTOM_PREFIX/openssl-1.0.2g
$vim Makefile
...
#SHARED_LDFLAGS=-m64
...
#CC= gcc
CC= arm-xiaomi-linux-uclibcgnueabi-gcc
#CFLAG= -fPIC -DOPENSSL_PIC -DOPENSSL_THREADS -D_REENTRANT -DDSO_DLFCN -DHAVE_DLFCN_H -m64 -DL_ENDIAN -O3 -Wall
CFLAG= -DOPENSSL_THREADS -D_REENTRANT -DDSO_DLFCN -DHAVE_DLFCN_H -DOPENSSL_NO_KRB5 -DL_ENDIAN -O3 -Wall
DEPFLAG= -DOPENSSL_NO_EC_NISTP_64_GCC_128 -DOPENSSL_NO_GMP -DOPENSSL_NO_JPAKE -DOPENSSL_NO_LIBUNBOUND -DOPENSSL_NO_MD2 -DOPENSSL_NO_RC5 -DOPENSSL_NO_RFC3779 -DOPENSSL_NO_SCTP -DOPENSSL_NO_SSL_TRACE -DOPENSSL_NO_SSL2 -DOPENSSL_NO_STORE -DOPENSSL_NO_UNIT_TEST -DOPENSSL_NO_WEAK_SSL_CIPHERS
PEX_LIBS= 
EX_LIBS= -ldl
EXE_EXT= 
ARFLAGS= 
#AR= ar $(ARFLAGS) r
AR= arm-xiaomi-linux-uclibcgnueabi-ar $(ARFLAGS) r
#RANLIB= /usr/bin/ranlib
RANLIB= arm-xiaomi-linux-uclibcgnueabi-ranlib
#NM= nm
NM= arm-xiaomi-linux-uclibcgnueabi-nm
PERL= /usr/bin/perl
TAR= tar
TARFLAGS= --no-recursion
MAKEDEPPROG= gcc
LIBDIR=lib
...
$make depend
$make
$make install
</pre>
</div>

<p>
<a href="http://blog.csdn.net/zy799894671/article/details/22289039">http://blog.csdn.net/zy799894671/article/details/22289039</a>
</p>
</div></li></ol></li>
<li><a id="orgheadline173"></a>其他<br  /><ol class="org-ol"><li><a id="orgheadline172"></a>安装<br  /><div class="outline-text-7" id="text-8-8-2-2-4-1">
<p>
只指定安装路径，没有其他选项
</p>

<div class="org-src-container">

<pre class="src src-sh">$sudo ./configure --prefix=/usr/local/development/nginx-1.8.1
$sudo make
$sudo make install
</pre>
</div>

<p>
加入 <code>openssl</code> 的编译：
</p>
<div class="org-src-container">

<pre class="src src-sh">$./configure --prefix=/usr/local/development/nginx-1.8.1 --with-openssl=/home/miracle/myinstalled/openssl-1.0.2g --with-http_ssl_module
$sudo make
</pre>
</div>

<p>
这里做 <code>sudo make</code> 的时候会自动编译ssl，如果手动编译ssl的话，那么大致如下：
</p>
<div class="org-src-container">

<pre class="src src-sh">$sudo ./config --prefix=/usr/local/development/openssl-1.0.2g
$sudo make depend
$sudo make
$sudo make install
</pre>
</div>

<p>
参考：<a href="http://www.cnblogs.com/skynet/p/4146083.html">http://www.cnblogs.com/skynet/p/4146083.html</a>
卸载只需要将 <code>/usr/local/develop/nginx-1.8.1</code> 删除即可。
</p>
</div></li></ol></li>
<li><a id="orgheadline174"></a>配置<br  /><div class="outline-text-6" id="text-8-8-2-2-5">
<ul class="org-ul">
<li>State "INBOX"      from              <span class="timestamp-wrapper"><span class="timestamp">[2016-03-29 二 18:37]</span></span></li>
</ul>
<p>
配置文件在 <code>/usr/local/development/nginx-1.8.1/conf</code> 下。
</p>
</div></li>

<li><a id="orgheadline175"></a>启动<br  /><div class="outline-text-6" id="text-8-8-2-2-6">
<p>
直接运行 <code>./nginx</code>
</p>

<p>
修改配置后 <code>./nginx -s reload</code>
</p>

<p>
更多内容 <code>./nginx -h</code>
</p>
</div></li>

<li><a id="orgheadline176"></a>文档<br  /><div class="outline-text-6" id="text-8-8-2-2-7">
<p>
<a href="http://nginx.org/en/docs/">http://nginx.org/en/docs/</a>
</p>
</div></li>

<li><a id="orgheadline177"></a>Misc<br  /><div class="outline-text-6" id="text-8-8-2-2-8">
<p>
openssl
</p>
<div class="org-src-container">

<pre class="src src-sh">$sudo ./config --prefix=/usr/local/development/openssl-1.0.2g
$sudo make depend
$sudo make install
</pre>
</div>
</div></li></ol>
</div>
<div id="outline-container-orgheadline179" class="outline-5">
<h5 id="orgheadline179"><span class="section-number-5">8.8.2.3</span> 安装php5.4</h5>
<div class="outline-text-5" id="text-8-8-2-3">
<p>
这一步要放在安装完apache之后。
</p>
<div class="org-src-container">

<pre class="src src-sh">$ sudo add-apt-repository ppa:ondrej/php5
$ sudo apt-get update
$ sudo apt-get install php5-cli php5-fpm php-pear php5-mysql libcurl4-openssl-dev
#$ sudo pecl install pecl_http  # Update /etc/php5/fpm/php.ini and /etc/php5/cli/php.ini with http.so
$ php -v
</pre>
</div>
</div>
</div>
<div id="outline-container-orgheadline183" class="outline-5">
<h5 id="orgheadline183"><span class="section-number-5">8.8.2.4</span> 源码安装php</h5>
<div class="outline-text-5" id="text-8-8-2-4">
</div><ol class="org-ol"><li><a id="orgheadline180"></a>openssl<br  /><div class="outline-text-6" id="text-8-8-2-4-1">
<p>
<a href="http://www.openssl.org/source/openssl-1.0.2g.tar.gz">http://www.openssl.org/source/openssl-1.0.2g.tar.gz</a>
./config &#x2013;prefix=/usr/local/develop/openssl-1.0.2g
sudo make depend
sudo make 
sudo make install
</p>
</div></li>
<li><a id="orgheadline181"></a>depend library<br  /><div class="outline-text-6" id="text-8-8-2-4-2">
<p>
sudo apt-get install libxml2
sudo apt-get install libxml2-dev
sudo apt-get install libxml2-utils
sudo apt-get install libcurl3
sudo apt-get install libcurl
sudo apt-get install libcurl4-gnutls-dev
</p>
</div></li>
<li><a id="orgheadline182"></a>php<br  /><div class="outline-text-6" id="text-8-8-2-4-3">
<p>
<a href="http://php.net/downloads.php">http://php.net/downloads.php</a>
./configure &#x2013;prefix=/usr/local/develop/php-5.6.19 &#x2013;with-config-file-path=/usr/local/develop/php-5.6.19/etc &#x2013;enable-fpm &#x2013;with-fpm-user=www-data &#x2013;with-fpm-group=www-data &#x2013;with-mysql=mysqlnd &#x2013;with-mysqli=mysqlnd &#x2013;with-pdo-mysql=mysqlnd &#x2013;with-iconv-dir &#x2013;with-freetype-dir &#x2013;with-jpeg-dir &#x2013;with-png-dir &#x2013;with-zlib &#x2013;with-libxml-dir=/usr &#x2013;enable-xml &#x2013;disable-rpath &#x2013;enable-magic-quotes &#x2013;enable-safe-mode &#x2013;enable-bcmath &#x2013;enable-shmop &#x2013;enable-sysvsem &#x2013;enable-inline-optimization &#x2013;with-curl &#x2013;with-curlwrappers &#x2013;enable-mbregex &#x2013;enable-mbstring &#x2013;with-mcrypt &#x2013;enable-ftp &#x2013;with-gd &#x2013;enable-gd-native-ttf &#x2013;with-openssl=/usr/local/develop/openssl-1.0.2g &#x2013;with-mhash &#x2013;enable-pcntl &#x2013;enable-sockets &#x2013;with-xmlrpc &#x2013;enable-zip &#x2013;enable-soap &#x2013;without-pear &#x2013;with-gettext &#x2013;disable-fileinfo
</p>

<p>
sudo make
sudo make install
</p>
</div></li></ol>
</div>
</div>
<div id="outline-container-orgheadline70" class="outline-4">
<h4 id="orgheadline70"><span class="section-number-4">8.8.3</span> refer</h4>
<div class="outline-text-4" id="text-8-8-3">
<p>
<a href="http://wiki.openwrt.org/doc/howto/owncloud">ownCloud on OpenWrt</a>
</p>

<p>
<a href="http://www.cnblogs.com/qkcan/archive/2012/08/05/2623994.html">ubuntu 12.04 PHP5.4安装</a>
</p>

<p>
<a href="http://www.linuxidc.com/Linux/2012-09/70518.htm">Ubuntu 12.04 下安装Apache 2.4.2</a>
</p>

<p>
<a href="http://blog.sina.com.cn/s/blog_61d0b6cd010119a8.html">Ubuntu10.04下编译安装apache-2.4.2版本</a>
</p>
</div>
</div>
</div>
<div id="outline-container-orgheadline71" class="outline-3">
<h3 id="orgheadline71"><span class="section-number-3">8.9</span> <span class="done CANCEL">CANCEL</span> owncloud升级</h3>
<div class="outline-text-3" id="text-8-9">
<ul class="org-ul">
<li>State "CANCEL"     from "WAIT/FORWARD" <span class="timestamp-wrapper"><span class="timestamp">[2016-08-08 一 17:34] </span></span> <br  />
Owncloud不稳定，数据虽然不会丢失，但是有时也很麻烦，已经不采用，此处仅供参考。</li>
<li>State "WAIT/FORWARD" from "NEXT"       <span class="timestamp-wrapper"><span class="timestamp">[2016-08-08 一 17:29] </span></span> <br  />
wait for try.</li>
<li>State "NEXT"       from              <span class="timestamp-wrapper"><span class="timestamp">[2016-08-08 一 17:29]</span></span></li>
</ul>
<p>
下载,注意将 <code>https://</code> 改成 <code>http://</code>
</p>
<div class="org-src-container">

<pre class="src src-sh">$wget -c http://download.owncloud.org/community/owncloud-9.0.2.tar.bz2
</pre>
</div>

<ol class="org-ol">
<li>停用所有第三方app.</li>
<li><code>rsync --inplace -rtv owncloud_latest/owncloud/ owncloud/</code></li>
</ol>

<p>
php -c <i>userdisk/opt/usr/local/develop/etc</i> occ maintenance:mimetype:update-db
php -c <i>userdisk/opt/usr/local/develop/etc</i> occ maintenance:mimetype:update-js
php -c <i>userdisk/opt/usr/local/develop/etc</i> occ upgrade
</p>

<p>
参考:
</p>

<p>
<a href="https://teddysun.com/211.html">https://teddysun.com/211.html</a>
</p>

<p>
<a href="https://www.librehat.com/the-owncloud-upgrade-prolonged-stagnation-maintance-solution/">https://www.librehat.com/the-owncloud-upgrade-prolonged-stagnation-maintance-solution/</a>
</p>
</div>
</div>


<div id="outline-container-orgheadline72" class="outline-3">
<h3 id="orgheadline72"><span class="section-number-3">8.10</span> <span class="done CANCEL">CANCEL</span> owncloud issue</h3>
<div class="outline-text-3" id="text-8-10">
<ul class="org-ul">
<li>State "CANCEL"     from "NEXT"       <span class="timestamp-wrapper"><span class="timestamp">[2016-08-08 一 17:34] </span></span> <br  />
Owncloud不稳定，数据虽然不会丢失，但是有时也很麻烦，已经不采用，此处仅供参考。</li>
<li>State "NEXT"       from "INBOX"      <span class="timestamp-wrapper"><span class="timestamp">[2016-08-08 一 17:29]</span></span></li>
</ul>
<p>
Capture Time:<span class="timestamp-wrapper"><span class="timestamp">[2016-04-28 四 13:46]</span></span>
</p>
<hr  />
<p>
同步总是发生错误,其中之一是文件大小过大.
</p>

<p>
无法上传大文件的错误:
上传大文件的错误:
</p>
<pre class="example">
Request Entity Too Large
</pre>
<p>
<a href="https://forum.owncloud.org/viewtopic.php?f=17&amp;t=7733">https://forum.owncloud.org/viewtopic.php?f=17&amp;t=7733</a>
</p>

<p>
无法上传文件的错误:
上传文件出现类似如下错误:
</p>
<pre class="example">
An exception occurred while executing 'INSERT INTO `oc_filecache` (`mimepart`,`mimetype`,`mtime`,`size`,`etag`,`storage_mtime`,`permissions`,`parent`,`path_hash`,`path`,`name`,`storage`) SELECT ?,?,?,?,?,?,?,?,?,?,?,? FROM `oc_filecache` WHERE `storage` = ? AND `path_hash` = ? HAVING COUNT(*) = 0' with params ["8", "18", 1461910752, 1250, "d73b2a5f54292c00fbe81872c61e9381", 1461910752, 27, "19", "04cf4abd8d26a455196d8cf88cab5fe0", "files\/Documents\/\u6587\u4ef6\u7ba1\u7406.md", "\u6587\u4ef6\u7ba1\u7406.md", "3", "3", "04cf4abd8d26a455196d8cf88cab5fe0"]: SQLSTATE[23000]: Integrity constraint violation: 1062 Duplicate entry '17101' for key 'PRIMARY'
</pre>
<p>
网上说是因为某些用户垃圾箱文件太多导致,清空垃圾箱即可,最好定时清空垃圾箱.?貌似还是不行?
 <a href="http://github.com/owncloud/core/issues/12591">http://github.com/owncloud/core/issues/12591</a>
</p>

<pre class="example">
i've tracked the files down in this message, and it belongs to a user who has about 6500 files in his trashbin.
Retention was at 30 days, I've lowered it to 7, to see if that helps, but it deletes only 1 file every 10 seconds or so, so that will take weeks...
I had to restart the mysql server twice now to prevent bigger problems.
</pre>

<p>
<a href="https://github.com/owncloud/core/issues/17887">https://github.com/owncloud/core/issues/17887</a>
</p>
</div>
</div>

<div id="outline-container-orgheadline73" class="outline-3">
<h3 id="orgheadline73"><span class="section-number-3">8.11</span> <span class="done DONE">DONE</span> 如何小米路由器上使用 <code>git</code> 版本控制系统?</h3>
<div class="outline-text-3" id="text-8-11">
<ul class="org-ul">
<li>State "DONE"       from "WAIT/FORWARD" <span class="timestamp-wrapper"><span class="timestamp">[2016-08-09 二 15:33]</span></span></li>
<li>State "WAIT/FORWARD" from "INBOX"      <span class="timestamp-wrapper"><span class="timestamp">[2016-07-26 二 17:05] </span></span> <br  />
wait for refile.</li>
<li>State "INBOX"      from              <span class="timestamp-wrapper"><span class="timestamp">[2016-06-12 日 16:59]</span></span></li>
</ul>

<p>
参考：<a href="#orgheadline46">小米路由器上使用 <code>git</code> 版本控制系统</a>
</p>
</div>
</div>
<div id="outline-container-orgheadline74" class="outline-3">
<h3 id="orgheadline74"><span class="section-number-3">8.12</span> <span class="todo MAYBE_FUTURE">MAYBE/FUTURE</span> 交叉编译mysql-5.7.11</h3>
<div class="outline-text-3" id="text-8-12">
<ul class="org-ul">
<li>State "MAYBE/FUTURE" from "INBOX"      <span class="timestamp-wrapper"><span class="timestamp">[2016-08-08 一 17:34]</span></span></li>
<li>State "INBOX"      from              <span class="timestamp-wrapper"><span class="timestamp">[2016-06-12 日 16:59]</span></span></li>
</ul>

<p>
新版本的 <code>mysql</code> 不是用 <code>GNU Auto tools</code> 生成 <code>Makefile</code> 而是使用 <code>CMake</code>, 所以编译方法有所不同。
</p>
</div>

<div id="outline-container-orgheadline75" class="outline-4">
<h4 id="orgheadline75"><span class="section-number-4">8.12.1</span> try cmake</h4>
<div class="outline-text-4" id="text-8-12-1">
<div class="org-src-container">

<pre class="src src-sh">$sudo apt-get install cmake
$cd mysql-5.7.11
$vim xx
$cmake -DCMAKE_INSTALL_PREFIX=/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop -DMYSQL_UNIX_ADDR=/var/run/mysql.sock -DDEFAULT_CHARSET=utf8 -DDEFAULT_COLLATION=utf8_general_ci -DWITH_EXTRA_CHARSETS=utf8,gbk -DWITH_INNOBASE_STORAGE_ENGINE=1 -DWITH_READLINE=1 -DENABLED_LOCAL_INFILE=1 -DMYSQL_DATADIR=/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop/data -DSTACK_DIRECTION=1 -DCURSES_LIBRARY=/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop/lib/libncurses.a -DCURSES_INCLUDE_PATH=/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop/include -DWITH_MYISAM_STORAGE_ENGINE=1 -DDOWNLOAD_BOOST=1 -DWITH_BOOST=../boost.arm
</pre>
</div>
<p>
参考:
</p>

<p>
<a href="http://www.th7.cn/db/mysql/201603/178674.shtml">http://www.th7.cn/db/mysql/201603/178674.shtml</a>
</p>

<p>
<a href="http://dev.mysql.com/doc/internals/en/cmake.html">http://dev.mysql.com/doc/internals/en/cmake.html</a>
</p>

<p>
<a href="http://www.cmake.org/Wiki/CMake_Cross_Compiling">http://www.cmake.org/Wiki/CMake_Cross_Compiling</a>
</p>

<p>
<a href="http://blog.chinaunix.net/uid-29570002-id-5112786.html">http://blog.chinaunix.net/uid-29570002-id-5112786.html</a>
</p>

<p>
PC版本的编译:
</p>
<div class="org-src-container">

<pre class="src src-sh">mysql-5.7.11.pc$ cmake -DDOWNLOAD_BOOST=1 -DWITH_BOOST=../boost
$cmake . -DWITH_BOOST=../boost/boost_1_59_0
$make
</pre>
</div>

<p>
arm版本的编译:
</p>
</div>

<div id="outline-container-orgheadline184" class="outline-5">
<h5 id="orgheadline184"><span class="section-number-5">8.12.1.1</span> <span class="done DONE">DONE</span> 自带文档</h5>
<div class="outline-text-5" id="text-8-12-1-1">
<ul class="org-ul">
<li>State "DONE"       from              <span class="timestamp-wrapper"><span class="timestamp">[2016-08-17 三 12:04]</span></span></li>
</ul>
<p>
INSTALL-SOURCE
</p>
<pre class="example">
To list the configuration options, use one of the following
commands:
shell&gt; cmake . -L   # overview
shell&gt; cmake . -LH  # overview with help text
shell&gt; cmake . -LAH # all params with help text
shell&gt; ccmake .     # interactive display
</pre>
</div>
</div>


<div id="outline-container-orgheadline185" class="outline-5">
<h5 id="orgheadline185"><span class="section-number-5">8.12.1.2</span> <span class="timestamp-wrapper"><span class="timestamp">&lt;2016-08-15 一 16:29&gt; </span></span> how to manage <code>cross compile</code>?</h5>
<div class="outline-text-5" id="text-8-12-1-2">
<div class="org-src-container">

<pre class="src src-sh">$sudo apt-get install cmake
$cd usr/local/develop/include
$ln -s ncurses/ncurses.h .
$ln -s ncurses/curses.h .
$cd mysql-5.7.11

$vim Toolchain_xiaomi.cmake
# this one is important
SET(CMAKE_SYSTEM_NAME Linux)
#this one not so much
SET(CMAKE_SYSTEM_VERSION 1)

# specify the cross compiler
SET(CMAKE_C_COMPILER   /home/miracle/work/1_inbox/xiaomirouter/test/sdk_package/toolchain/bin/arm-xiaomi-linux-uclibcgnueabi-gcc)
SET(CMAKE_CXX_COMPILER /home/miracle/work/1_inbox/xiaomirouter/test/sdk_package/toolchain/bin/arm-xiaomi-linux-uclibcgnueabi-g++)

# where is the target environment 
SET(CMAKE_FIND_ROOT_PATH  /home/miracle/work/1_inbox/xiaomirouter/test/sdk_package/lib)

# search for programs in the build host directories
SET(CMAKE_FIND_ROOT_PATH_MODE_PROGRAM NEVER)
# for libraries and headers in the target directories
SET(CMAKE_FIND_ROOT_PATH_MODE_LIBRARY ONLY)
SET(CMAKE_FIND_ROOT_PATH_MODE_INCLUDE ONLY)
</pre>
</div>

<div class="org-src-container">

<pre class="src src-sh">#$cmake -DCMAKE_TOOLCHAIN_FILE=`pwd`/Toolchain_xiaomi.cmake -DCMAKE_INSTALL_PREFIX=/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop -DMYSQL_UNIX_ADDR=/var/run/mysql.sock -DDEFAULT_CHARSET=utf8 -DDEFAULT_COLLATION=utf8_general_ci -DWITH_EXTRA_CHARSETS=utf8,gbk -DWITH_INNOBASE_STORAGE_ENGINE=1 -DWITH_READLINE=1 -DENABLED_LOCAL_INFILE=1 -DMYSQL_DATADIR=/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop/data -DSTACK_DIRECTION=1 -DCURSES_LIBRARY=/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop/lib/libncurses.a -DCURSES_INCLUDE_PATH=/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop/include -DWITH_MYISAM_STORAGE_ENGINE=1 -DDOWNLOAD_BOOST=1 -DWITH_BOOST=../boost.arm .
#$cmake -DCMAKE_INSTALL_PREFIX=/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop -DWITH_DEBUG=0 -DDEFAULT_CHARSET=utf8 -DWITH_EXTRA_CHARSETS=all -DENABLED_LOCAL_INFILE=1 
$cmake -DCMAKE_TOOLCHAIN_FILE=`pwd`/Toolchain_xiaomi.cmake -DCMAKE_INSTALL_PREFIX=/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop -DMYSQL_UNIX_ADDR=/var/run/mysql.sock -DDEFAULT_CHARSET=utf8 -DDEFAULT_COLLATION=utf8_general_ci -DWITH_EXTRA_CHARSETS=utf8,gbk -DWITH_INNOBASE_STORAGE_ENGINE=1 -DWITH_READLINE=1 -DENABLED_LOCAL_INFILE=1 -DMYSQL_DATADIR=/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop/data -DSTACK_DIRECTION=1 -DCURSES_LIBRARY=/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop/lib/libncurses.a -DCURSES_INCLUDE_PATH=/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop/include -DWITH_MYISAM_STORAGE_ENGINE=1 -DWITH_BOOST=`pwd`/../boost.arm .
</pre>
</div>
<p>
运行两次cmake?
</p>


<p>
how to translate from auto tools?
</p>
<pre class="example">
$./configure --prefix=/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop 
--without-docs ??none??
--without-man ??
--without-debug 
--with-charset=utf8 
--with-extra-charsets=gbk,gb2312,utf8,ascii 
--enable-local-infile 
--with-mysqld-user=root ???none???
--host=arm-xiaomi-linux-uclibcgnueabi ???none???
--with-named-curses-libs=/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop/lib/libncurses.a ???

CC=arm-xiaomi-linux-uclibcgnueabi-gcc ???
</pre>
</div>
</div>



<div id="outline-container-orgheadline186" class="outline-5">
<h5 id="orgheadline186"><span class="section-number-5">8.12.1.3</span> <span class="timestamp-wrapper"><span class="timestamp">&lt;2016-08-17 三 12:03&gt; </span></span> how to manage boost error?</h5>
<div class="outline-text-5" id="text-8-12-1-3">
<p>
in <code>cmake/boost.cmake</code>
</p>
<pre class="example">
...
  ## Did we get a path name to the directory of the .tar.gz or .zip file?
  FIND_FILE(LOCAL_BOOST_ZIP
            NAMES "${BOOST_PACKAGE_NAME}.tar.gz" "${BOOST_PACKAGE_NAME}.zip"
            PATHS ${WITH_BOOST}
            NO_DEFAULT_PATH
           )
  MESSAGE(STATUS "@@@@@@NAMES: ${BOOST_PACKAGE_NAME}.tar.gz")
  MESSAGE(STATUS "@@@@@@PATHS(WITH_BOOST): ${WITH_BOOST}")
  MESSAGE(STATUS "@@@@@@LOCAL_BOOST_ZIP: ${LOCAL_BOOST_ZIP}")
  ## Did we get a path name to the directory of an unzipped version?
  FIND_FILE(LOCAL_BOOST_DIR
            NAMES "${BOOST_PACKAGE_NAME}"
            PATHS ${WITH_BOOST}
            NO_DEFAULT_PATH
           )
  MESSAGE(STATUS "@@@@@@NAMES: ${BOOST_PACKAGE_NAME}")
  MESSAGE(STATUS "@@@@@@PATHS(WITH_BOOST): ${WITH_BOOST}")
  MESSAGE(STATUS "@@@@@@LOCAL_BOOST_DIR: ${LOCAL_BOOST_DIR}")
  ## Did we get a path name to an unzippped version?
  FIND_PATH(LOCAL_BOOST_DIR
            NAMES "boost/version.hpp"
            PATHS ${WITH_BOOST}
            NO_DEFAULT_PATH
           )
  MESSAGE(STATUS "@@@@@@NAMES: boost/version.hpp")
  MESSAGE(STATUS "@@@@@@PATHS(WITH_BOOST): ${WITH_BOOST}")
  MESSAGE(STATUS "@@@@@@LOCAL_BOOST_DIR: ${LOCAL_BOOST_DIR}")
...
</pre>

<p>
output for cmake
</p>
<div class="org-src-container">

<pre class="src src-sh">miracle@miracle-Zhaoyang-E49:~/work/1_inbox/xiaomirouter/test/mysql-5.7.11$ cmake -DCMAKE_TOOLCHAIN_FILE=/home/miracle/work/1_inbox/xiaomirouter/test/mysql-5.7.11/Toolchain_xiaomi.cmake -DCMAKE_INSTALL_PREFIX=/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop -DMYSQL_UNIX_ADDR=/var/run/mysql.sock -DDEFAULT_CHARSET=utf8 -DDEFAULT_COLLATION=utf8_general_ci -DWITH_EXTRA_CHARSETS=utf8,gbk -DWITH_INNOBASE_STORAGE_ENGINE=1 -DWITH_READLINE=1 -DENABLED_LOCAL_INFILE=1 -DMYSQL_DATADIR=/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop/data -DSTACK_DIRECTION=1 -DCURSES_LIBRARY=/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop/lib/libncurses.a -DCURSES_INCLUDE_PATH=/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop/include -DWITH_MYISAM_STORAGE_ENGINE=1 -DWITH_BOOST="/home/miracle/work/1_inbox/xiaomirouter/test/boost.arm" .
-- Running cmake version 2.8.7
-- Configuring with MAX_INDEXES = 64U
-- SIZEOF_VOIDP 4
-- MySQL 5.7.11
-- Packaging as: mysql-5.7.11-Linux-
-- @@@@@@NAMES: boost_1_59_0.tar.gz
-- @@@@@@PATHS(WITH_BOOST): /home/miracle/work/1_inbox/xiaomirouter/test/boost.arm
-- @@@@@@LOCAL_BOOST_ZIP: LOCAL_BOOST_ZIP-NOTFOUND
-- @@@@@@NAMES: boost_1_59_0
-- @@@@@@PATHS(WITH_BOOST): /home/miracle/work/1_inbox/xiaomirouter/test/boost.arm
-- @@@@@@LOCAL_BOOST_DIR: LOCAL_BOOST_DIR-NOTFOUND
-- @@@@@@NAMES: boost/version.hpp
-- @@@@@@PATHS(WITH_BOOST): /home/miracle/work/1_inbox/xiaomirouter/test/boost.arm
-- @@@@@@LOCAL_BOOST_DIR: LOCAL_BOOST_DIR-NOTFOUND
-- WITH_BOOST=/home/miracle/work/1_inbox/xiaomirouter/test/boost.arm
-- BOOST_INCLUDE_DIR
-- LOCAL_BOOST_DIR LOCAL_BOOST_DIR-NOTFOUND
-- LOCAL_BOOST_ZIP LOCAL_BOOST_ZIP-NOTFOUND
-- Could not find (the correct version of) boost.
-- MySQL currently requires boost_1_59_0

CMake Error at cmake/boost.cmake:81 (MESSAGE):
  You can download it with -DDOWNLOAD_BOOST=1 -DWITH_BOOST=&lt;directory&gt;

  This CMake script will look for boost in &lt;directory&gt;.  If it is not there,
  it will download and unpack it (in that directory) for you.

  If you are inside a firewall, you may need to use an http proxy:

  export http_proxy=http://example.com:80

Call Stack (most recent call first):
cmake/boost.cmake:176 (COULD_NOT_FIND_BOOST)
  CMakeLists.txt:443 (INCLUDE)


-- Configuring incomplete, errors occurred!
</pre>
</div>
</div>
</div>
</div>
</div>


<div id="outline-container-orgheadline76" class="outline-3">
<h3 id="orgheadline76"><span class="section-number-3">8.13</span> <span class="todo LATER">LATER</span> 小米路由器搭建ftp服务</h3>
<div class="outline-text-3" id="text-8-13">
<ul class="org-ul">
<li>State "LATER"      from "INBOX"      <span class="timestamp-wrapper"><span class="timestamp">[2016-08-08 一 17:35]</span></span></li>
</ul>
<p>
vsftp官方网址：
</p>

<p>
<a href="https://security.appspot.com/vsftpd.html">https://security.appspot.com/vsftpd.html</a>
</p>

<p>
vsftpd.beasts.org
</p>
</div>
<div id="outline-container-orgheadline77" class="outline-4">
<h4 id="orgheadline77"><span class="section-number-4">8.13.1</span> 交叉编译环境</h4>
</div>

<div id="outline-container-orgheadline78" class="outline-4">
<h4 id="orgheadline78"><span class="section-number-4">8.13.2</span> 源代码下载：</h4>
<div class="outline-text-4" id="text-8-13-2">
<div class="org-src-container">

<pre class="src src-sh">$wget https://security.appspot.com/downloads/vsftpd-3.0.3.tar.gz
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline79" class="outline-4">
<h4 id="orgheadline79"><span class="section-number-4">8.13.3</span> 编译libcrypt</h4>
</div>
<div id="outline-container-orgheadline80" class="outline-4">
<h4 id="orgheadline80"><span class="section-number-4">8.13.4</span> 修改Makefile</h4>
<div class="outline-text-4" id="text-8-13-4">
<p>
/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop/lib
</p>
<ol class="org-ol">
<li><p>
CC
</p>
<pre class="example">
CC = arm-xiaomi-linux-uclibcgnueabi-gcc
</pre></li>

<li><p>
CFLAGS
</p>
<pre class="example">
CFLAGS	=	-O2 -fPIE --param=ssp-buffer-size=4 \
     -Wall -W -Wshadow -Werror -Wformat-security \
     -D_FORTIFY_SOURCE=2 \
     #-pedantic -Wconversion
</pre></li>

<li><p>
LIBS
</p>
<pre class="example">
LIBS	=	-L/home/miracle/work/1_inbox/xiaomirouter/test/usr/local/develop/lib -lcrypt
</pre></li>
</ol>
</div>
</div>

<div id="outline-container-orgheadline81" class="outline-4">
<h4 id="orgheadline81"><span class="section-number-4">8.13.5</span> 编译</h4>
</div>

<div id="outline-container-orgheadline82" class="outline-4">
<h4 id="orgheadline82"><span class="section-number-4">8.13.6</span> 开启防火墙</h4>
<div class="outline-text-4" id="text-8-13-6">
<pre class="example">
config rule                                           
        option name 'myftp'                           
        option src 'wan'                              
        option proto 'tcp'                            
        option target 'ACCEPT'                        
        option name ''\''ftp wan accept tcp port 21'\'''     
        option dest_port '21'
</pre>
</div>
</div>
<div id="outline-container-orgheadline83" class="outline-4">
<h4 id="orgheadline83"><span class="section-number-4">8.13.7</span> 如何运行？</h4>
<div class="outline-text-4" id="text-8-13-7">
<p>
查看代码后发现，是不是 <code>vsftpd /userdisk/data/opt/usr/local/develop/etc/vsftpd.conf</code> 
参考：
</p>

<p>
<a href="http://www.miui.com/thread-1843572-1-1.html">http://www.miui.com/thread-1843572-1-1.html</a>
</p>

<p>
<a href="http://www.cnblogs.com/JemBai/archive/2009/02/05/1384413.html">http://www.cnblogs.com/JemBai/archive/2009/02/05/1384413.html</a>
</p>

<p>
<a href="http://www.cnblogs.com/hhuai/archive/2011/02/12/1952647.html">http://www.cnblogs.com/hhuai/archive/2011/02/12/1952647.html</a>
</p>
</div>
</div>

<div id="outline-container-orgheadline84" class="outline-4">
<h4 id="orgheadline84"><span class="section-number-4">8.13.8</span> </h4>
</div>
</div>
<div id="outline-container-orgheadline85" class="outline-3">
<h3 id="orgheadline85"><span class="section-number-3">8.14</span> <span class="todo MAYBE_FUTURE">MAYBE/FUTURE</span> 交叉编译vim</h3>
<div class="outline-text-3" id="text-8-14">
<ul class="org-ul">
<li>State "MAYBE/FUTURE" from "INBOX"      <span class="timestamp-wrapper"><span class="timestamp">[2016-08-08 一 17:35]</span></span></li>
<li>State "INBOX"      from              <span class="timestamp-wrapper"><span class="timestamp">[2016-08-03 三 19:05]</span></span></li>
</ul>
</div>
</div>
<div id="outline-container-orgheadline86" class="outline-3">
<h3 id="orgheadline86"><span class="section-number-3">8.15</span> <span class="todo NEXT">NEXT</span> Seafile</h3>
<div class="outline-text-3" id="text-8-15">
<ul class="org-ul">
<li>State "NEXT"       from "MAYBE/FUTURE" <span class="timestamp-wrapper"><span class="timestamp">[2016-08-08 一 17:35]</span></span></li>
<li>State "MAYBE/FUTURE" from "CANCEL"     <span class="timestamp-wrapper"><span class="timestamp">[2016-07-29 五 12:05]</span></span></li>
<li>State "CANCEL"     from              <span class="timestamp-wrapper"><span class="timestamp">[2016-07-28 四 18:32] </span></span> <br  /></li>
</ul>


<p>
虽然开源，但是从代码结构上来看，编译比较麻烦，取消。
</p>

<p>
且对mysql的交叉编译环境暂时不待见。而且文件全都是加密过的，不能直接访问。
</p>

<p>
额外的功能如搜索等，还需收费。
</p>
</div>

<div id="outline-container-orgheadline87" class="outline-4">
<h4 id="orgheadline87"><span class="section-number-4">8.15.1</span> <span class="done DONE">DONE</span> PC 上安装Seafile</h4>
<div class="outline-text-4" id="text-8-15-1">
<ul class="org-ul">
<li>State "DONE"       from "NEXT"       <span class="timestamp-wrapper"><span class="timestamp">[2016-07-26 二 15:35]</span></span></li>
<li>State "NEXT"       from "INBOX"      <span class="timestamp-wrapper"><span class="timestamp">[2016-07-26 二 15:35]</span></span></li>
</ul>
<p>
Capture Time:<span class="timestamp-wrapper"><span class="timestamp">[2016-07-25 一 19:01]</span></span>
</p>
<hr  />
<p>
下载：<a href="https://www.seafile.com/en/download/">https://www.seafile.com/en/download/</a>
</p>

<div class="org-src-container">

<pre class="src src-sh">$wget -c /home/miracle/下载/seafile-server_5.1.4_x86-64.tar.gz
$tar -xzvf seafile-server_5.1.4_x86-64.tar.gz
$cd seafile-server_5.1.4_x86-64
$sudo apt-get install python-mysqldb
$./setup-seafile-mysql.sh
...
Press ENTER to continue
-----------------------------------------------------------------
[Enter]

What is the name of the server? It will be displayed on the client.
3 - 15 letters or digits
[ server name ] my-seafile [Enter]

What is the ip or domain of the server?
For example: www.mycompany.com, 192.168.1.101
[ This server's ip or domain ] 172.16.246.34 [Enter]

Where do you want to put your seafile data?
Please use a volume with enough free space
[ default "/media/sda6/cloud/seafile/seafile-data" ] [Enter]

Which port do you want to use for the seafile fileserver?
[ default "8082" ] [Enter]

-------------------------------------------------------
Please choose a way to initialize seafile databases:
-------------------------------------------------------

[1] Create new ccnet/seafile/seahub databases
[2] Use existing ccnet/seafile/seahub databases

[ 1 or 2 ] 1[Enter]

What is the host of mysql server?
[ default "localhost" ] [Enter]

What is the port of mysql server?
[ default "3306" ] [Enter]

What is the password of the mysql root user?
[ root password ] xxxxxx[Enter]

Enter the name for mysql user of seafile. It would be created if not exists.
[ default "root" ] myseafile[Enter]

Enter the password for mysql user "myseafile":
[ password for myseafile ] xxxxxx[Enter]

Enter the database name for ccnet-server:
[ default "ccnet-db" ] [Enter]

Enter the database name for seafile-server:
[ default "seafile-db" ] [Enter]

Enter the database name for seahub:
[ default "seahub-db" ] [Enter]

---------------------------------
This is your configuration
---------------------------------

    server name:            my-seafile
    server ip/domain:       172.16.246.34

    seafile data dir:       /media/sda6/cloud/seafile/seafile-data
    fileserver port:        8082

    database:               create new
    ccnet database:         ccnet-db
    seafile database:       seafile-db
    seahub database:        seahub-db
    database user:          myseafile



---------------------------------
Press ENTER to continue, or Ctrl-C to abort
---------------------------------

[Enter]
....
-----------------------------------------------------------------
Your seafile server configuration has been finished successfully.
-----------------------------------------------------------------

run seafile server:     ./seafile.sh { start | stop | restart }
run seahub  server:     ./seahub.sh  { start &lt;port&gt; | stop | restart &lt;port&gt; }

-----------------------------------------------------------------
If you are behind a firewall, remember to allow input/output of these tcp ports:
-----------------------------------------------------------------

port of seafile fileserver:   8082
port of seahub:               8000

When problems occur, Refer to

        https://github.com/haiwen/seafile/wiki

for information.
</pre>
</div>

<div class="org-src-container">

<pre class="src src-sh">$./seafile.sh start
$./seahub.sh start
......
What is the email for the admin account?
[ admin email ] quiet_heart000@126.com

What is the password for the admin account?
[ admin password ] 

Enter the password again:
[ admin password again ] 
......
</pre>
</div>

<p>
访问之时，浏览器输入： <code>127.0.0.1:8000</code>
</p>

<p>
文档：<a href="http://manual.seafile.com/">http://manual.seafile.com/</a>
</p>
</div>
</div>

<div id="outline-container-orgheadline88" class="outline-4">
<h4 id="orgheadline88"><span class="section-number-4">8.15.2</span> 编译Seafile</h4>
<div class="outline-text-4" id="text-8-15-2">
</div><div id="outline-container-orgheadline187" class="outline-5">
<h5 id="orgheadline187"><span class="section-number-5">8.15.2.1</span> 编译libsearpc</h5>
<div class="outline-text-5" id="text-8-15-2-1">
<div class="org-src-container">

<pre class="src src-sh">$./autogen.sh
$./configure --prefix=`pwd`/../prefix
</pre>
</div>

<pre class="example">
checking for JANSSON... no
configure: error: Package requirements (jansson &gt;= 2.2.1) were not met:

No package 'jansson' found
</pre>

<div class="org-src-container">

<pre class="src src-sh">$wget -c http://www.digip.org/jansson/releases/jansson-2.7.tar.gz
$./configure --prefix=`pwd`/../prefix
$make
$make install
</pre>
</div>

<div class="org-src-container">

<pre class="src src-sh">$./configure --prefix=`pwd`/../prefix LDFLAGS=-L`pwd`/../prefix/lib JANSSON_CFLAGS=-I`pwd`/../prefix/include JANSSON_LIBS="-L`pwd`/../prefix/lib -ljansson"
</pre>
</div>

<pre class="example">
gcc -DHAVE_CONFIG_H -I. -I..    -I/usr/include/glib-2.0 -I/usr/lib/x86_64-linux-gnu/glib-2.0/include -I../lib -g -O2 -MT searpc-demo-server.o -MD -MP -MF .deps/searpc-demo-server.Tpo -c -o searpc-demo-server.o searpc-demo-server.c
In file included from ../lib/searpc.h:7:0,
                 from searpc-demo-server.c:10:
../lib/searpc-server.h:6:21: 致命错误： jansson.h：没有那个文件或目录
编译中断。
</pre>

<p>
添加 <code>JANSSON_CFLAGS</code>
</p>
<div class="org-src-container">

<pre class="src src-sh">$vim demo/Makefile
70 COMPILE = $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) \                                                                          
71     $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) $(JANSSON_CFLAGS)
</pre>
</div>

<div class="org-src-container">

<pre class="src src-sh">$./configure --prefix=`pwd`/../prefix LDFLAGS=-L`pwd`/../prefix/lib JANSSON_CFLAGS=-I`pwd`/../prefix/include JANSSON_LIBS="-L`pwd`/../prefix/lib -ljansson"
$make
$make install
</pre>
</div>
</div>
</div>


<div id="outline-container-orgheadline188" class="outline-5">
<h5 id="orgheadline188"><span class="section-number-5">8.15.2.2</span> 编译ccnet</h5>
<div class="outline-text-5" id="text-8-15-2-2">
<p>
下载依赖
</p>

<p>
编译依赖
</p>


<p>
编译 <code>ccnet</code>
</p>
<div class="org-src-container">

<pre class="src src-sh">$cd ccnet-5.1.4-server
$./autogen.sh
./configure --prefix=`pwd`/../prefix --enable-server
</pre>
</div>

<pre class="example">
checking for uuid_generate in -luuid... no
configure: error: *** Unable to find uuid library
</pre>

<p>
<code>https://sourceforge.net/projects/libuuid/files/libuuid-1.0.3.tar.gz/download</code>
</p>
<div class="org-src-container">

<pre class="src src-sh">$cd libuuid-1.0.3/
$./configure --prefix=`pwd`/../prefix
$make
$make install
</pre>
</div>

<div class="org-src-container">

<pre class="src src-sh">$cd ccnet-5.1.4-server
$./configure --prefix=`pwd`/../prefix --enable-server LDFLAGS=-L`pwd`/../prefix/lib
</pre>
</div>

<pre class="example">
found library pthread
checking for sqlite3_open in -lsqlite3... no
configure: error: *** Unable to find sqlite3 library
</pre>

<div class="org-src-container">

<pre class="src src-sh">$wget -c http://www.sqlite.org/2016/sqlite-amalgamation-3140100.zip
$cd sqlite-autoconf-3140100
$./configure --prefix=`pwd`/../prefix
$make
$make install
</pre>
</div>

<div class="org-src-container">

<pre class="src src-sh">$cd ccnet-5.1.4-server
$export PKG_CONFIG_PATH=`pwd`/../prefix/lib/pkgconfig
$./configure --prefix=`pwd`/../prefix --enable-server LDFLAGS=-L`pwd`/../prefix/lib
</pre>
</div>

<pre class="example">
configure: error: Package requirements (libevent &gt;= 2.0) were not met:
No package 'libevent' found
</pre>

<div class="org-src-container">

<pre class="src src-sh">$wget -c https://github.com/libevent/libevent/releases/download/release-2.0.22-stable/libevent-2.0.22-stable.tar.gz
$./configure --prefix=`pwd`/../prefix LDFLAGS=-L`pwd`/../prefix/lib
$make
$make install
</pre>
</div>

<div class="org-src-container">

<pre class="src src-sh">$./configure --prefix=`pwd`/../prefix --enable-server LDFLAGS=-L`pwd`/../prefix/lib
...
checking for ZDB... no
configure: error: Package requirements (zdb &gt;= 2.10) were not met:
No package 'zdb' found
...
</pre>
</div>

<div class="org-src-container">

<pre class="src src-sh">$wget -c http://www.tildeslash.com/libzdb/dist/libzdb-3.1.tar.gz
$./configure --prefix=`pwd`/../prefix --with-mysql LDFLAGS=-L`pwd`/../prefix/lib CFLAGS=-I`pwd`/../prefix/include
$make
$make install
</pre>
</div>

<div class="org-src-container">

<pre class="src src-sh">$./configure --prefix=`pwd`/../prefix --enable-server LDFLAGS=-L`pwd`/../prefix/lib
$make
...
valac -C --pkg posix ccnetobj.vala
/bin/bash: valac: 未找到命令
make[2]: *** [ccnetobj.c] 错误 127
...
$sudo apt-get intall valac
$make 
...
../common/rpc-service.c:40:30: 致命错误： searpc-signature.h：没有那个文件或目录
编译中断。
make[3]: *** [rpc-service.o] 错误 1
make[3]:正在离开目录 `/home/miracle/下载/seafile/build/ccnet-5.1.4-server/net/daemon'
make[2]: *** [all-recursive] 错误 1
make[2]:正在离开目录 `/home/miracle/下载/seafile/build/ccnet-5.1.4-server/net'
make[1]: *** [all-recursive] 错误 1
make[1]:正在离开目录 `/home/miracle/下载/seafile/build/ccnet-5.1.4-server'
make: *** [all] 错误 2
...
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-orgheadline89" class="outline-4">
<h4 id="orgheadline89"><span class="section-number-4">8.15.3</span> 交叉编译Seafile</h4>
</div>

<div id="outline-container-orgheadline90" class="outline-4">
<h4 id="orgheadline90"><span class="section-number-4">8.15.4</span> 参考资料</h4>
<div class="outline-text-4" id="text-8-15-4">
<p>
官网：<a href="https://github.com/haiwen/seafile">https://github.com/haiwen/seafile</a>
</p>

<p>
编译：<a href="http://manual.seafile.com/build_seafile/linux.html">http://manual.seafile.com/build_seafile/linux.html</a>
</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline91" class="outline-3">
<h3 id="orgheadline91"><span class="section-number-3">8.16</span> <span class="todo WAIT_FORWARD">WAIT/FORWARD</span> SparkleShare</h3>
<div class="outline-text-3" id="text-8-16">
<ul class="org-ul">
<li><p>
State "WAIT/FORWARD" from "CANCEL"     <span class="timestamp-wrapper"><span class="timestamp">[2016-08-03 三 09:15] </span></span> <br  />
is it available as a git client?
</p>

<p>
考察是否能将其仅做为git户端使用，这样就不需要服务端有运行的了。服务端只需要有git即可。
</p></li>
<li>State "CANCEL"     from "NEXT"       <span class="timestamp-wrapper"><span class="timestamp">[2016-07-28 四 18:30] </span></span> <br  />
取消，因为依赖 <code>git-lfs</code>,而 <code>git-lfs</code> 是用 go 写的，并且可能依赖外部服务。</li>
<li>State "NEXT"       from              <span class="timestamp-wrapper"><span class="timestamp">[2016-07-27 三 09:29]</span></span></li>
</ul>

<p>
这是一个基于git的类dropbox网盘。
</p>

<p>
还需要基于图形环境。
</p>
</div>

<div id="outline-container-orgheadline92" class="outline-4">
<h4 id="orgheadline92"><span class="section-number-4">8.16.1</span> <span class="done CANCEL">CANCEL</span> PC上的编译安装</h4>
<div class="outline-text-4" id="text-8-16-1">
<ul class="org-ul">
<li>State "CANCEL"     from "MAYBE/FUTURE" <span class="timestamp-wrapper"><span class="timestamp">[2016-08-03 三 11:56] </span></span> <br  />
没有必要在PC上源码安装，只需在使用的机器上有一个sparkleshare客户端即可，因为服务端就是git服务器。没有必要考虑交叉编译。</li>
<li>State "MAYBE/FUTURE" from              <span class="timestamp-wrapper"><span class="timestamp">[2016-08-03 三 09:38]</span></span></li>
</ul>
</div>
<div id="outline-container-orgheadline194" class="outline-5">
<h5 id="orgheadline194"><span class="section-number-5">8.16.1.1</span> 依赖</h5>
<div class="outline-text-5" id="text-8-16-1-1">
</div><ol class="org-ol"><li><a id="orgheadline189"></a>安装curl<br  /><div class="outline-text-6" id="text-8-16-1-1-1">
<p>
参考： <a href="#orgheadline28">安装php所需依赖</a>
</p>
</div></li>
<li><a id="orgheadline190"></a>安装git<br  /><div class="outline-text-6" id="text-8-16-1-1-2">
<p>
参考： <a href="#orgheadline46">小米路由器 <code>git</code> 源码交叉编译</a>
</p>
</div></li>

<li><a id="orgheadline191"></a><span class="done CANCEL">CANCEL</span> 安装git-lfs<br  /><div class="outline-text-6" id="text-8-16-1-1-3">
<ul class="org-ul">
<li>State "CANCEL"     from "NEXT"       <span class="timestamp-wrapper"><span class="timestamp">[2016-07-28 四 18:32] </span></span> <br  />
取消，考虑git-annex.</li>
<li>State "NEXT"       from              <span class="timestamp-wrapper"><span class="timestamp">[2016-07-27 三 10:45]</span></span></li>
</ul>
<p>
官网：<a href="https://github.com/github/git-lfs/releases">https://github.com/github/git-lfs/releases</a>
</p>

<p>
下载：
</p>
<div class="org-src-container">

<pre class="src src-sh">$wget -c https://github.com/github/git-lfs/archive/v1.2.0.tar.gz
</pre>
</div>
</div></li>

<li><a id="orgheadline192"></a>libtool<br  /><div class="outline-text-6" id="text-8-16-1-1-4">
<div class="org-src-container">

<pre class="src src-sh">$sudo apt-get install libtool
</pre>
</div>
</div></li>

<li><a id="orgheadline193"></a>mono<br  /></li></ol>
</div>

<div id="outline-container-orgheadline195" class="outline-5">
<h5 id="orgheadline195"><span class="section-number-5">8.16.1.2</span> 下载：</h5>
<div class="outline-text-5" id="text-8-16-1-2">
<div class="org-src-container">

<pre class="src src-sh">$wget -c https://github.com/hbons/SparkleShare/archive/1.5.0.tar.gz
$./autogen.sh
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline93" class="outline-4">
<h4 id="orgheadline93"><span class="section-number-4">8.16.2</span> Ubuntu上直接安装</h4>
<div class="outline-text-4" id="text-8-16-2">
</div><div id="outline-container-orgheadline196" class="outline-5">
<h5 id="orgheadline196"><span class="section-number-5">8.16.2.1</span> 安装</h5>
<div class="outline-text-5" id="text-8-16-2-1">
<p>
因为服务端就是git服务器，只需在使用的机器上有一个sparkleshare客户端即可，没有必要在PC上源码安装，也没有必要考虑交叉编译。
</p>
<div class="org-src-container">

<pre class="src src-sh">$sudo add-apt-repository ppa:warp10/sparkleshare
$sudo apt-get update
$sudo apt-get install sparkleshare libwebkit1.1-cil git-core
</pre>
</div>

<p>
可能还需要安装python-nautilus，防止某些系统打开之后软件崩溃：
</p>
<div class="org-src-container">

<pre class="src src-sh">$sudo apt-get install python-nautilus
</pre>
</div>
</div>
</div>
<div id="outline-container-orgheadline197" class="outline-5">
<h5 id="orgheadline197"><span class="section-number-5">8.16.2.2</span> 运行</h5>
<div class="outline-text-5" id="text-8-16-2-2">
<div class="org-src-container">

<pre class="src src-sh">$sparkleshare start
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline198" class="outline-5">
<h5 id="orgheadline198"><span class="section-number-5">8.16.2.3</span> 添加已托管的git项目（位于ssh主机上）</h5>
<div class="outline-text-5" id="text-8-16-2-3">
<p>
选择已有的一个git服务器下的git目录添加, 经常会出现无法同步文件的情况。
</p>

<p>
如果机器是ssh登录的话，通过终端的log可看到，sparkle会自动登录远端服务器进行 <code>git clone</code>, 但是ssh密码却没有交互输入的地方。
</p>

<p>
解决方法：
需要将key文件上传到服务器中，实现免密ssh登录。
sparkleshare目录中有key文件，.ssh中也有。
上传用类似这个命令： <code>ssh-copy-id quietheart@112.74.19.38</code>
</p>
</div>
</div>

<div id="outline-container-orgheadline201" class="outline-5">
<h5 id="orgheadline201"><span class="section-number-5">8.16.2.4</span> 服务端的配置</h5>
<div class="outline-text-5" id="text-8-16-2-4">
<p>
Sparkle shared其实就是一个 git 图形客户端。自动定期同步其管辖目录下的git文件。服务端的配置非常简单，只需要有一个git仓库即可。
</p>

<p>
关于git的配置这里不做描述，需要的可参考git的相关使用文档： <a href="https://git-scm.com/book/zh/v2">https://git-scm.com/book/zh/v2</a>
</p>

<p>
常见的用于sparkle的比较重要的git配置如下：
</p>
</div>
<ol class="org-ol"><li><a id="orgheadline199"></a>允许push<br  /><div class="outline-text-6" id="text-8-16-2-4-1">
<p>
服务端git仓库需要配置成允许push, 修改配置文件修改其 <code>receive.denyCurrentBranch</code> 的值为 <code>ignore</code> ，
或者在具有工作目录的仓库中运行 <code>git config receive.denyCurrentBranch ignore</code> .
</p>
</div></li>

<li><a id="orgheadline200"></a>使用裸库替代有工作目录的git库<br  /><div class="outline-text-6" id="text-8-16-2-4-2">
<p>
如果服务端git仓库中包含一个工作目录，那么客户端的Sparkleshare 完成 push之后，服务端会看不到变化的文件。原因是服务端如果在被push的分支上，就无法在实时更新其工作目录结构，需要在服务端手动运行 <code>git reset --hard</code> 才行。
</p>

<p>
最好的方法是，将服务端的git库设为裸库（或者镜像？）。
</p>
</div></li></ol>
</div>
</div>

<div id="outline-container-orgheadline94" class="outline-4">
<h4 id="orgheadline94"><span class="section-number-4">8.16.3</span> 参考网址：</h4>
<div class="outline-text-4" id="text-8-16-3">
<p>
官方网址：<a href="https://www.sparkleshare.org/">https://www.sparkleshare.org/</a>
</p>

<p>
代码管理：<a href="https://www.github.com/hbons/SparkleShare">https://www.github.com/hbons/SparkleShare</a>
</p>

<p>
源代码安装： <a href="https://github.com/hbons/SparkleShare/blob/master/SparkleShare/Linux/README.md">https://github.com/hbons/SparkleShare/blob/master/SparkleShare/Linux/README.md</a>
</p>

<p>
Wiki： <a href="https://www.github.com/hbons/SparkleShare/wiki">https://www.github.com/hbons/SparkleShare/wiki</a>
</p>

<p>
git-annex： <a href="http://git-annex.branchable.com/walkthrough/">http://git-annex.branchable.com/walkthrough/</a>
</p>

<p>
git-annex:  <a href="http://git-annex.branchable.com/">http://git-annex.branchable.com/</a>
</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline95" class="outline-3">
<h3 id="orgheadline95"><span class="section-number-3">8.17</span> <span class="todo MAYBE_FUTURE">MAYBE/FUTURE</span> dvcs-autosync</h3>
<div class="outline-text-3" id="text-8-17">
<ul class="org-ul">
<li>State "MAYBE/FUTURE" from              <span class="timestamp-wrapper"><span class="timestamp">[2016-07-28 四 19:53]</span></span></li>
</ul>
</div>
</div>
<div id="outline-container-orgheadline96" class="outline-3">
<h3 id="orgheadline96"><span class="section-number-3">8.18</span> <span class="done CANCEL">CANCEL</span> git annex</h3>
<div class="outline-text-3" id="text-8-18">
<ul class="org-ul">
<li>State "CANCEL"     from "NEXT"       <span class="timestamp-wrapper"><span class="timestamp">[2016-07-29 五 11:57] </span></span> <br  />
语言太奇葩：Haskell.</li>
<li>State "NEXT"       from "CANCEL"     <span class="timestamp-wrapper"><span class="timestamp">[2016-07-29 五 11:36]</span></span></li>
<li>State "CANCEL"     from "NEXT"       <span class="timestamp-wrapper"><span class="timestamp">[2016-07-28 四 19:39] </span></span> <br  />
使用麻烦，安装也不一定好弄</li>
<li>State "NEXT"       from              <span class="timestamp-wrapper"><span class="timestamp">[2016-07-28 四 18:32]</span></span></li>
</ul>

<p>
开发语言比较奇葩
</p>
<pre class="example">
git-annex is Free Software, written in Haskell. You can contribute!
</pre>
</div>

<div id="outline-container-orgheadline97" class="outline-4">
<h4 id="orgheadline97"><span class="section-number-4">8.18.1</span> 源代码</h4>
<div class="outline-text-4" id="text-8-18-1">
<div class="org-src-container">

<pre class="src src-sh">git clone https://github.com/joeyh/git-annex.git
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline98" class="outline-4">
<h4 id="orgheadline98"><span class="section-number-4">8.18.2</span> 参考资料</h4>
<div class="outline-text-4" id="text-8-18-2">
<p>
官方网站：
<a href="http://git-annex.branchable.com/">http://git-annex.branchable.com/</a>
</p>

<p>
学习的起点：
<a href="https://writequit.org/articles/getting-started-with-git-annex.html">https://writequit.org/articles/getting-started-with-git-annex.html</a>
</p>

<p>
使用举例：
<a href="http://git-annex.branchable.com/walkthrough/#index10h2">http://git-annex.branchable.com/walkthrough/#index10h2</a>
</p>

<p>
下载应用：
<a href="https://downloads.kitenet.net/git-annex/android/current/">https://downloads.kitenet.net/git-annex/android/current/</a>
</p>

<p>
源代码：
<a href="https://github.com/joeyh/git-annex">https://github.com/joeyh/git-annex</a>
</p>

<p>
其他：
<a href="http://hackage.haskell.org/package/git-annex">http://hackage.haskell.org/package/git-annex</a>
</p>
</div>
</div>
</div>
<div id="outline-container-orgheadline99" class="outline-3">
<h3 id="orgheadline99"><span class="section-number-3">8.19</span> <span class="todo MAYBE_FUTURE">MAYBE/FUTURE</span> git lfs</h3>
<div class="outline-text-3" id="text-8-19">
<ul class="org-ul">
<li>State "MAYBE/FUTURE" from "NEXT"       <span class="timestamp-wrapper"><span class="timestamp">[2016-08-03 三 19:02]</span></span></li>
<li>State "NEXT"       from              <span class="timestamp-wrapper"><span class="timestamp">[2016-07-29 五 12:05]</span></span></li>
</ul>

<p>
服务器？go语言？
<a href="https://git-lfs.github.com/">https://git-lfs.github.com/</a>
</p>
</div>
</div>
</div>
<br>
<div id="mypostamble" align="right" style="float:right" class="status">
    <table> <tbody> 
	<tr>
	  <td style="border-style: solid;border-width:1px;border-left:0px;">Author</td>
	  <td style="border-style: solid;border-width:1px;border-right:0px;">QuietHeart</td>	  
	</tr>
	<tr>
	  <td style="border-style: solid;border-width:1px;border-left:0px;">Email</td>
	  <td style="border-style: solid;border-width:1px;border-right:0px;">
	    <a href="mailto:quiet_heart000@126.com">quiet_heart000@126.com</a>
	  </td>
	  
	</tr>
    	<tr>
	  <td style="border-style: solid;border-width:1px;border-left:0px;">Date</td>
	  <td style="border-style: solid;border-width:1px;border-right:0px;">[2016-04-07 四 18:52]</td>
	  
	</tr>
    	<tr>
	  <td style="border-style: solid;border-width:1px;border-left:0px;">Update</td>
	  <td style="border-style: solid;border-width:1px;border-right:0px;"><2016-08-19 五 16:26:02></td>
	</tr>
    </tbody></table>
</div>
<br>



  </div>
</article>

		  <!-- 多说评论框 start -->
<div class="ds-thread" data-thread-key="/categories/study/linux/misc/xiaomi_router_tips" data-title="小米路由器DIY" data-url="http://vaqeteart.github.io//categories/study/linux/misc/xiaomi_router_tips.html"></div>
<!-- 多说评论框 end -->
<script src="/assets/js/comment.js"></script>
		</td>
             </tr>
            <tr>
                <td id="td_page_footer" colspan="6">
<footer>
  &copy 2015
</footer>
<a id="bottom"></a>
</td>


            </tr>
        </tbody>
    </table>
  </body>
</html>
